Выведение типов Java-компилятором
<p>----------------------------------------</p>
Синтаксический сахар Программисты любят, когда какой-то сложный код или логику можно написать парой строй и код при этом компактный и читаемый. А разработчики языков иногда помогают им в этом. Хитрые особенности языка, которые позволяют использовать более короткий путь (писать меньше кода) назыв
<p>----------------------------------------</p>
<div class="lesson-carousel lesson-carousel--comics lesson-carousel--desktop">
    <div class="lesson-carousel__list">
        <div class="lesson-carousel__item">
            <img data-id="3620a166-53e3-4c8f-b799-82b0378fe012" src="https://cdn.javarush.com/images/article/3620a166-53e3-4c8f-b799-82b0378fe012/original.png" alt="">
        </div>
    </div>
</div>
<div class="lesson-carousel lesson-carousel--comics lesson-carousel--mobile">
    <div class="lesson-carousel__list">
        <div class="lesson-carousel__item">
            <img data-id="69496ef7-65a1-495a-bfdb-2a0cb79cbf18" src="https://cdn.javarush.com/images/article/69496ef7-65a1-495a-bfdb-2a0cb79cbf18/original.png" alt="">
        </div>
        <div class="lesson-carousel__item">
            <img data-id="0e0c37a0-0c64-40d6-9c9c-43637cf5bedd" src="https://cdn.javarush.com/images/article/0e0c37a0-0c64-40d6-9c9c-43637cf5bedd/original.png" alt="">
        </div>
    </div>
</div>
<hr>
<h2>1. Синтаксический сахар</h2>
<p>Программисты любят, когда какой-то сложный код или логику можно написать парой строк, и код при этом компактный и читаемый. А разработчики языков иногда помогают им в этом.</p>
<p>Хитрые особенности языка, которые позволяют использовать более короткий путь (писать меньше кода), называют <span class="term">синтаксическим сахаром</span>. Хотя, честно говоря, в Java его совсем немного.</p>
<p>Разработчики Java сделали все, чтобы устранить из Java всю возможную избыточность. Если в C++ что-то можно сделать десятью способами, в Java чаще всего это можно сделать только одним способом.</p>
<p>Но такая унификация не нравится ни Java-программистам, ни создателям Java. И иногда они упрощают жизнь обычным ребятам вроде нас с вами.</p>
<p>Вы, кстати, уже познакомились с вещью, которую можно отнести к синтаксическому сахару — это <span class="term">autoboxing</span> и <span class="term">unboxing</span>. Сравните:</p>
<table>
    <tbody>
    <tr>
        <th width="50%">Длинный код</th>
        <th>Компактный код</th>
    </tr>
    <tr>
        <td>
<pre class="language-java"><code>Integer a = <span class="code"><span class="text-red">new Integer</span></span>(5);
int b = a.<span class="code"><span class="text-red">intValue()</span></span>;</code></pre>
        </td>
        <td>
<pre class="language-java"><code>Integer a = 5;
int b = a;</code></pre>
        </td>
    </tr>
    <tr>
        <td>
<pre class="language-java"><code>int b = 5;
Integer c = <span class="code"><span class="text-red">new Integer</span></span>(b);</code></pre>
        </td>
        <td>
<pre class="language-java"><code>int b = 5;
Integer c = b;</code></pre>
        </td>
    </tr>
    <tr>
        <td>
<pre class="language-java"><code>Integer a = <span class="code"><span class="text-red">new Integer</span></span>(1);
int b = 1;
if (a.<span class="code"><span class="text-red">intValue()</span></span> == b)
{
   ...
}</code></pre>
        </td>
        <td>
<pre class="language-java"><code>Integer a = 1;
int b = 1;
if (a == b)
{
   ...
}</code></pre>
        </td>
    </tr>
    </tbody>
</table>
<p>Вместо длинного кода как слева вы можете писать более компактный код, как справа. А умный <span class="term">Java-компилятор</span> на основе краткого кода сам сгенерирует его полную версию. Это и есть синтаксический сахар.</p>
<hr>
<h2>2. Выведение типа переменной &#8211; <code>var</code></h2>
<p>В Java 11 компилятор стал еще умнее и теперь может определить <strong>тип создаваемой переменной по типу значения</strong>, которое ей присваивают. Выглядит это в коде так:</p>
<div class="lesson-example lesson-example--center">
    <pre class="lecture-code lecture-code--present language-java"><code>var <span class="code text-green">имя</span> = <span class="code text-user">значение</span>;</code></pre>
</div>
<p>Где <code class="text-green">имя</code> — это имя новой переменной, <span class="code text-user">значение</span> — ее стартовое значение, а <code>var</code> — это ключевое слово, используемое для объявления переменной. Тип у переменной <span class="code text-green">имя</span> будет такой же, как у значения, которое ей присваивают.</p>
<p>Примеры:</p>
<table>
    <tbody>
    <tr>
        <th>Как этот код видим мы</th>
        <th>Что видит компилятор</th>
    </tr>
    <tr>
        <td>
            <pre class="language-java"><code><span class="text-red">var</span> i = 1;</code></pre>
        </td>
        <td>
            <pre class="language-java"><code><span class="text-red">int</span> i = 1;</code></pre>
        </td>
    </tr>
    <tr>
        <td>
            <pre class="language-java"><code><span class="text-red">var</span> s = "Привет";</code></pre>
        </td>
        <td>
            <pre class="language-java"><code><span class="text-red">String</span> s = "Привет";</code></pre>
        </td>
    </tr>
    <tr>
        <td>
            <pre class="language-java"><code><span class="text-red">var</span> console = new Scanner(System.in);</code></pre>
        </td>
        <td>
            <pre class="language-java"><code><span class="text-red">Scanner</span> console = new Scanner(System.in);</code></pre>
        </td>
    </tr>
    <tr>
        <td>
            <pre class="language-java"><code><span class="text-red">var</span> list = new ArrayList&lt;String&gt;();</code></pre>
        </td>
        <td>
            <pre class="language-java"><code><span class="text-red">ArrayList&lt;String&gt;</span> list = new ArrayList&lt;String&gt;();</code></pre>
        </td>
    </tr>
    <tr>
        <td>
            <pre class="language-java"><code><span class="text-red">var</span> data = new int[]{1, 2, 3};</code></pre>
        </td>
        <td>
            <pre class="language-java"><code><span class="text-red">int[]</span> data = new int[]{1, 2, 3};</code></pre>
        </td>
    </tr>
    </tbody>
</table>
<p>Компилятор сам определяет или, как еще говорят, <strong>выводит тип переменной</strong> на основе значения, которое ей присваивают.</p>
<p>Немало копий было сломлено в баталиях программистов на тему того, стоит ли добавлять такую возможность в язык или нет. Многие боялись, что использованием <code>var</code> начнут злоупотреблять, и читаемость кода сильно снизится.</p>
<p>Доля истины в этом есть, так что лучше всего использовать <code>var</code> там, где это повышает читабельность кода. Например, этих в двух случаях:</p>
<p><strong>Случай 1: глядя на значение переменной сразу ясно, какой тип у переменной</strong></p>
<table>
    <tbody>
    <tr>
        <th>Код</th>
        <th>Пояснение</th>
    </tr>
    <tr>
        <td>
            <pre class="language-java"><code>var stream = url.getInputStream();</code></pre>
        </td>
        <td>У переменной тип <code>InputStream</code></td>
    </tr>
    <tr>
        <td>
            <pre class="language-java"><code>var name = person.getFullName();</code></pre>
        </td>
        <td>У переменной тип <code>String</code></td>
    </tr>
    </tbody>
</table>
<p>А вот в этих случаях использовать <code>var</code> <span class="text-red">не стоит</span>. Ну-ка ответьте, какой тип у переменной?</p>
<table>
    <tbody>
    <tr>
        <th>Код</th>
        <th>Пояснение</th>
    </tr>
    <tr>
        <td>
            <pre class="language-java"><code>var result = task.execute();</code></pre>
        </td>
        <td>Тип переменной определить сложно</td>
    </tr>
    <tr>
        <td>
            <pre class="language-java"><code>var status = person.getStatus();</code></pre>
        </td>
        <td>Тип переменной определить сложно</td>
    </tr>
    </tbody>
</table>
<p><strong>Случай 2: тип переменной не важен для понимания кода</strong></p>
<p>Часто в коде могут быть ситуации, когда у переменной не вызываются никакие методы &#8211; переменная просто используется для временного хранения чего-либо. Использование <code>var</code> тут абсолютно не снижает понимание кода:</p>
<table>
    <tbody>
    <tr>
        <th width="50%">Длинный код</th>
        <th>Компактный код</th>
    </tr>
    <tr>
        <td>
<pre class="language-java"><code>var data = stream.getMetaData();
storage.save(data)</code></pre>
        </td>
        <td>Мы получили метаданные из потока <code>stream</code> и сохранили их в хранилище <code>storage</code>. Какой именно тип был у переменной <code>data</code> — не важно.</td>
    </tr>
    </tbody>
</table>
<p><strong>Золотая середина</strong></p>
<p>Сейчас приведу три способа записи одного и того же кода. Использование <code>var</code> будет оптимальным вариантом.</p>
<table>
    <tbody>
    <tr>
        <th>Код</th>
        <th>Примечание</th>
    </tr>
    <tr>
        <td>
            <pre class="language-java"><code><span class="code text-user">dest</span>.writeHeaderInfo(<span class="code text-green">src</span>.getFileMetaInfo());</code></pre>
        </td>
        <td>Слишком компактно</td>
    </tr>
    <tr>
        <td>
<pre class="language-java"><code><span class="text-red text-bold">var</span> <span class="code text-orange">headerInfo</span> = <span class="code text-green">src</span>.getFileMetaInfo();
<span class="code text-user">dest</span>.writeHeaderInfo(<span class="code text-orange">headerInfo</span>);</code></pre>
        </td>
        <td>Идеально</td>
    </tr>
    <tr>
        <td>
<pre class="language-java"><code>FileMetaInfo <span class="code text-orange">headerInfo</span> = <span class="code text-green">src</span>.getFileMetaInfo();
<span class="code text-user">dest</span>.writeHeaderInfo(<span class="code text-orange">headerInfo</span>);</code></pre>
        </td>
        <td>Слишком подробно</td>
    </tr>
    </tbody>
</table>
<p>Когда мы перешли от варианта в строке 1 к варианту в строке 2, мы за счет имени переменной (<code>headerInfo</code>) добавили коду немного читаемости. Теперь ясно, что метод возвращал не просто метаинформацию, а информацию о заголовке.</p>
<p>Третий вариант был бы избыточным. Ну и что, что <code class="text-orange">headerInfo</code> имеет тип <code>FileMetaInfo</code> — это и так было почти понятно по методу <code>getFileMetaInfo()</code>. Гораздо интереснее назначение этой метаинформации.</p>
<hr>
<div class="task-widget-container" showCover="true" taskKey="com.javarush.task.pro.task12.task1216"></div>
<div class="task-widget-container" showCover="true" taskKey="com.javarush.task.pro.task12.task1217"></div>
<hr>
<h2>3. Опускание типа — оператор diamond: <code>&lt;&gt;</code></h2>
<p>Еще до появления оператора <code>var</code> были попытки научить компилятор выводить типы коллекций. Согласитесь, эта запись выглядит немного избыточно:</p>
<div class="lesson-example lesson-example--center">
    <pre class="lecture-code lecture-code--present language-java"><code><span class="text-neon">ArrayList</span>&lt;<span class="text-orange">String</span>&gt; <span class="text-user">list</span> = new <span class="text-neon">ArrayList</span>&lt;<span class="text-orange">String</span>&gt;();</code></pre>
</div>
<p>Начиная с седьмой версии Java, при записи типа коллекции можно было опускать (не писать) тип элементов коллекции, если он указан при объявлении переменной. Т.е. код выше можно записать немного в сокращенном виде:</p>
<div class="lesson-example lesson-example--center">
    <pre class="lecture-code lecture-code--present language-java"><code><span class="text-neon">ArrayList</span>&lt;<span class="text-orange">String</span>&gt; <span class="text-user">list</span> = new <span class="text-neon">ArrayList</span>&lt;&gt;();</code></pre>
</div>
<p>Как вы видите, второй раз писать тип String больше не нужно. Не так круто, как с оператором var, но в свое время и это казалось достижением.</p>
<p>Пустые треугольные скобки в типе коллекции получили название <strong>оператор diamond</strong>: две скобки отдаленно напоминали силуэт бриллианта.</p>
<p>Использовать <strong>одновременно</strong> <code>var</code> и <span class="term">оператор diamond</span> не желательно:</p>
<div class="lesson-example lesson-example--center">
    <pre class="lecture-code lecture-code--present language-java"><code><span class="text-red">var</span> <span class="text-user">list</span> = new <span class="text-neon">ArrayList</span>&lt;&gt;();</code></pre>
</div>
<p>Информации о типе, который хранит коллекция, совсем не остается и тип будет определен как <span class="text-neon">ArrayList</span>&lt;<span class="text-orange">Object</span>&gt;.</p>
<hr>
<div class="task-widget-container" showCover="true" taskKey="com.javarush.task.pro.task12.task1218"></div>
<hr>
<h2>4. Двойные фигурные скобки</h2>
<p>Помните быструю инициализацию массива?</p>
<p>Мы там просто перечисляли значение в фигурных скобках:</p>
<table>
    <tr>
        <th>Примеры</th>
    </tr>
    <tr>
        <td>
            <pre class="language-java"><code>int[] data = new int[] {1, 2, 3, 4, 5, 6, 7};</code></pre>
        </td>
    </tr>
    <tr>
        <td>
            <pre class="language-java"><code>int[] data = {1, 2, 3, 4, 5, 6, 7};</code></pre>
        </td>
    </tr>
</table>
<p>Создателям Java понравилась идея использовать фигурные скобки для упрощенной записи данных в массив. Но как быть с коллекциями?</p>
<p>Для коллекций тоже хватило фантазии: разрешили использовать трюк с двойными фигурными скобками.</p>
<table>
    <tbody>
    <tr>
        <th>С сахаром</th>
        <th>Без сахара</th>
    </tr>
    <tr>
        <td>
<pre class="language-java"><code>var <span class="code text-user">list</span> = new ArrayList&lt;String&gt;()
<span class="text-red">{{</span>
   <span class="text-viola">add</span>("Привет");
   <span class="text-viola">add</span>("Как");
   <span class="text-viola">add</span>("Дела");
<span class="text-red">}}</span>;</code></pre>
        </td>
        <td>
<pre class="language-java"><code>var <span class="code text-user">list</span> = new ArrayList&lt;String&gt;();

<span class="code text-user">list</span>.<span class="text-viola">add</span>("Привет");
<span class="code text-user">list</span>.<span class="text-viola">add</span>("Как");
<span class="code text-user">list</span>.<span class="text-viola">add</span>("Дела");</code></pre>
        </td>
    </tr>
    </tbody>
</table>
<p>Если компилятор встретит код в примере слева, он преобразует его в код справа.</p>
<p>Код не становится сильно компактнее. Тут скорее экономия на мелочах: не нужно каждый раз писать <code class="text-user">list</code>. Это может быть выгодно, если имя переменной очень длинное.</p>
<p>Но если вы встретите в чьем-то проекте такой код, не удивляйтесь 🙂</p>
<hr>
<div class="task-widget-container" showCover="true" taskKey="com.javarush.task.pro.task12.task1219"></div>