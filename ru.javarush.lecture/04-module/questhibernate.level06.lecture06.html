INDEX: индексы
<p>----------------------------------------</p>
Причины появление индексов
Добавление индексов в таблицу
<p>----------------------------------------</p>
<h2>7.1 Причины появление индексов</h2>
<p>Еще одна важная вещь, без который не может быть баз данных — это индексы.</p>
<p>Представь себе ситуацию, когда в таблице <strong>user</strong> есть 10 миллионов пользователи, и тебе нужно вывести всех, у кого уровень выше 90. Этот запрос написать очень просто:</p>
 <div class="lesson-example lesson-example--center">
    <pre class="lecture-code lecture-code--present language-java"><code>
<span class="text-brown">SELECT</span> * <span class="text-brown">FROM</span> <span class="text-yellow">user</span> <span class="text-brown">WHERE</span> <span class="text-green">level</span> &gt; 90
        </code></pre>
</div>
<p>Отлично, мы написали запрос меньше чем за минуту. А сколько времени займет выполнение этого запроса у SQL-сервера? Для выполнения такого запроса ему придется пройти по 10 миллионам записей, и даже если искомая запись всего одна, то это займет кучу времени.</p>
<p>Как бы мы сделали аналогичную задачу в Java? Мы бы сначала отсортировали коллекцию пользователей по level, а потом можно было бы очень быстро найти нужные записи с помощью бинарного поиска. Надеюсь, не нужно объяснять, что это такое?</p>
<p>Отлично, а что делать, если теперь нам нужно отобрать пользователей, чья дата регистрации была до 2020 года? Опять сортировать по дате регистрации и использовать бинарный поиск.</p>
<p>Ага, <span class="text-green">если мы выполняем фильтр по какому-то полю, причем не один раз, а часто, то будет очень полезно хранить данные отсортированными по этому полю.</span></p>
<p>А как хранить данные, отсортированные одновременно по разным полям?</p>
<p>А ответ очень прост — нужно хранить не сами данные, а их индексы в некой глобальной таблице.</p>
<p>Допустим, есть 10 пользователей с id: <code>{1, 2, 3, 4, 5, 6, 7, 8, 9, 10}</code>.</p>
<p>И ты решаешь отсортировать их по уровню, тогда массив их id будет, например, таким: <code>{9, 2, 3, 1, 5, 4, 8, 6, 7, 10}</code>.</p>
<p>А если отсортировать их по дате, то мы получим, например: <code>{10, 1, 8, 7, 2, 3, 5, 9, 6}</code>.</p>
<p><strong>Массивы этих id и называются индексами</strong>. Сами элементы большие, их мы не трогаем. В Java мы не трогаем объекты, а храним их ссылки, в SQL мы не трогаем реальные строки, а храним их номера.</p>
<p>Давай я еще раз запишу это в виде Java-кода:</p>
<pre class='language-java line-numbers'><code>
List&lt;String&gt; list = List.of("А", "С", "B", "Z", "Сc", "Bb", "Zz", "Y");  //это список объектов
List&lt;String&gt; alphabeticsList = new ArrayList(list);
Collections.sort(alphabeticsList); //коллекция отсортированная по алфавиту
 
List&lt;String&gt; lengthList = new ArrayList(list);
Collections.sort(lengthList, lengthComparator); //коллекция отсортированная по длине строк
</code></pre>
<p>Сортировка коллекций не означает перемещение реальных элементов. Коллекция хранит не реальные объекты, а ссылки на них. Так же и в таблицах SQL. Реальные строки лежат себе и лежат.  </p>
<p>И когда нам нужно часто делать выборки по какому-то полю, то мы <strong>добавляем еще один индекс к таблице</strong> (аналог новой коллекции в Java) и сортируем строки таблицы, храним их отсортированный порядок в специальном файле индексов.</p>
<p>Надеюсь, сравнение с Java немного помогло. Немного практики — и для тебя использование индексов тоже станет самым очевидным решением. </p>
<h2>7.2 Добавление индексов в таблицу</h2>
<p>Индекс можно указать сразу во время создания таблицы или же добавить после. Чаще всего встречается именно второй сценарий – индексы добавляют по мере роста размеров таблицы и замедления выборки данных.</p>
<p>Добавить индекс в таблицу очень просто:</p>
 <div class="lesson-example lesson-example--center">
    <pre class="lecture-code lecture-code--present language-java"><code>
<span class="text-brown">ALTER TABLE</span> <span class="text-yellow">таблица</span>
    <span class="text-red">ADD INDEX</span> <span class="text-user">имя_индекса</span> (<span class="text-green">колонка</span>);
        </code></pre>
</div>
<p>Если ты часто ищешь записи по нескольким колонкам одновременно, можешь указать составной индекс: для его составления SQL использует несколько колонок.</p>
<p>Добавить составной индекс в таблицу тоже очень просто:</p>
 <div class="lesson-example lesson-example--center">
    <pre class="lecture-code lecture-code--present language-java"><code>
<span class="text-brown">ALTER TABLE</span> <span class="text-yellow">таблица</span>
    <span class="text-red">ADD INDEX</span> <span class="text-user">имя_индекса</span> (<span class="text-green">колонка1</span>, <span class="text-green">колонка2</span>, <span class="text-green">колонка3</span>, ...);
        </code></pre>
</div>
<p>Индексы занимают достаточно много места на диске, так что если какой-то индекс тебе больше не нужен, ты всегда можешь удалить его:</p>
 <div class="lesson-example lesson-example--center">
    <pre class="lecture-code lecture-code--present language-java"><code>
<span class="text-brown">ALTER TABLE</span> <span class="text-yellow">таблица</span>
    <span class="text-red">DROP INDEX</span> <span class="text-user">имя_индекса</span>;
        </code></pre>
</div>
<p>Сами индексы — это достаточно скрытая часть базы данных. Они никак не влияют на формат написания запросов. Просто их наличие ускоряет выборку данных и замедляет их добавление и бэкап.</p>
<p>Но учитывая, как важна скорость в современном мире и как дешево место на дисках, не стесняйся добавлять индексы на все случаи жизни. Да простят меня админы…</p>
