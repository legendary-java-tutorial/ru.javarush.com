Нормальные формы базы данных
<p>----------------------------------------</p>
первая нормальная форма
вторая нормальная форма
третья нормальная форма
<p>----------------------------------------</p>
<h2>3.1 Нормализация базы данных</h2>
<p>Нормальная форма — свойство отношения в реляционной модели данных, характеризующее его с точки зрения избыточности, потенциально приводящей к логически ошибочным результатам выборки или изменения данных. Нормальная форма определяется как совокупность требований, которым должно удовлетворять отношение (таблиц в базе данных). 
</p>
<p>Процесс преобразования отношений базы данных к виду, отвечающему нормальным формам, называется нормализацией. Нормализация предназначена для приведения структуры БД к виду, обеспечивающему <span class="text-green">минимальную логическую избыточность</span>, и <span class="text-red">не имеет целью уменьшение или увеличение производительности работы или же уменьшение или увеличение физического объёма базы данных</span>.  </p>
<p>Конечной целью нормализации является уменьшение потенциальной противоречивости, хранимой в базе данных информации. Общее назначение процесса нормализации заключается в следующем: </p>
<ul>
	<li>исключение некоторых типов избыточности; </li>
	<li>устранение некоторых аномалий обновления; </li>
	<li>разработка проекта базы данных, который является достаточно «качественным» представлением реального мира, интуитивно понятен и может служить хорошей основой для последующего расширения; </li>
	<li>упрощение процедуры применения необходимых ограничений целостности. </li>
</ul>
<p>Устранение избыточности производится, как правило, за счёт декомпозиции отношений таким образом, чтобы в каждом отношении хранились только первичные факты (то есть факты, не выводимые из других хранимых фактов). </p>
<p>При том, что идеи нормализации весьма полезны для проектирования баз данных, они отнюдь не являются универсальным или исчерпывающим средством повышения качества проекта БД. Это связано с тем, что существует слишком большое разнообразие возможных ошибок и недостатков в структуре БД, которые нормализацией не устраняются.  </p>
<p>Несмотря на эти рассуждения, теория нормализации является очень ценным достижением реляционной теории и практики, поскольку она даёт научно строгие и обоснованные критерии качества проекта БД и формальные методы для усовершенствования этого качества. Этим теория нормализации резко выделяется на фоне чисто эмпирических подходов к проектированию, которые предлагаются в других моделях данных. Более того, можно утверждать, что во всей сфере информационных технологий практически отсутствуют методы оценки и улучшения проектных решений, сопоставимые с теорией нормализации реляционных баз данных по уровню формальной строгости. </p>
<p>Нормализацию иногда упрекают на том основании, что «это просто здравый смысл», а любой компетентный профессионал и сам «естественным образом» спроектирует полностью нормализованную БД без необходимости применять теорию зависимостей.  </p>
<p>Однако, как отмечал профессор Кристофер Дейт, <strong>нормализация в точности и является теми принципами здравого смысла, которыми руководствуется в своём сознании зрелый проектировщик, то есть принципы нормализации — это формализованный здравый смысл</strong>. Между тем, идентифицировать и формализовать принципы здравого смысла — весьма трудная задача, и успех в её решении является существенным достижением.</p>
<h2>3.2 Первая нормальная форма</h2>
<p><strong>Первая нормальная форма (1НФ)</strong> — базовая нормальная форма отношения в реляционной модели данных. </p>
<p><span class="text-green">Переменная отношения находится в первой нормальной форме тогда и только тогда, когда в любом допустимом значении этой переменной каждый кортеж отношения содержит только одно значение для каждого из атрибутов. </span></p>
<p>В реляционной модели отношение всегда находится в первой нормальной форме по определению понятия отношение. 
</p>
<p>Что же касается различных таблиц, то они могут не быть правильными представлениями отношений и, соответственно, могут не находиться в 1НФ. В соответствии с определением Кристофера Дейта для такого случая таблица нормализована (эквивалентно — находится в первой нормальной форме) тогда и только тогда, когда она является прямым и верным представлением некоторого отношения. Конкретнее, рассматриваемая таблица должна удовлетворять следующим пяти условиям: </p>
<ul>
	<li>Нет упорядочивания строк сверху вниз (другими словами, порядок строк не несет в себе никакой информации). </li>
	<li>Нет упорядочивания столбцов слева направо (другими словами, порядок столбцов не несет в себе никакой информации). </li>
	<li>Нет повторяющихся строк. </li>
	<li>Каждое пересечение строки и столбца содержит ровно одно значение из соответствующего домена (и больше ничего). </li>
	<li>Все столбцы являются «обычными». </li>
</ul>
<p>«Обычность» всех столбцов таблицы означает, что в таблице нет «скрытых» компонентов, которые могут быть доступны только в вызове некоторого специального оператора взамен ссылок на имена регулярных столбцов, или которые приводят к побочным эффектам для строк или таблиц при вызове стандартных операторов.  </p>
<p>Исходная ненормализованная (то есть не являющаяся правильным представлением некоторого отношения) таблица: </p>
<table>
    <tbody>
    <tr>
        <th>Сотрудник</th>
        <th>Номер телефона</th>
    </tr>
    <tr>
        <td>Иванов И. И.</td>
        <td><p>283-56-82</p>
        <p>390-57-34</p></td>
    </tr>
    <tr>
        <td>Петров П. П.</td>
        <td>708-62-34</td>
    </tr>
    <tr>
        <td>Сидоров С.С.</td>
        <td></td>
    </tr>
    </tbody>
</table>
<p>Таблица, приведённая к 1НФ, являющаяся правильным представлением некоторого отношения:  </p>
<table>
    <tbody>
    <tr>
        <th>Сотрудник</th>
        <th>Номер телефона</th>
    </tr>
    <tr>
        <td>Иванов И. И.</td>
        <td>283-56-82</td>
    </tr>
        <tr>
        <td>Иванов И. И.</td>
        <td>390-57-34</td>
    </tr>
    <tr>
        <td>Петров П. П.</td>
        <td>708-62-34</td>
    </tr>
    </tbody>
</table>
<h2>3.3 Вторая нормальная форма </h2>
<p>Переменная отношения находится во второй нормальной форме тогда и только тогда, когда она находится в первой нормальной форме и <span class="text-green">каждый неключевой атрибут неприводимо зависит от (каждого) её потенциального ключа</span>. </p>
<p>Неприводимость означает, что в составе потенциального ключа отсутствует меньшее подмножество атрибутов, от которого можно также вывести данную функциональную зависимость. Для неприводимой функциональной зависимости часто используется эквивалентное понятие «полная функциональная зависимость». </p>
<p>Если потенциальный ключ является простым, то есть состоит из единственного атрибута, то любая функциональная зависимость от него является неприводимой (полной). Если потенциальный ключ является составным, то, согласно определению второй нормальной формы, в отношении не должно быть неключевых атрибутов, зависящих от части составного потенциального ключа. </p>
<p>Пример приведения отношения ко <strong>второй нормальной форме </strong></p>
<p>Пусть в следующем отношении первичный ключ образует пара атрибутов {Филиал компании, Должность}: </p>
<center><strong>R</strong> </center>
<table>
    <tbody>
    <tr>
        <th>Филиал компании</th>
        <th>Должность</th>
        <th>Зарплата</th>
        <th>Наличие компьютера</th>
    </tr>
    <tr>
        <td>Филиал в Томске</td>
        <td>Уборщик</td>
        <td>20000</td>
        <td>Нет</td>
    </tr>
    <tr>
        <td>Филиал в Москве</td>
        <td>Программист</td>
        <td>40000</td>
        <td>Есть</td>
    </tr>
    <tr>
        <td>Филиал в Томске</td>
        <td>Программист</td>
        <td>25000</td>
        <td>Есть</td>
    </tr>

    </tbody>
</table>
<p>Допустим, что зарплата зависит от филиала и должности, а наличие компьютера зависит только от должности.</p>
<p>Существует функциональная зависимость Должность -&gt; Наличие компьютера, в которой левая часть (детерминант) является лишь частью первичного ключа, что нарушает условие второй нормальной формы. </p>
<p>Для приведения к 2NF исходное отношение следует декомпозировать на два отношения: </p>
<center><strong>R1</strong> </center>
<table>
    <tbody>
    <tr>
        <th>Филиал компании</th>
        <th>Должность</th>
        <th>Зарплата</th>
    </tr>
    <tr>
        <td>Филиал в Томске</td>
        <td>Уборщик</td>
        <td>20000</td>
    </tr>
    <tr>
        <td>Филиал в Москве</td>
        <td>Программист</td>
        <td>40000</td>
    </tr>
    <tr>
        <td>Филиал в Томске</td>
        <td>Программист</td>
        <td>25000</td>
    </tr>

    </tbody>
</table>
<center><strong>R2</strong> </center>
<table>
    <tbody>
    <tr>
        <th>Должность</th>
        <th>Наличие компьютера</th>
    </tr>
    <tr>
        <td>Уборщик</td>
        <td>Нет</td>
    </tr>
    <tr>
        <td>Программист</td>
        <td>Есть</td>
    </tr>
    <tr>
        <td>Программист</td>
        <td>Есть</td>
    </tr>
    </tbody>
</table>
<h2>3.4 Третья нормальная форма (3НФ, 3NF) </h2>
<p>Переменная отношения R находится в 3NF тогда и только тогда, когда выполняются следующие условия: </p>
<ul>
	<li><mark class="green">R</mark> находится во второй нормальной форме.</li>
	<li>ни один неключевой атрибут <mark class="green">R</mark> не находится в транзитивной функциональной зависимости от потенциального ключа <mark class="green">R</mark>. </li>
</ul>
<p>Пояснения к определению: </p>
<p>Неключевой атрибут отношения R — это атрибут, который не принадлежит ни одному из потенциальных ключей R. 
</p>
<p>Функциональная зависимость множества атрибутов Z от множества атрибутов X (записывается X → Z, произносится «икс определяет зет») является транзитивной, если существует такое множество атрибутов Y, что X → Y и Y → Z. При этом ни одно из множеств X, Y и Z не является подмножеством другого, то есть функциональные зависимости X → Z, X → Y и Y → Z не являются тривиальными, а также отсутствует функциональная зависимость Y → X. </p>
<p>Определение 3NF, эквивалентное определению Кодда, но по-другому сформулированное, дал Карло Заниоло в 1982 году. Согласно ему, переменная отношения находится в 3NF тогда и только тогда, когда для каждой из её функциональных зависимостей X → A выполняется хотя бы одно из следующих условий: </p>
<ul>
	<li>Х содержит А (то есть X → A — тривиальная функциональная зависимость) </li>
	<li>Х — суперключ</li>
	<li>А — ключевой атрибут (то есть А входит в состав потенциального ключа).</li>
</ul>
<p>Определение Заниоло чётко определяет разницу между 3NF и более строгой нормальной формой Бойса-Кодда (НФБК): НФБК исключает третье условие («А — ключевой атрибут»). </p>
<p>Запоминающееся и, по традиции, наглядное резюме определения 3NF Кодда было дано Биллом Кентом: каждый неключевой атрибут «должен предоставлять информацию о ключе, полном ключе и <strong>ни о чём, кроме ключа</strong>». </p>
<p>Условие зависимости от «полного ключа» неключевых атрибутов обеспечивает то, что отношение находится во второй нормальной форме; а условие зависимости их от «ничего, кроме ключа» — то, что они находятся в третьей нормальной форме. </p>
<p>Крис Дейт говорит о резюме Кента как об «интуитивно привлекательной характеристике» 3NF, и замечает, что с небольшим изменением она может служить и как определение более строгой нормальной формы Бойса-Кодда: «каждый атрибут должен предоставлять информацию о ключе, полном ключе и ни о чём, кроме ключа».  </p>
<p>Вариант определения 3NF Кента является менее строгим, чем вариант нормальной формы Бойса-Кодда в формулировке Дейта, поскольку первая утверждает только то, что неключевые атрибуты зависят от ключей. </p>
<p>Первичные атрибуты (которые являются ключами или их частями) вовсе не должны быть функционально зависимыми; каждый из них предоставляет информацию о ключе предоставлением самого ключа или его части. Здесь следует отметить, что это правило справедливо только для неключевых атрибутов, так как применение его ко всем атрибутам будет полностью запрещать все сложные альтернативные ключи, поскольку каждый элемент такого ключа будет нарушать условие «полного ключа». </p>
<p>Рассмотрим в качестве примера переменную отношения R1: </p>
<center><strong>R1</strong> </center>
<table>
    <tbody>
    <tr>
        <th>Сотрудник </th>
        <th>Отдел </th>
        <th>Телефон </th>
    </tr>
    <tr>
        <td>Гришин </td>
        <td>Бухгалтерия </td>
        <td>11-22-33</td>
    </tr>
    <tr>
        <td>Васильев</td>
        <td>Бухгалтерия</td>
        <td>11-22-33</td>
    </tr>
    <tr>
        <td>Петров</td>
        <td>Снабжение</td>
        <td>44-55-66</td>
    </tr>
    </tbody>
</table>

<p>Каждый сотрудник относится исключительно к одному отделу; каждый отдел имеет единственный телефон. Атрибут Сотрудник является первичным ключом. Личных телефонов у сотрудников нет, и телефон сотрудника зависит исключительно от отдела. </p>
<p>В примере существуют следующие функциональные зависимости: Сотрудник → Отдел, Отдел → Телефон, Сотрудник → Телефон. </p>
<p>Переменная отношения R1 находится во второй нормальной форме, поскольку каждый атрибут имеет не приводимую функциональную зависимость от потенциального ключа Сотрудник. </p>
<p>Зависимость Сотрудник → Телефон является транзитивной, следовательно, отношение не находится в третьей нормальной форме. </p>
<p>В результате разделения R1 получаются две переменные отношения, находящиеся в 3NF: </p>
<center><strong>R2</strong> </center>
<table>
    <tbody>
    <tr>
        <th>Отдел </th>
        <th>Телефон </th>
    </tr>
    <tr>
        <td>Бухгалтерия </td>
        <td>11-22-33</td>
    </tr>
    <tr>
        <td>Снабжение</td>
        <td>44-55-66</td>
    </tr>
    </tbody>
</table>
<hr>
<center><strong>R3</strong> </center>
<table>
    <tbody>
    <tr>
        <th>Сотрудник </th>
        <th>Отдел </th>
    </tr>
    <tr>
        <td>Гришин </td>
        <td>Бухгалтерия </td>
    </tr>
    <tr>
        <td>Васильев</td>
        <td>Бухгалтерия</td>
    </tr>
    <tr>
        <td>Петров</td>
        <td>Снабжение</td>
    </tr>
    </tbody>
</table>
<p>Исходное отношение R1 при необходимости легко получается в результате операции соединения отношений R2 и R3.</p>
