Настройка уровней логирования
<p>----------------------------------------</p>
Список уровней логирования
Пример настройки лога
Популярные ошибки в логировании
<p>----------------------------------------</p>
<h2>4.1 Список уровней логирования</h2>
<p>Вы написали свою программу, залили ее на сервер и тут у вас сразу начинают появляться вопросы:</p>
<ul>
    <li>Как сделать так, чтобы <code>debug()</code> метод не отрабатывал во время работы в <code>production</code>?</li>
    <li>В логах слишком много информации, хотелось бы оставить только сообщения об ошибках?</li>
    <li>Как увидеть детальный лог по одной части приложения?</li>
</ul>
<p>Разумеется, создатели логов столкнулись с тем же самым еще десятки лет назад. Не буду рассказывать, как эту проблему решили в языке C, но в языке Java ее решили очень красиво.</p>
<p><strong>Лог фильтрует данные, перед тем как записывать информацию в файл</strong>. Можно очень быстро снизить/увеличить детализацию лога с помощью настройки уровня логирования. Эти уровни описаны в таблице ниже:</p>
<table>
    <tbody>
    <tr>
        <th></th>
        <th width="200">Уровень</th>
        <th>Примечание</th>
    </tr>
    <tr>
        <td>1</td>
        <td><strong>ALL</strong></td>
        <td>Писать в лог все сообщения</td>
    </tr>    
    <tr>
        <td>2</td>
        <td><strong>TRACE</strong></td>
        <td>Мелкое сообщение при отладке</td>
    </tr>
    <tr>
        <td>3</td>
        <td><strong>DEBUG</strong></td>
        <td><strong>Сообщения важные при отладке</strong></td>
    </tr>
    <tr>
        <td>4</td>
        <td><strong>INFO</strong></td>
        <td><strong>Простые сообщения</strong></td>
    </tr>    
    <tr>
        <td>5</td>
        <td><strong>WARN</strong></td>
        <td><strong>Писать только fatal, error и warning</strong></td>
    </tr>    
    <tr>
        <td>6</td>
        <td><strong>ERROR</strong></td>
        <td><strong>Писать только ошибки и фатальные ошибки</strong></td>
    </tr>    
    <tr>
        <td>7</td>
        <td><strong>FATAL</strong></td>
        <td><strong>Писать только фатальные ошибки</strong></td>
    </tr>   
    <tr>
        <td>8</td>
        <td><strong>OFF</strong></td>
        <td>Не писать в лог сообщения</td>
    </tr>

    </tbody>
</table>
<p>Эти уровни используются при фильтрации сообщений. Если выставить уровень логирования в <code>WARN</code>, то все сообщения, менее важные, чем <code>WARN</code> будут отброшены: <code>TRACE</code>, <code>DEBUG</code>, <code>INFO</code>. Если выставить уровень фильтрации в <code>FATAL</code>, то будут отброшены даже <code>ERROR’ы</code>.</p>
<p>Есть еще два уровня важности, которые используются при фильтрации – это <code>OFF</code> (отбросить все сообщения) и <code>ALL</code> – писать все сообщения (не отбрасывать ничего).</p>
<h2>4.2 Пример настройки лога</h2>
<p>Давайте рассмотрим простой пример настройки лога. Для этого нам понадобится файл log4j.properties, который можно разместить в папке resources. Добавим в него такое содержание:</p>
<pre class='language-java line-numbers'><code>
# Root logger option
log4j.rootLogger=<span class="text-yellow">WARN</span>, <span class="text-red">stdout</span>
 
# Direct log messages to stdout
log4j.appender.<span class="text-red">stdout</span>=org.apache.log4j.<span class="text-green">ConsoleAppender</span>
log4j.appender.<span class="text-red">stdout</span>.Target=<span class="text-green">System.out</span>
log4j.appender.<span class="text-red">stdout</span>.layout=<span class="text-user">org.apache.log4j.PatternLayout</span>
log4j.appender.<span class="text-red">stdout</span>.layout.ConversionPattern=<span class="text-user">%d{yyyy-MM-dd HH:mm:ss}</span>
</code></pre>
<p>Вот тут в самой первой строке мы и задаем уровень логирования – <code><span class="text-yellow">WARN</span></code>. А это значит, что сообщения, которые пишутся в логгер со статусом <code>DEBUG</code> и <code>INFO</code> будут проигнорированы.</p>
<ul>
    <li>Указываем какой тип аппендера будем использовать – <code>ConsoleAppender</code></li>
    <li>Указываем, куда будем писать лог – <code>System.out</code></li>
    <li>Задаем класс, который будет управлять форматом записи – <code>PatternLayout</code></li>
    <li>Задаем формат записи для всех сообщений – дата и время</li>
</ul>
<h2>4.3 Популярные ошибки в логировании</h2>
<p>И еще один важный момент – популярные ошибки в логировании. Вариантом что-то сделать не так много, но можно выделить несколько частых ошибок:</p>
<ol>
    <li><strong>Избыток логирования</strong>. Не стоит логировать каждый шаг, который чисто теоретически может быть важным. Есть правило: <strong>логи могут нагружать работоспособность не более, чем на 10%</strong>. Иначе будут проблемы с производительностью.</li>
    <li><strong>Логирование всех данных в один файл</strong>. Это приведет к тому, что в определенный момент чтение/запись в него будет очень сложной, не говоря о том, что есть ограничения по размеру файлов в определенных системах.</li>
    <li><strong>Использование неверных уровней логирования</strong>. У каждого уровня логирования есть четкие границы, и их стоит соблюдать. Если граница расплывчатая, можно договориться какой из уровней использовать.</li>
</ol>
