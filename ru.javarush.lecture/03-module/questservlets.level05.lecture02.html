Уровни событий
<p>----------------------------------------</p>
Список уровней событий
DEBUG
INFO и WARN
ERROR и FATAL
Что нужно логировать
<p>----------------------------------------</p>
<h2>3.1 Список уровней событий</h2>
<p>Логирование – это процесс записи каких-либо событий, которые происходят во время работы программы. Ваша обязанность как программиста — <code>запротоколировать все важное</code>, потому что потом, когда на <code>production</code> будут странные и/или серьезные ошибки, кроме этих логов у вас больше ничего не будет.</p>
<p>Любая ошибка будет устранена в разы быстрее, если у вас будет вся информация о ней и обо всех предысториях вызовов. Но отсюда следует простой вывод – логировать вообще все: вызовы всех методов, значения всех параметров.</p>
<p>Это тоже не выход – слишком много информации так же плохо, как и слишком мало. Нам нужно умное логирование. Сделанное человеком для человека. И тут мы подходим к первому факту про логирование – все записи в лог еще во время их создания делятся на категории.</p>
<img width="800" src="https://cdn.javarush.com/images/article/92ef34aa-e120-4aa9-815a-0c7a771c2457/original.jpeg" alt=" Список уровней событий">
<p>Программист, когда пишет какое-нибудь событие в лог, должен сам решить, насколько это важная информация. Уровень важности события выбирает автор сообщения. В <code>log4j</code> существует 5 уровней важности логируемой информации:</p>
<ul>
    <li><code>DEBUG</code></li>
    <li><code>INFO</code></li>
    <li><code>WARN</code></li>
    <li><code>ERROR</code></li>
    <li><code>FATAL</code></li>
</ul>
<p>Ниже расскажем о них подробнее.</p>
<h2>3.2 DEBUG</h2>
<p>Уровень <code>DEBUG</code> считается наименее важным. Информация, которая пишется в лог с таким уровнем важности, нужна только во время дебага приложения. Для того чтобы записать в лог информацию нужную во время дебага используется метод <code>debug()</code>.</p>
<p>Пример:</p>
<pre class='language-java line-numbers'><code>
class Manager {
    private static final Logger logger = LoggerFactory.getLogger(Manager.class);

    public boolean processTask(Task task) {
        logger.debug("processTask id = " + task.getId());
        try {
            task.start();
            task.progress();
            task.complete();
            return true;
        } catch (Exception e) {
            logger.error("Unknown error", e);
            return false;
        }
    }
}
</code></pre>
<p>Обрати внимание, метод <code>debug</code> находится в самом начале метода (метод еще не успел ничего сделать) и пишет в лог значение переданной в метод переменной. Это самый частый сценарий использования метода <code>debug()</code>.</p>
<h2>3.3 INFO и WARN</h2>
<p>Следующие два уровня – это <code>INFO</code> и <code>WARN</code>. Для них существуют два метода – <code>info()</code> и <code>warn()</code>.</p>
<p>Уровень <code>INFO</code> используется просто для информационных сообщений: происходит то-то и то-то. Когда начинаешь разбор ошибки в логе, бывает очень полезно почитать ее предысторию. Для этого отлично подходит метод <code>info()</code>.</p>
<p>Уровень <code>WARN</code> используется для записи предупреждений (от слова <strong>warning</strong>). Обычно с таким уровнем важности пишется информация о том, что что-то пошло не так, но программа знает, как поступить в данной ситуации.</p>
<p>Например, в процессе записи файла на диск, выяснилось, что такой файл уже существует. Тут программа может записать в лог предупреждение (warning), но показать пользователю диалоговое окно и предложить выбрать другое имя файла.</p>
<p>Пример:</p>
<pre class='language-java line-numbers'><code>
class FileManager {
    private static final Logger logger = LoggerFactory.getLogger(FileManager.class);

    public boolean saveFile(FileData file) {
        logger.info(“сохраняем файл ” + file.getName());
        boolean resultOK = SaveUtils.save(file);
        if (resultOK) return true;

        logger.warn(“проблема с записью файла ” + file.getName());
        String filename = Dialog.selectFile();
        boolean result = SaveUtils.save(file, filename);
        return result;
    }
</code></pre>
<h2>3.4 ERROR и FATAL</h2>
<p>И наконец два самых важных уровня логирования – <code>ERROR</code> и <code>FATAL</code>. Для них тоже есть специальные методы с одноименными названиями: <code>error()</code> и <code>fatal()</code>.</p>
<p>Ошибки тоже решили разделить на две категории – <span class="text-red">обычные ошибки</span> и <span class="text-red"><strong>фатальные ошибки</strong></span>. Фатальная ошибка чаще всего приводит к аварийному закрытию приложения (для десктопных приложений) или падению веб-сервиса (для веб-приложений).
</p>
<p>Еще хороший пример – это операционная система Windows. Если у тебя просто упала программа, то с точки зрения операционной системы – это <code>Error</code>. А если упала сама операционная система и вы видите синий экран смерти Windows, то это уже <code>Fatal error</code>.</p>
<p>В Java-приложениях чаще всего события <code>Error</code> и <code>Fatal</code> связаны с возникающими исключениями. Пример:</p>
<pre class='language-java line-numbers'><code>
class Manager {
    private static final Logger logger = LoggerFactory.getLogger(Manager.class);

    public boolean processTask(Task task) {
        logger.debug("processTask id = " + task.getId());
        try {
            task.start();
            task.progress();
            task.complete();
            return true;
        } catch (Exception e) {
<span class="text-red">            logger.error("Unknown error", e);</span>
            return false;
        }
    }
}
</code></pre>
<h2>3.5 Что нужно логировать</h2>
<p>Разумеется, логировать все подряд не стоит.  В большинстве случаев это резко ухудшает читабельность лога, а ведь лог пишется в первую очередь для того, чтобы его читали.</p>
<p>Кроме того, нельзя писать в лог различную личную и финансовую информацию. Сейчас с этим строго и легко можно нарваться на штрафы или судебные процессы. Рано или поздно такой лог утечет на сторону и тогда проблем на оберешься.</p>
<p><strong>Так что же нужно логировать?</strong></p>
<p>Во-первых, нужно логировать <strong>начало работы приложения</strong>. После того как приложение запустилось, рекомендуется вывести в лог его режим работы и различные важные настройки – так будет проще в будущем читать лог.</p>
<p>Во-вторых, нужно логировать <strong>состояние всех третьесторонних сервисов</strong>, с которыми твое приложение работает: системы рассылок, любые внешние сервисы. Как минимум нужно залогировать момент подключения к ним, чтобы убедиться, что они штатно работают.</p>
<p>В-третьих, логировать нужно <strong>все исключения</strong>. Если они ожидаемые, то информацию по ним можно записать компактно. Полная информация об исключениях дает 50%-80% важной информации при поиске ошибки.</p>
<p>Также нужно логировать <strong>завершение работы приложения</strong>. Приложение должно завершаться штатно и не сыпать при этом в лог десятки ошибок. Часто в этом месте можно найти подвисшие задачи, проблемы с пулом потоков или проблемы с удалением временных файлов.</p>
<p>Обязательно логируй то, что связано с <strong>безопасностью и авторизацией пользователя</strong>. Если пользователь 10 раз подряд пробует залогиниться или сбросить пароль, эта информация должна быть отражена в логах.</p>
<p>Логируй максимум <strong>информации об асинхронных задачах</strong> – часто исключения в таких потоках теряются. По асинхронной задаче обязательно логируй ее старт и завершение. Успешное завершение нужно логировать так же, как и проблемное.</p>
<p>Что еще? Запуск задач, выполняемых по таймеру, запуск хранимых <code>SQL-процедур</code>, синхронизацию данных, все, что касается распределенных транзакций. Думаю, для начала хватит. В будущем ты сам дополнишь этот список.</p>
<p></p>
<p></p>