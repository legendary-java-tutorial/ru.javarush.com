Машинный код и байт код: на каком языке говорит ваша программа?
<p>----------------------------------------</p>
У тех, кто только начинает знакомиться с Java, довольно часто возникает путаница в понятиях машинный и байт код. Что они собой представляют? В чём различия? В короткой заметке мы постараемся максимально  ...
<p>----------------------------------------</p>
У тех, кто только начинает знакомиться с Java, довольно часто возникает путаница в понятиях <em><strong>машинный</strong></em> и <em><strong>байт код</strong></em>. Что они собой представляют? В чём различия? В короткой заметке мы постараемся максимально просто и понятно расписать их особенности, чтоб раз и навсегда закрыть этот вопрос.
<div class="row justify-content-center jr-image-wrap"><div class="col-12 col-sm-10 col-md-8"><img data-id="64e4500b-028f-425d-a654-844765adae95" data-max-width="710" alt="Машинный код и байт код: на каком языке говорит ваша программа? - 1" src="https://cdn.javarush.com/images/article/64e4500b-028f-425d-a654-844765adae95/1024.jpeg"></div></div><h2 style="color:#cc2921">Машинный код</h2><em><strong>Процессор</strong></em> — это, по сути, очень сложный и продвинутый калькулятор. У него есть множество ячеек памяти (называемых регистрами) с которыми и между которыми проводятся различные математические и байтовые операции. Машинный код как раз и представляет собой описание последовательности выполнения операций и набора участвующих данных. По сути, это единственный язык, который понимает процессор вашего компьютера.
<h4>Врожденная несовместимость</h4>При этом далеко не все процессоры «говорят» на одном языке. Различия есть не только между архитектурами <em><strong>CISC</strong></em> и <em><strong>RISC</strong></em>, но и внутри этих «лагерей».
<table>
<tbody><tr>
<td>
<p><em><strong>CISC (англ. Complex Instruction Set Computing) — концепция проектирования процессоров, которая характеризуется следующим набором свойств:</strong></em></p>
<ul>
<li>много команд, разных по длине;</li>
<li>много режимов адресации;</li>
<li>сложная кодировка инструкции.</li>
</ul>
<em><strong>RISC (Reduced Instruction Set Computing)</strong></em> — процессор с сокращенным набором команд. Команды одного формата, короткие, с простой кодировкой. 
</td>
</tr>
</tbody></table>В новых поколениях процессоров внедряют дополнительные наборы инструкций, которые моделям старшего поколения попросту неизвестны. Из-за этого программы, скомпилированные для одной архитектуры (или одного поколения процессоров) не могут работать на другом аппаратном обеспечении.

Все это вынуждает заниматься перекомпиляцией программ для обеспечения их работы на других компьютерах. Впрочем, заново компилировать приходится не только из-за процессоров, но и еще из-за различий во взаимодействии программ и операционной системы. Именно из-за них невозможно запустить «виндовую» программу под Linux, а «линуксовую» под Windows.
<h2 style="color:#cc2921">Байт-код</h2>Байт-код во многом похож на машинный код, только он использует набор инструкций не реального процессора, а виртуального. При этом он может включать в себя участки, ориентированные на использование <em><strong>JIT-компилятора</strong></em>, оптимизирующего выполнение команд под реальный процессор, на котором запущена программа.
<table>
<tbody><tr>
<td>
<em><strong>JIT-компиляция</strong></em> (англ. Just-in-time compilation, компиляция «на лету») или <em><strong>динамическая компиляция</strong></em> (англ. dynamic translation) — это технология увеличения производительности программных систем, использующих байт-код, путём компиляции байт-кода в машинный код или в другой формат непосредственно во время работы программы. «Официально» в Java до 9-й версии был только JIT-компилятор. В Java 9 появился ещё один компилятор, причём компилирует он с опережением (AoT). Эта возможность позволяет компилировать классы Java в нативный код перед запуском на виртуальной машине. Данная функция предназначена для улучшения времени запуска и малых, и больших приложений, с ограниченным влиянием на максимальную производительность.
</td>
</tr>
</tbody></table>Для <em><strong>CISC</strong></em> процессоров некоторые инструкции могут объединяться в более сложные конструкции, поддерживаемые процессором, а для <em><strong>RISC</strong></em> – наоборот разбиваться на более простые последовательности команд.
<h4>Еще и виртуальная ОС</h4>Впрочем, байт код содержит не только процессорные инструкции. В нем также содержится логика взаимодействия с виртуальной операционной системой, которая делает поведение приложения независящим от используемой на компьютере операционной системы. Это отлично видно в <em><strong>JVM</strong></em>, где работа с системными вызовами и <em><strong>GUI</strong></em> зачастую не зависят от ОС, на которой запущена программа. По большому счету <em><strong>JVM</strong></em> эмулирует запуск процесса программы, в отличие от решений вроде <em><strong>Virtual Box</strong></em>, которые создают только виртуальную систему/железо.
<h3>JVM одна такая?</h3>Определенно нет. Тот же <em><strong>DotNet CLI</strong></em> это тоже виртуальная машина, которую чаще всего используют на компьютерах, работающих под <em><strong>Windows с x86</strong></em> совместимыми процессорами. Впрочем существует ее реализация и под другие системы: приложения под него должны работать в <em><strong>Windows RT</strong></em> запущенной на <em><strong>ARM (RISC)</strong></em> совместимых процессорах, или можно запустить их на <em><strong>Linux/OSX</strong></em> в среде <em><strong>Mono</strong></em>, являющей сторонней (и потому не полностью совместимой) реализацией <em><strong>DotNet</strong></em> для этих платформ. Так что эта платформа, как и <em><strong>JVM</strong></em>, работает на разных процессорах и разных ОС.

Существует еще множество похожих решений (как старых, так и новых): <em><strong>LLVM</strong></em>, <em><strong>Flash SWF</strong></em>, и другие. У некоторых языков программирования есть собственные виртуальные машины. К примеру, <em><strong>CPython</strong></em> компилирует исходники из <em><strong>PY</strong></em> в файлы <em><strong>PYC</strong></em> – скомпилированный (compiled) байт код который подготовлен к запуску в <em><strong>PVM</strong></em>. Или есть намного более древний пример — <em><strong>Lisp</strong></em> можно компилировать в файлы <em><strong>FASL</strong></em> (Fast Load). Фактически они содержат <em><strong>AST дерево</strong></em>, построенное генератором из исходного кода. Эти файлы могут быть прочитаны и запущены интерпретатором <em><strong>Lisp</strong></em> на разных платформах, или использованы для создания машинного кода для используемой на данный момент аппаратной архитектуры.
<table>
<tbody><tr>
<th><p>Что еще почитать:</p>
</th>
</tr>
<tr>
<td>
<p><a href="https://javarush.com/groups/posts/244-vopros-otvet-kak-v-java-praviljhno-konvertirovatjh-string-v-int--" target="_blank">Вопрос-ответ: как в Java правильно конвертировать String в int?</a></p>
<p><a href="https://javarush.com/groups/posts/278-samihe-rasprostranjennihe-problemih-tekh-kto-nachinaet-uchitjh-java" target="_blank">Самые распространённые проблемы тех, кто начинает учить Java</a></p>
</td>
</tr>
</tbody></table>