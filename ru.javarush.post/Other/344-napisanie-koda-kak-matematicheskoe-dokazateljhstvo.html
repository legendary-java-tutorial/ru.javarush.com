Написание кода как математическое доказательство
<p>----------------------------------------</p>
Споры о том, нужна программисту математика или нет, вероятно, не утихнут никогда. Существует миллион мнений за и против, но сегодня речь пойдет вовсе не об этом. Предлагаем вашему вниманию адаптированный перевод материала Спиро Сидериса (Spiro Sideris) в котором ...
<p>----------------------------------------</p>
Споры о том, нужна программисту математика или нет, вероятно, не утихнут никогда. Существует миллион мнений за и против, но сегодня речь пойдет вовсе не об этом. Предлагаем вашему вниманию адаптированный перевод <a href='https://hackernoon.com/writing-code-like-a-mathematical-proof-f5838fc27382' target='_blank'>материала Спиро Сидериса</a> (Spiro Sideris) в котором он рассуждает, как можно написать код программы, следуя логике математических доказательств.

<div class='row justify-content-center jr-image-wrap'><div class='col-12 col-sm-10 col-md-8'><img data-id="e87efef6-6020-4cf0-8a15-c6756ca1bdac" data-max-width="710" alt="Написание кода как математическое доказательство - 1" src="https://cdn.javarush.com/images/article/e87efef6-6020-4cf0-8a15-c6756ca1bdac/1024.jpeg"></div></div>
Когда я начинал программировать, мне всегда было интересно рассмотреть связь формальной математики и процесса написания кода. Из математики мы узнали, как нужно строить доказательства, то есть как, исходя из набора аксиом и определений, можно логически построить истинные утверждения, чтобы доказать некую гипотезу. После доказательства гипотеза становится теоремой и ее можно использовать для доказательства других гипотез. 

Такая цепочка доказательств и превращений из гипотез в теоремы чем-то похожа на последовательность шагов при разработке программного обеспечения. Мы начинаем с множества определений (условные операторы, циклы и так далее), а также ранее доказанных теорем (стандартные библиотеки, сторонние библиотеки и так далее). Затем пытаемся объединить эти элементы для решения своих задач. Сочетание утверждений в программном обеспечении выполняется буквально. Каждая строка компьютерного кода оценивается как логическая последовательность инструкций во время работы программы.

Следующая цитата из учебника по основам математического анализа описывает сравнение между написанием доказательств и эссе. Стивен Эббот, автор книги «Понимание анализа» пишет:

<table>
<tr>
<td>
«В каком-то роде, доказательство — это эссе. Это набор тщательно продуманных мыслей, которые при дальнейшем развитии должны полностью убедить читателя в истинности рассматриваемой проблемы. Для достижения этого результата, необходимо чтобы каждый шаг доказательства логически следовал из предыдущего или исходил из какого-либо другого набора ранее согласованных фактов. Помимо этого, все шаги доказательства должны быть согласованны между собой, чтобы доказательство было неоспоримо».
</td>
</tr>
</table>
Именно это сравнение построения доказательств и написания эссе лежит в основе моего представления об аналогии между написанием доказательств и написанием кода. Прежде, чем мы начнем, хочу пояснить, что я не пытаюсь убедить читателя «математизировать» код в духе Дональда Кнута. Я просто хочу использовать концепции построения хороших доказательств для написания качественного кода. В этом материале я опишу несколько полезных примеров доказательств, разбор которых, возможно, поможет улучшить код программы.

<div class='row justify-content-center jr-image-wrap'><div class='col-12 col-sm-10 col-md-8'><img data-id="cb520aa8-025d-47e2-91d3-31aea8b5cad1" data-max-width="710" alt="Написание кода как математическое доказательство - 2" src="https://cdn.javarush.com/images/article/cb520aa8-025d-47e2-91d3-31aea8b5cad1/1024.jpeg"></div></div>
Рассмотрим один из них. Предположим, нам необходимо доказать, что сумма двух последовательных целых чисел всегда нечётна. Как было указано раннее, мы будем стремиться комбинировать последовательность логических утверждений, начиная с определений или ранее доказанных теорем, для получения нашего доказательства. Рассмотрим пример.

<strong>Теорема</strong>

Если <em><strong>a</strong></em> и <em><strong>b</strong></em> — последовательные целые числа, то их сумма <em><strong>(a + b)</strong></em> — всегда является нечётным целым числом.

<strong>Доказательство</strong>

Допустим, <em><strong>a</strong></em> и <em><strong>b</strong></em> — последовательные целые числа. По определению нечетное число записывается как <em><strong>2k+1</strong></em>, где <em><strong>k</strong></em> – любое целое число.

Поскольку a <em><strong></strong></em>и b <em><strong></strong></em>являются последовательными числами, мы можем записать: <em><strong>b=a+1</strong></em>. Таким образом, их сумма <em><strong>(a + b)</strong></em> может быть записана как: 

<center>
<table style="width:30%">
<tr>
<td>
<center><p>a+b = a+(a+1) = a+a+1 = 2a+1</p></center>
</td>
</tr>
</table>
</center>
Так как <em><strong>a</strong></em> — целое число, следовательно, <em><strong>2a+1</strong></em> — нечетное число. Таким образом, и сумма <em><strong>(a + b) = 2a+1</strong></em> — нечетное число. Что и требовалось доказать.

<h2>Знай свою целевую аудиторию</h2>Разберем некоторые важные части нашего доказательства и некоторые предположения относительно вас, читателей этого материала. 

Во-первых, я предположил, что читатели этой статьи понимают, что такое целые числа (из-за того, что речь идет о программировании). 

Во-вторых, я предположил, что читателям будет удобно работать с алгеброй целых чисел (поскольку операции с целыми числами зачастую интуитивно понятны). 

<div class='row justify-content-center jr-image-wrap'><div class='col-12 col-sm-10 col-md-8'><img data-id="1cebdbce-cc7f-442d-ac5c-74683ef9e1d4" data-max-width="710" alt="Написание кода как математическое доказательство - 3" src="https://cdn.javarush.com/images/article/1cebdbce-cc7f-442d-ac5c-74683ef9e1d4/1024.jpeg"></div></div>
Но, вместо того, чтобы предположить, что читатель знает формальное определение нечетных целых чисел, я ввел его определение вместе с доказательством, чтобы обеспечить согласованный набор понятий между автором и читателями. С каждым следующим предположением и определением я создавал доказательство с использованием строго истинных утверждений и успешно доказал теорему.

Создание необходимых предположений об уровне аудитории всегда будет необходимым шагом при написании формального доказательства, поскольку это можно сделать по-разному. Например, если предположить, что читатели изначально знали формальные определения четных и нечетных чисел, я мог бы их не приводить в тексте, и тогда доказательство выглядело бы очень коротким. Вместо этого, я предположил, что кто-то из моих читателей не посещал занятий по математике, или это было так давно, что он уже забыл все определения.

Хороший автор, неважно идет речь о написании математического доказательства или остросюжетного романа, всегда должен понимать, для кого он пишет, какие люди станут его целевой аудиторией. 

Если речь идёт об учебнике по основам математики для младшей школы, то материал будет восприниматься легче, если указать в нем основные определения.

Если же речь идет о статье в специализированный математический журнал, автор, разумеется, может опустить элементарные определения, по праву полагая, что его целевой аудиторией являются специалисты в данной области. 

Понимание целевой аудитории поможет правильно сформулировать доказательство и донести его читателям.

Мы можем построить похожую схему не только при составлении доказательств, но также при написании программного обеспечения. Когда большинство разработчиков пишет программу, в основном они стараются написать исполняемый код. Однако если код выполняется, это не гарантирует его читабельности и понятности. Скорее всего, вы прекрасно разберётесь в своей (или чужой) небольшой программке. Но что, если вам придётся разбираться в тоннах чужого кода в миллион строк? Чтобы написать понятный код, всегда задавайте вопрос о том, кто ваша целевая аудитория. Каков их уровень подготовки? Какими базовыми знаниями они должны обладать, чтобы прочитать написанную вами функцию. 

<div class='row justify-content-center jr-image-wrap'><div class='col-12 col-sm-10 col-md-8'><img data-id="b7720130-7be5-4807-acce-886ed84a8885" data-max-width="710" alt="Написание кода как математическое доказательство - 4" src="https://cdn.javarush.com/images/article/b7720130-7be5-4807-acce-886ed84a8885/1024.jpeg"></div></div>
Кроме того, существуют различия в семантике между языками программирования, поэтому знание лучших практик и стилей языков программирования, гарантируют, что ваш код получится легко читаемым для разработчиков, специализирующихся в этом языке программирования.

Когда вы собираетесь писать следующую функцию, помните о словах, которые вы используете для описания ваших переменных и методов. Например, если вы назовёте переменную <em><strong>minimum</strong></em> для обозначения минимальной границы некоего множества, большинство поймёт, что вы имеете в виду. А вот при использовании для той же переменной более специфическое, хоть и правильное, <em><strong>infimum</strong></em>, вас поймут либо математики, либо те, кто недавно изучал начала анализа. 

Обратите внимание на то, как вы структурируете свои комментарии и код. Создание руководства по стилю проекта или соблюдение уже существующего руководства, также поможет облегчить понимание вашего кода и «джунам», и опытным разработчикам. Если вы будет следовать этому принципу, ваш код будет легко читаться и уменьшит усилия ваших последователей, которые будут также разбираться в вашем коде. 

<h2>Пишите четко и кратко</h2>Сегодня во время написания кода мы имеем возможность проверять код с помощью встроенных в IDE и текстовые редакторы инструментов. В случае нарушения валидности, хорошая IDE выдаст нам ошибку компиляции или исключение <em><strong>во время выполнения</strong></em> (runtime exception). Конструирование доказательств, увы, не предполагают таких проверок.

Проверять доказательство математика на валидность будет читатель или студент. Чтобы убедить читателя в верности полученного результата, автор доказательства должен его сформулировать наиболее понятным и кратким образом. Долгие и бессвязные размышления о сущности бытия не смогут донести до читателя смысл доказательства.

<div class='row justify-content-center jr-image-wrap'><div class='col-12 col-sm-10 col-md-8'><img data-id="7e3a7b33-b8c1-4fe3-a063-1942d8d1cb5a" data-max-width="710" alt="Написание кода как математическое доказательство - 5" src="https://cdn.javarush.com/images/article/7e3a7b33-b8c1-4fe3-a063-1942d8d1cb5a/1024.jpeg"></div></div>
Я предлагаю писать код так, чтоб он не просто был исполнимым, но также был прозрачным — убеждал читателя в истинности утверждений. Как и хорошее доказательство, код должен быть написан внимательно и тщательно. Мы должны обязательно сократить избыточные данные, которые не дают читателю дополнительную выгоду, а только запутывают его. 

Зачем писать сто строк кода, если для выполнения задачи достаточно восемьдесят, шестьдесят или еще меньше? Мертвый код, как и мертвые фразы, чрезмерно напрягают читателя. Чаще всего решение проблемы займет много времени и сил. Вернитесь и попытайтесь отредактировать написанное вами, упростив его для понимания.

При этом я не призываю вас «уменьшить количество кода» во всем проекте. Крайности не уместны, и в этом случае они также принесут больше вреда, чем пользы. Иногда создание новой, потенциально избыточной переменной, может, наоборот, упростить код для понимания.

<h2>Проверьте все варианты</h2>Очень часто доказательство гипотез начинается с использования частного примера, а затем происходит перенос на общий случай. В приведённой выше теореме о последовательных числах мы можем взять для проверки два целых последовательных числа 2 и 3, действительно, их сумма 5 нечетное число. Используя этот пример, мы можем экстраполировать и посмотреть, как данный шаблон применяется далее.

Конечно, мы ищем общее решение, но это не означает, что мы не можем использовать практические примеры для получения необходимого результата. Однако, сосредоточив свое внимание только на практических примерах, мы можем допустить ошибку. Иногда мы можем забыть проверить конкретный случай, который нарушает общее решение. В нашем примере мы рассмотрели два положительных целых числа. А как же отрицательные числа? Что будет если мы используем нейтральный элемент (в случае с <em><strong>integer</strong></em>, это <em><strong>0</strong></em>)?

К счастью, в данном конкретном примере доказательство останется верным и для отрицательных чисел, и для нейтрального элемента. К сожалению, это не всегда так. 

<div class='row justify-content-center jr-image-wrap'><div class='col-12 col-sm-10 col-md-8'><img data-id="41e377f8-340a-4196-96d3-7a0e29706a51" data-max-width="710" alt="Написание кода как математическое доказательство - 6" src="https://cdn.javarush.com/images/article/41e377f8-340a-4196-96d3-7a0e29706a51/1024.jpeg"></div></div>
Простой школьный пример. Предположим, нам необходимо доказать, что каждый квадратный корень целого числа существует в действительных числах. Если вы пробовали взять для примера √2, √4 или даже √0, то считаете, что результат верен. Однако, что же будет если мы попробуем найти квадратный корень любого отрицательного числа?

Фактически, математикам пришлось создать целый новый набор чисел — комплексных чисел — чтобы найти квадратные корни отрицательных целых чисел. Включив в рассмотрение, казалось бы, простой вариант отрицательных чисел, история математики изменилась. И это далеко не единственный случай, когда математика расширялась, дабы соответствовать новым требованиям.

В программном обеспечении варианты, при которых программа работает иначе, мы выделяем в группу частных случаев и называем их <em><strong>edge case</strong></em> (краевые случаи). Разработчики программного обеспечения регулярно сталкиваются с такими краевыми случаями, особенно при написании функции, которая вводит пользовательский ввод: необходимо обеспечить её работоспособность, если пользователь не ввёл данных, или ввёл их слишком много, или эти данные не такие, как ожидалось… Фантазия иных пользователей безгранична. Инженеры-программисты регулярно жалуются на краевые случаи и многие из них ими пренебрегают, что приводит к сбоям в работе программы. Хотя при именовании краевых случаев, мы пытаемся обозначить их как «редкие», на практике они встречаются не так уж и редко, и их обязательно нужно учитывать.

<strong>Разработчики не всегда обрабатывают краевые случаи в своих предложениях, и вот почему: </strong>

<ol>
<li>Они не учли краевой случай, поскольку не знают, что такой вариант возможен;</li>
<li>Они знают, что такой вариант возможен, но не пишут код, который с ним взаимодействует.</li>
</ol>
Первый пункт относится к ряду трудноразрешимых задач. Тем не менее, как у математиков есть рецензенты доказательств, у разработчиков есть <em><strong>code review</strong></em> (обзор кода, в русскоязычных странах обычно так и говорят — код ревью) для проверки тестовых примеров.

<div class='row justify-content-center jr-image-wrap'><div class='col-12 col-sm-10 col-md-8'><img data-id="8b63f30b-09ea-4f8f-be25-2e724b26cd16" data-max-width="710" alt="Написание кода как математическое доказательство - 7" src="https://cdn.javarush.com/images/article/8b63f30b-09ea-4f8f-be25-2e724b26cd16/1024.jpeg"></div></div>
Существуют способы тестирования кода с помощью модульных тестов, интеграционных тестов или проверки модели, например, <em><strong>TLA+</strong></em>. Кроме того, нам часто помогает личный опыт, чтобы заранее узнать дополнительную информацию о вариантах потенциальных тестов. Чем больше программ вы пишете, тем чаще вам придется сталкиваться с такими случаями, и ваши знания могут быть использованы в более поздних разработках.

Возвращаясь к нашим двум причинам, замечу, что если первый пункт — это проблема незнания, то второй — куда более коварен. Это происходит, если разработчик знает о возможности возникновения краевого случая, но не пытается разобраться с вариантами защиты от него. Это может быть связано либо с ограничением сроков проекта, спешкой или обычной ленью. Каждая попытка рационализации связана с необходимостью увеличить количество времени для работы над проектом или куском кода с ошибкой. Чего в принципе не должно быть в других случаях.

Мало того, что это плохо отражается на программном обеспечении, которое вы создаете, логически неверно игнорировать такие случаи. И хотя я понимаю чувства разработчика, которому необходимо затратить дополнительное время для поиска новой проблемы, я считаю, что нельзя сидеть сложа руки пока проблема не будет решена. 

<table>
<tr>
<td>
Подобно учёному, который должен создать совершенно новый раздел математики, введя отрицательные целые числа, хороший разработчик должен потратить свое время для разрешения edge cases или краевых случаев в своей программе. 
</td>
</tr>
</table>
Если разработчик создаст тесты, которые учтут краевые случаи, он получит сильный код, который будет работать чётко, как верное доказательство математической теоремы. 

<h2>Подведем итоги</h2>В данном материале я постарался найти три наиболее подходящих соответствия между написанием математических доказательств и написанием программного кода. Конечно, эти три варианта не единственны, но мне кажется они наиболее полезны для написания программы. 

<div class='row justify-content-center jr-image-wrap'><div class='col-12 col-sm-10 col-md-8'><img data-id="c1ca2cc3-7ad6-4cf5-bfa8-d1578dd0ed2d" data-max-width="710" alt="Написание кода как математическое доказательство - 8" src="https://cdn.javarush.com/images/article/c1ca2cc3-7ad6-4cf5-bfa8-d1578dd0ed2d/1024.jpeg"></div></div>
Мир математики и мир программирования находятся куда ближе друг от друга, чем кажется большинству людей. И изучение математики может вам помочь в будущем программировать лучше. Если тема этой статьи показалась вам интересной, возможно, стоит попробовать открыть простейшую книгу о доказательствах и прошерстить её. Надеюсь, что удовольствие от доказанной с нуля теоремы, для вас, как и для меня, будет сравнимо с удовольствием от написания хорошей программы.

<table>
<tr>
<th><p>Что еще почитать:
</p>
</th>
</tr>
<tr>
<td><p><a href='https://javarush.com/groups/posts/287-programmirovanie--ehto-slozhno-imenno-poehtomu-stoit-ego-izuchatjh' target='_blank'>Программирование — это сложно. Именно поэтому стоит его изучать</a></p>
<p><a href='https://javarush.com/groups/posts/285-to-speak-or-not-to-speak-kak-aytishniku-vihuchitjh-angliyskiy' target='_blank'>To speak or not to speak? Как айтишнику выучить английский</a></p>
<p><a href='https://javarush.com/groups/posts/32-ehmpatija-kak-sekretnaja-supersila-razrabotchika-' target='_blank'>Эмпатия как секретная суперсила разработчика</a></p>
</td>
</tr>
</table>