UML: от теории к практике
<p>----------------------------------------</p>
Порой сложно понять, как должна выглядеть так или иная функция, которую вы разрабатываете. Из скольки классов состоять, какие между ними отношения должны быть? Чтобы лучше справиться с этим нужно взглянуть на общую картину сверху. И в этом нам поможет UML.
<p>----------------------------------------</p>
<h2>Вступление</h2>Я думаю, каждый слышал в детстве такую поговорку как "<em>Семь раз отмерь, один раз отрежь</em>". В программировании так же. Лучше всегда обдумать реализацию до того, как вы потратите время на её исполнение. Часто приходится при реализации создавать классы, придумывать их взаимодействие. И часто визуальное представление этого может помочь решить задачу наиболее правильным образом. В этом нам и помогает <strong>UML</strong>.<h2>Что такое UML?</h2><div><p>Если посмотреть картинки в поисковых системах, то станет понятно, что <strong>UML</strong> – это что-то про схемы, стрелочки и квадратики.
Что важно, что UML переводится как <em>Unified Modeling Language</em>. Важно тут слово Unified. То есть наши картинки поймём не только мы, но и остальные, кто знает UML. Получается это такой международный язык рисования схем.</p><img data-id="acc16872-33f2-44c6-8f32-2d0aeb63c28d" data-max-width="800" alt="UML: от теории к практике - 1" src="https://cdn.javarush.com/images/article/acc16872-33f2-44c6-8f32-2d0aeb63c28d/1024.jpeg"></div><p align="right">Как гласит Википедия</p><blockquote>UML — это язык графического описания для объектного моделирования в области разработки программного обеспечения, моделирования бизнес-процессов, системного проектирования и отображения организационных структур.</blockquote>
Самое интересное, о чём не все задумываются или догадываются, UML имеет спецификации. Причём даже есть спецификация UML2. Подробнее со спецификацией можно ознакомиться на сайте <a href="https://www.omg.org/spec/UML/About-UML/" target="_blank" rel="nofollow">Object Management Group</a>. Собственно, эта группа и занимается разработкой спецификаций UML.

Интересно и то, что UML не ограничивается описанием структуры классов. Существует множество типов UML диаграмм. 

Краткое описание типов UML диаграмм можно увидеть в той же Википедии: <a href="https://ru.wikipedia.org/wiki/UML#Диаграммы" target="_blank" rel="nofollow">UML - диаграммы</a> или в видео Тимура Батыршинова <a href="https://www.youtube.com/watch?v=moMkpX9uSns" target="_blank" rel="nofollow">Обзор UML диаграмм</a>. UML так же широко применяется при описании различных процессов, например здесь: <a href="https://www.ispring.ru/articles/ediniy-vhod-s-ispolzovaniem-jwt.html" target="_blank" rel="nofollow">Единый вход с использованием JWT</a>.

Возвращаясь к использованию UML диаграмм классов, стоит отметить книгу <a href="https://goo.gl/gBRkMY" target="_blank" rel="nofollow">Head First : Паттерны проектирования</a>, в которой паттерны иллюстрируются теми самыми UML диаграммами. Выходит, что UML действительно используется. И выходит, что знание и понимание его применения довольно полезный навык.
<h2>Применение</h2>Разберём, как с этим самым UML можно работать из IDE. В качестве IDE возьмём <em>IntelliJ Idea</em>. Если использовать <strong>IntelliJ Idea Ultimate</strong>, то у нас "из коробки" будет установлен плагин "<strong>UML Support</strong>". Он позволяет автоматически генерировать красивые диаграммы классов.

Например, через Ctrl+N или пункт меню "Navigate" -&gt; "Class" перейдём в класс <strong>ArrayList</strong>. Теперь, через контекстное меню по имени класса выберем "Diagram" -&gt; "Show diagram popup".

В результате мы получим красивую диаграмму:
<div class="row justify-content-center jr-image-wrap"><div class="col-12 col-sm-10 col-md-8"><img data-id="d1dd2cd5-f20a-4742-a780-a78415016940" data-max-width="627" alt="UML: от теории к практике - 2" src="https://cdn.javarush.com/images/article/d1dd2cd5-f20a-4742-a780-a78415016940/1024.jpeg"></div></div>Но что, если хочется самому нарисовать, да ещё и нет Ultimate версии Idea? Если мы используем IntelliJ Idea Community Edition, то у нас нет другого выбора. Для этого нужно понять, как такая UML схема устроена.

Для начала нам понадобится установить <a href="https://graphviz.gitlab.io/download/" target="_blank" rel="nofollow">Graphviz</a>. Это набор утилит для визуализации графов. Его использует плагин, который мы будем применять.

После установки необходимо добавить каталог <em>bin</em> из каталога установленного <em>Graphviz</em> в переменную среды окружения <em>PATH</em>.

После этого в IntelliJ Idea в меню выбрать File -&gt; Settings. В окне "Settings" выбрать категорию "Plugins", нажать кнопку "Browse repositories" и установить плагин <a href="https://plugins.jetbrains.com/plugin/7017-plantuml-integration" target="_blank" rel="nofollow">PlantUML integration</a>. 

Чем так хорош этот <em>PlantUML</em>? Он использует для описания UML язык описания графов под названием "<strong>dot</strong>" и это позволяет ему быть более универсальным, т.к. данный язык используется не только PlantUML. Более того, всё что мы ниже сделаем мы можем выполнить не только в IDE, но и в онлайн сервисе <a href="https://www.planttext.com" target="_blank" rel="nofollow">planttext.com</a>.

После установки плагина PlantUML у нас появится возможность через "File" -&gt; "New" создавать UML диаграммы. Давайте выполним создание диаграммы типа "UML class".

В ходе этого автоматически генерируется шаблон с примером. Удалим его содержимое и создадим своё, вооружившись статьёй с Хабра: <a href="https://habr.com/post/150041/" target="_blank" rel="nofollow">Отношения классов — от UML к коду</a>. А чтобы понять, как это изобразить в тексте, возьмём мануал по PlantUML: <a href="http://plantuml.com/class-diagram" target="_blank" rel="nofollow">plantuml class-diagram</a>. В нём в самом начале представлена табличка с тем, как нужно описывать связи:
<div class="row justify-content-center jr-image-wrap"><div class="col-12 col-sm-10 col-md-8"><img data-id="b9a03ed5-85f6-422c-91d5-7db479acc747" data-max-width="263" alt="UML: от теории к практике - 3" src="https://cdn.javarush.com/images/article/b9a03ed5-85f6-422c-91d5-7db479acc747/1024.jpeg"></div></div>Про сами же связи можем ещё подсматривать сюда: "<a href="http://deryabych.narod.ru/6/7.html" target="_blank" rel="nofollow">Отношения между классами в UML. Примеры</a>".

На основе этих материалов приступим к созданию нашей UML диаграммы. Добавим следующее содержимое, описывающее два класса:

<pre class="line-numbers"><code>
@startuml
class ArrayList {
}
class LinkedList {
}
@enduml
</code></pre>
Чтобы увидеть результат в Idea, выберем "View" -&gt; "Tool Windows" -&gt; "PlantUML". Мы получим просто два квадрата, обозначающие классы.

Как мы знаем, оба эти класса реализуют интерфейс List. Данное отношение классов так и называют — реализация (realization). Для изображения такой связи используют стрелку с пунктирной линией. Изобразим её:

<pre class="lang-java line-numbers"><code>
interface List
List &lt;|.. ArrayList
List &lt;|.. LinkedList
</code></pre>
<code>List</code> — один из дочерних классов <code>Collection</code>. То есть он наследуется от Collection. Эта связь называется обобщением (generalization). Выглядит как стрелка с обычной непрерывной линией. Изобразим её:

<pre class="lang-java line-numbers"><code>
interface Collection
Collection &lt;|-- List
</code></pre>
Для следующего типа связи добавим в описание класса <code>ArrayList</code> запись о <em>package private</em> массиве элементов:

<pre class="lang-java line-numbers"><code>
~Object[] elementData
</code></pre>
Теперь мы хотим показать, что <code>ArrayList</code> содержит какие-то объекты. В данном случае будет тип связи — <em>агрегация</em> (aggregation).

Агрегатом в данном случае является <code>ArrayList</code>, т.к. он содержит другие объекты. Агрегацию мы выбираем потому, что объекты в списке могут жить и без списка: они не являются его неотъемлемыми частями. Их время жизни не привязано к времени жизни списка. Агрегат с латинского переводится как "собранный", то есть что-то, составленное из чего-то. Например, в жизни, есть насосный агрегат, который состоит из насоса и двигателя. Сам агрегат можно разобрать, оставив что-то из его составных частей. Например, чтоб продать или поставить в другой агрегат. Так и в списке. И выражается это в виде пустого ромбика у агрегата и непрерывной линии. Изобразим это следующим образом:

<pre class="lang-java line-numbers"><code>
class Object{
}
ArrayList o- Object
</code></pre>
Теперь мы хотим показать, что в отличие от <code>ArrayList</code>, класс <code>LinkedList</code> содержит в себе <code>Node</code> — контейнеры, ссылающиеся на хранимые данные. В данном случае <code>Node</code> являются частью самого <code>LinkedList</code> и не могут жить отдельно. <code>Node</code> не является непосредственнохранимым содержимым, а только содержит ссылку на него. Например, когда мы добавляем в <code>LinkedList</code> какую-нибудь строку, мы добавляем новый <code>Node</code>, который содержит ссылку на эту строку, а также ссылку на предыдущий и следующий <code>Node</code>.

Такой тип связи называется <em>композицией</em> (Composition). Для отображения у композита (того, кто состоит из частей) рисуется закрашенный робмик, к нему ведёт непрерывная линия. Запишем теперь это в виде текстового отображения связи:

<pre class="lang-java line-numbers"><code>
class Node{
}
LinkedList *-- Node
</code></pre>
И теперь необходимо научиться отображать ещё один важный тип связи — <em>зависимость</em> (dependency relationship). Он используется тогда, когда один класс использует другой, при этом класс не содержит в себе используемый класс и не является его наследником. Например, <code>LinkedList</code> и <code>ArrayList</code> умеют создавать <code>ListIterator</code>. Отобразим это в виде стрелок с пунктирной линией:

<pre class="lang-java line-numbers"><code>
class ListIterator
ListIterator &lt;... ArrayList : create
ListIterator &lt;... LinkedList : create
</code></pre>
Выглядеть после всего это будет следующим образом:
<div class="row justify-content-center jr-image-wrap"><div class="col-12 col-sm-10 col-md-8"><img data-id="340b3a27-e4a2-49bd-a217-a5b7fd0a5386" data-max-width="375" alt="UML: от теории к практике - 4" src="https://cdn.javarush.com/images/article/340b3a27-e4a2-49bd-a217-a5b7fd0a5386/1024.jpeg"></div></div>Детализировать можно настолько, насколько это необходимо. Все обозначения указаны тут: "<a href="http://plantuml.com/class-diagram" target="_blank" rel="nofollow">PlantUML — Диаграмма классов</a>".

Кроме того, в рисовании такой схемы нет ничего сверхъестественного, и при работе над своими задачами её можно быстро рисовать от руки. Это позволит развить навыки продумывания архитектуры приложения и поможет выявить недостатки структуры классов на раннем этапе, а не когда вы уже потратите день на реализацию неправильной модели. Мне кажется, это неплохая причина для того, чтобы попробовать? )
<div class="row justify-content-center jr-image-wrap"><div class="col-12 col-sm-10 col-md-8"><img data-id="8ee40fef-a567-431e-b3be-b9d9a4691b1a" data-max-width="307" alt="UML: от теории к практике - 5" src="https://cdn.javarush.com/images/article/8ee40fef-a567-431e-b3be-b9d9a4691b1a/1024.jpeg"></div></div><h2>Автоматизация</h2>Есть различные способы автоматической генерации PlantUML диаграмм. Например, в<em> Idea</em> есть плагин <a href="https://plugins.jetbrains.com/plugin/10387-sketch-it-" target="_blank" rel="nofollow">SketchIT</a>, но рисует он их не совсем правильно. Скажем, неправильно рисуется имплементация интерфейсов (отображается как наследование). 

Также в интернете есть примеры того, как это встроить в жизненный цикл сборки вашего проекта.

Допустим, для <em>Maven</em> есть пример использования <a href="https://github.com/gboersma/uml-java-doclet/blob/master/README.md" target="_blank" rel="nofollow">uml-java-docklet</a>.

Для того, чтобы показать как это, воспользуемся <a href="https://maven.apache.org/archetype/index.html" target="_blank" rel="nofollow">Maven Archetype</a> для быстрого создания Maven проекта.

Выполним команду: <code>mvn archetype:generate</code>

На вопросе выбора фильтра (<strong>Choose a number or apply filter</strong>) оставляем default, просто нажав Enter. Это всегда будет "<strong>maven-archetype-quickstart</strong>". Выбираем самую последнюю версию.

Далее отвечаем на вопросы и завершаем создание проекта:
<div class="row justify-content-center jr-image-wrap"><div class="col-12 col-sm-10 col-md-8"><img data-id="819b0302-04f2-477c-af53-c3fa55720640" data-max-width="508" alt="UML: от теории к практике - 6" src="https://cdn.javarush.com/images/article/819b0302-04f2-477c-af53-c3fa55720640/1024.jpeg"></div></div>Так как Maven не является целью данной статьи, ответы на свои вопросы по Maven можно найти в <a href="https://maven.apache.org/users/index.html" target="_blank" rel="nofollow">Maven Users Centre</a>.

В сгенерированном проекте откроем на редактирование файл описания проекта, <strong>pom.xml</strong>. В него скопируем содержимое из описания <a href="https://github.com/gboersma/uml-java-doclet/blob/master/README.md#installing" target="_blank" rel="nofollow">uml-java-docklet installing</a>.

Используемый в описании артефакт не удалось найти в репозитории Maven Central. Но у меня заработало с этим: <a href="https://mvnrepository.com/artifact/com.chfourie/uml-java-doclet/1.0.0" target="_blank" rel="nofollow">https://mvnrepository.com/artifact/com.chfourie/uml-java-doclet/1.0.0</a>.

То есть надо в том описании просто заменить <em>groupId</em> с "<em>info.leadinglight</em>" на "<em>com.chfourie</em>" и поставить версию "<em>1.0.0</em>".

После этого можем выполнить в каталоге, где находится файл <strong>pom.xml</strong> эти комманды: <code>mvn clean install</code> и <code>mvn javadoc:javadoc</code>.

Теперь, если открыть сгенерированную документацию (explorer target\site\apidocs\index.html), мы увидим UML схемы. Кстати, имплементация тут уже отображается верно )

<div class="email-subscription"><iframe frameborder="0" src="https://secure.esputnik.com.ua/4Q0Ef6d2SOs" width="100%" height="200" scrolling="no"></iframe></div><h2>Заключение</h2>Как видно, UML позволяет визуализировать структуру вашего приложения. Кроме того, UML не ограничивается только этим. При помощи UML можно описывать различные процессы внутри вашей компании или описывать бизнес-процесс, в рамках которого работает функция, которую вы пишите. На сколько UML полезен лично для вас — решать вам, но найти время и ознакомиться более подробным будет в любом случае полезно.

#Viacheslav