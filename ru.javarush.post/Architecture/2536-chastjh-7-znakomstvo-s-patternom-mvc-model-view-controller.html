Часть 7. Знакомство с паттерном MVC (Model-View-Controller)
<p>----------------------------------------</p>
В этом материале мы познакомимся с тобой с такой штукой как MVC. Поговорим о том, что такое MVC, затронем историю его создания,разберемся с основными идеями и концепциями, заложенными в MVC, рассмотрим пошагово, как разбить приложение на модули Модель...
<p>----------------------------------------</p>
Этот материал — часть цикла “Введение в Enterprise-разработку”. Предыдущие статьи:

<ul>
<li><a href="https://javarush.com/groups/posts/2514-vvedenie-v-enterprise-razrabotku" target="_blank">о сети</a>;</li>
<li><a href="https://javarush.com/groups/posts/2519-chastjh-2-pogovorim-nemnogo-ob-arkhitekture-po" target="_blank">об архитектуре ПО</a>;</li>
<li><a href="https://javarush.com/groups/posts/2521-chastjh-3-protokolih-httphttps" target="_blank">о протоколах HTTP/HTTPS</a>;</li>
<li><a href="https://javarush.com/groups/posts/2523-chastjh-4osnovih-maven" target="_blank">об основах Maven</a>;</li>
<li><a href="https://javarush.com/groups/posts/2529-chastjh-5-servletih-pishem-prostoe-veb-prilozhenie" target="_blank">о сервлетах (пишем простое веб-приложение)</a>;</li>
<li><a href="https://javarush.com/groups/posts/2533-chastjh-6-konteynerih-servletov" target="_blank">о контейнерах сервлетов</a>.</li>
</ul><img data-max-width="850" alt="Часть 7. Знакомство с паттерном MVC (Model-View-Controller) - 1" src="https://cdn.javarush.com/images/article/06cb2597-79ad-4dba-842e-380150d549db/original.jpeg">В этом материале мы познакомимся с тобой с такой штукой как MVC. Поговорим о том, что такое MVC, затронем историю его создания, разберемся с основными идеями и концепциями, заложенными в MVC, рассмотрим пошагово, как разбить приложение на модули Модель, Вид, Контроллер, а также напишем небольшое веб приложение на Spring-Boot, и на примере Spring-MVC посмотрим как данные передаются из Java кода в html страницы. 

Чтобы понять этот материал, тебе нужно быть знакомым с шаблонами проектирования, особенно с Наблюдателем (Observer) и Фасадом (Facade). Быть знакомым с HTTP запросами и ответам, понимать основы html, знать, что такое аннотации в Java. 

Усаживайся поудобнее, заваривай чай, готовь десерт, салат, второе и первое. Мы начинаем.
<h2>История создания MVC</h2>Идеи MVC сформулировал Трюгве Реенскауг (Trygve Reenskaug) во время работы в Xerox PARC в конце 70-х годов. В те времена для работы с ЭВМ было не обойтись без ученой степени и постоянного изучения объемной документации. 

Задача, которую Реенскауг решал совместно с группой очень сильных разработчиков, заключалась в том, чтобы упростить взаимодействие рядового пользователя с компьютером. Необходимо было создать средства, которые с одной стороны были бы предельно простыми и понятными, а с другой — давали бы возможность управлять компьютером и сложными приложениями.

Реенскауг работал в команде, которая занималась разработкой портативного компьютера "для детей всех возрастов" — Dynabook, а также языка SmallTalk под руководством Алана Кея (Alan Kay).
 
Именно тогда и там закладывались понятия дружелюбного интерфейса. Работа Реенскауга совместно с командой во многом повлияла на развитие сферы IT. 

Приведем интересный факт, который не относится к MVC напрямую, но иллюстрирует значимость тех разработок. 

В 2007 году после презентации Apple iPhone, Алан Кей сказал: “Когда вышел Macintosh, в Newsweek спросили, что я о нем думаю. Я сказал: это первый персональный компьютер, достойный критики. После презентации Стив Джобс подошел и спросил: достоин ли iPhone критики? И я ответил: сделайте его размером пять на восемь дюймов, и вы завоюете мир”.

Спустя 3 года, 27 января 2010 года, Apple представила iPad диагональю 9,7 дюйма. То есть Стив Джобс почти буквально следовал совету Алана Кея. 

Проект, над которым работал Реннскауг велся на протяжении 10 лет. А первая публикация об MVC от его создателей вышла в свет еще через 10 лет. Мартин Фаулер, автор ряда книг и статей по архитектуре ПО, упоминает, что он изучал MVC по работающей версии SmallTalk. 

Поскольку информации об MVC из первоисточника долго не было, а также по ряду других причин, появилось большое количество различных трактовок этого понятия. 

В результате многие считают MVC схемой или паттерном проектирования. Реже MVC называют составным паттерном или комбинацией нескольких паттернов, работающих совместно для реализации сложных приложений. 

Но на самом деле, как было сказано ранее, MVC — это прежде всего набор архитектурных идей/принципов/подходов, которые можно реализовать различными способами с использованием различных шаблонов...

Далее мы попробуем рассмотреть основные идеи, заложенные в концепции MVC. 
<h2>Что такое MVC: основные идеи и принципы</h2><ul>
<li>VC — это набор архитектурных идей и принципов для построения сложных информационных систем с пользовательским интерфейсом;</li>
<li>MVC — это аббревиатура, которая расшифровывается так: Model-View-Controller.</li>
</ul><span class="text-bold">Дисклеймер: MVC — это не паттерн проектирования.</span> MVC — это именно <span class="text-bold">набор архитектурных идей и принципов</span> для построения сложных систем с пользовательским интерфейсом. Но для удобства, чтобы каждый раз не повторять: “Набор архитектурных идей…”, мы будем называть MVC паттерном. 

Начнем с простого. Что же скрывается за словами Model-View-Controller?

При разработке систем с пользовательским интерфейсом, следуя паттерну MVC нужно разделять систему на три составные части. Их, в свою очередь, можно называть модулями или компонентами. Говори как хочешь, но дели на три. У каждой составной компоненты будет свое предназначение. 

<span class="text-bold">Model.</span> Первая компонента/модуль — так называемая модель. Она содержит всю бизнес-логику приложения. 

<span class="text-bold">View.</span> Вторая часть системы — вид. Данный модуль отвечает за отображение данных пользователю. Все, что видит пользователь, генерируется видом.

<span class="text-bold">Controller.</span> Третьим звеном данной цепи является контроллер. В нем хранится код, который отвечает за обработку действий пользователя (любое действие пользователя в системе обрабатывается в контроллере). 

Модель — самая независимая часть системы. Настолько независимая, что она не должна ничего знать о модулях Вид и Контроллер. Модель настолько независима, что ее разработчики могут практически ничего не знать о Виде и Контроллере.

Основное предназначение Вида — предоставлять информацию из Модели в удобном для восприятия пользователя формате. Основное ограничение Вида — он никак не должен изменять модель. 

Основное предназначение Контроллера — обрабатывать действия пользователя. Именно через Контроллер пользователь вносит изменения в модель. Точнее в данные, которые хранятся в модели.

Приведем еще раз схему, которую тебе уже показывали на лекции:
<img data-max-width="850" alt="Часть 7. Знакомство с паттерном MVC (Model-View-Controller) - 2" src="https://cdn.javarush.com/images/article/85a08a31-57c0-4bab-b294-af2a6354ee42/original.jpeg">Из всего этого можно сделать вполне логичный вывод. Сложную систему нужно разбивать на модули.

Опишем кратко шаги, как можно добиться подобного разделения. 
<h2>Шаг 1. Отделить бизнес-логику приложения от пользовательского интерфейса</h2>Ключевая идея MVC состоит в том, что любое приложение с пользовательским интерфейсом в первом приближении можно разбить на 2 модуля: модуль, отвечающий за реализацию бизнес-логики приложения, и пользовательский интерфейс. 

В первом модуле будет реализован основной функционал приложения. Данный модуль будет ядром системы, в котором реализуется модель предметной области приложения. В концепции MVC данный модуль будет нашей буковкой M, т.е. моделью.

Во втором модуле будет реализован весь пользовательский интерфейс, включая отображение данных пользователю и логику взаимодействия пользователя с приложением.

Основная цель такого разделения — сделать так, чтобы ядро системы (Модель в терминологии MVC) могла независимо разрабатываться и тестироваться.

Архитектура приложения после подобного разделения будет выглядеть следующим образом: 
<img data-max-width="850" alt="Часть 7. Знакомство с паттерном MVC (Model-View-Controller) - 3" src="https://cdn.javarush.com/images/article/0745e48a-ddd0-4937-b039-18c644dd83d3/original.jpeg"><h2>Шаг 2. Используя шаблон Наблюдатель, добиться еще большей независимости модели, а также синхронизации пользовательских интерфейсов</h2>Здесь мы преследуем 2 цели:<ol>
<li>Добиться еще большей независимости модели.</li>
<li>Синхронизировать пользовательские интерфейсы.</li>
</ol>Понять, что подразумевается под синхронизацией пользовательских интерфейсов, поможет следующий пример. 

Предположим, мы покупаем билет в кино через интернет и видим количество свободных мест в кинотеатре. Одновременно с нами покупать билет в кино может кто-то еще. Если этот кто-то купит билет раньше нас, нам бы хотелось увидеть, что количество свободных мест на наш сеанс уменьшилось. 

А теперь поразмышляем о том, как это может быть реализовано внутри программы. Предположим, у нас есть ядро системы (наша модель) и интерфейс (веб страница, на которой мы осуществляем покупку). 

На сайте 2 пользователя одновременно выбирают место. 

Первый пользователь купил билет. Второму пользователю необходимо отобразить на странице эту информацию. 

Как это должно произойти? 

Если мы из ядра системы будем обновлять интерфейс, наше ядро, наша модель, будет зависима от интерфейса. При разработке и тестировании модели придется держать в голове различные способы обновления интерфейса. 

Чтобы достичь этого, необходимо реализовать шаблон Наблюдатель. С его помощью модель рассылает уведомления об изменениях всем подписчикам. Интерфейс, являясь таким подписчиком, получит уведомление и обновится. 

Шаблон Наблюдатель позволяет модели с одной стороны информировать интерфейс (вид и контроллер) о том, что в ней произошли изменения, а с другой — фактически ничего о них “не знать”, и тем самым оставаться независимой. С другой стороны, это позволит синхронизировать пользовательские интерфейсы. 
<h2>Шаг 3. Разделение интерфейса на Вид и Контроллер</h2>Продолжаем делить приложение на модули, но уже на более низком уровне иерархии. На этом шаге пользовательский интерфейс (который был выделен в отдельный модуль на шаге 1) делится на вид и контроллер. 

Сложно провести строгую черту между видом и контроллером. Если говорить о том, что вид — это то, что видит пользователь, а контроллер — это механизм, благодаря которому пользователь может взаимодействовать с системой, можно обнаружить некоторое противоречие. 

Элементы управления, например, кнопки на веб-странице или виртуальная клавиатура на экране телефона, это по сути часть контроллера. Но они так же видны пользователю, как и любая часть вида. 

Здесь скорее речь идет о функциональном разделении. Основная задача пользовательского интерфейса — обеспечить взаимодействие пользователя с системой. Это означает, что у интерфейса всего 2 функции: 
<ul>
<li>выводить и удобно отображать пользователю информацию о системе;</li>
<li>вводить данные и команды пользователя в систему (передавать их системе);</li>
</ul>Данные функции и определяют то, как нужно делить интерфейс на модули.

В итоге, архитектура системы выглядит так: 
<img data-max-width="850" alt="Часть 7. Знакомство с паттерном MVC (Model-View-Controller) - 4" src="https://cdn.javarush.com/images/article/81ce3871-4556-4e91-9073-b099a4a0ee08/original.jpeg">Итак, у нас появилось приложение из трех модулей, которые называются Модель, Вид и Контроллер. 

Резюмируем:
<ol>
<li>Следуя принципам MVC, систему нужно разделять на модули.</li>
<li>Самым важным и независимым модулем должна быть модель.</li>
<li>Модель — ядро системы. Нужна возможность разрабатывать и тестировать ее независимо от интерфейса.</li>
<li>Для этого на первом шаге сегрегации системы нужно разделить ее на модель и интерфейс. </li>
<li>Далее, с помощью шаблона Наблюдатель, укрепляем модель в ее независимости и получаем синхронизацию пользовательских интерфейсов.</li>
<li>Третьим шагом делим интерфейс на контроллер и вид. </li>
<li>Все, что на ввод информации от пользователя в систему — это в контроллер.</li>
<li>Все что на вывод информации от системы к пользователю — это в вид.</li>
</ol>Осталось обсудить еще одну важную вещь и можно пить какао.
<h2>Немного о взаимосвязи Вида и Контроллера с Моделью</h2>Когда пользователь вводит информацию через контроллер, он тем самым вносит изменения в модель. По крайней мере, пользователь вносит изменения в данные модели. 

Когда пользователь получает информацию через элементы интерфейса (через Вид), пользователь получает информацию о данных модели. 

Как это происходит? Посредством чего Вид и Контроллер взаимодействуют с моделью? Ведь не может быть так, что классы Вида напрямую используют методы классов Модели для чтения/записи данных, иначе ни о какой независимости Модели не может быть и речи. 

Модель представляет тесно связанный между собой набор классов, к которым, по-хорошему, ни у Вида, ни у Контроллера не должно быть доступа. 

Для связи Модели с Видом и Контроллером необходимо реализовать шаблон проектирования Фасад. Фасад модели будет той самой прослойкой между Моделью и интерфейсом, через которую Вид получает данные в удобном формате, а Контроллер изменяет данные, вызывая нужные методы фасада. 

Схематично, в итоге, все будет выглядеть так: 
<img data-max-width="1024" alt="Часть 7. Знакомство с паттерном MVC (Model-View-Controller) - 6" src="https://cdn.javarush.com/images/article/c7839f08-cda3-43b3-8ebd-a80864bb965f/original.jpeg"><h2>MVC: в чем профит?</h2>Основная цель следования принципам MVC — отделить реализацию бизнес-логики приложения (модели) от ее визуализации (вида). 

Такое разделение повысит возможность повторного использования кода.

Польза применения MVC наиболее наглядна в случаях, когда пользователю нужно предоставлять одни и те же данные в разных формах. Например, в виде таблицы, графика или диаграммы (используя различные виды). При этом, не затрагивая реализацию видов, можно изменить реакции на действия пользователя (нажатие мышью на кнопке, ввод данных).

Если следовать принципам MVC, можно упростить написание программ, повысить читаемость кода, сделать легче расширение и поддержку системы в будущем. 

В завершающем материале цикла “Введение в Enterprise-разработку” мы с тобой посмотрим на реализацию MVC на примере Spring-MVC.

<a href="https://javarush.com/groups/posts/2537-chastjh-8-pishem-neboljhshoe-prilozhenie-na-spring-boot" target="_blank">Часть 8. Пишем небольшое приложение на spring-boot</a>

<div class="email-subscription"><iframe frameborder="0" src="https://secure.esputnik.com.ua/4Q0Ef6d2SOs" width="100%" height="200" scrolling="no"></iframe></div>