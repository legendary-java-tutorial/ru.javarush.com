Ссылочные типы данных в Java
<p>----------------------------------------</p>
Без понимания синтаксиса Java невозможно стать серьезным разработчиком, поэтому сегодня мы продолжаем изучать синтаксис. В одной из прошлых статей мы говорили о примитивных переменных, но так как видов переменных два, сегодня мы поговорим о втором виде...
<p>----------------------------------------</p>
Без понимания синтаксиса Java невозможно стать серьезным разработчиком, поэтому сегодня мы продолжаем изучать синтаксис.

<a href="https://javarush.com/groups/posts/2630-prostihe-peremennihe-v-java-i-konstantih" target="_blank">В одной из прошлых статей</a> мы говорили о примитивных переменных, но так как видов переменных два, сегодня мы поговорим о втором виде — ссылочные типы в Java.

Итак что это? Зачем нужны ссылочные типы данных в Java?
<img data-max-width="800" data-id="303a9a63-afb1-42f4-b1f8-3fe892b2e4ac" src="/images/article/303a9a63-afb1-42f4-b1f8-3fe892b2e4ac/800.webp" class="img-fluid" alt="Ссылочные типы данных в Java - 1">Давайте представим, что у нас есть объект телевизор с некоторыми характеристиками, такими как номер канала, громкость звука и флаг включенности:

<pre class="lang-java line-numbers"><code>
public class TV {
   int numberOfChannel;
   int soundVolume;
   boolean isOn;
}
</code></pre>
Как простой тип, например, <code>int</code>, может хранить эти данные? Напомним: одна переменная <code>int</code> — это 4 байта. А ведь там внутри есть две переменные (4 байта + 4 байта) этого же типа, да ещё и <code>boolean</code> (+1 байт)... Итого — 4 к 9, а ведь как правило, в объекте хранится намного больше информации.

Что делать? Нельзя же вложить объект в переменную. На этом моменте в нашей истории появляются ссылочные переменные.

<strong>Ссылочные переменные</strong> хранят адрес ячейки памяти, в которой расположен определенный объект. То есть это “визитка” с адресом, имея которую мы можем найти наш объект в общей памяти и выполнять с ним некоторые манипуляции.

Ссылка на любой объект в Java представляет собой ссылочную переменную.

Как бы это выглядело с нашим объектом телевизора:

<pre class="lang-java line-numbers"><code>
TV telly = new TV();
</code></pre>
Переменной типа TV с именем <code>telly</code> мы задаем ссылку на создаваемый объект типа TV. То есть, JVM выделяет память в куче под объект TV, создает его и адрес на его местоположение в памяти, кладется в переменную <code>telly</code>, которая хранится в стеке.

Подробнее о памяти, а именно — о стеке и еще массе полезного, можно почитать в <a href="https://javarush.com/quests/lectures/questharvardcs50.level05.lecture04" target="_blank">этой лекции</a>.
 
Переменная типа TV и объект типа TV, заметили? Это неспроста: объектам определенного типа должны соответствовать переменные того же типа (не считая наследования и реализаций интерфейсов, но сейчас мы это не учитываем). В конце концов, не будем же мы в стаканы наливать суп? 

Получается, что у нас объект — это телевизор, а ссылочная переменная для него — как бы пульт управления. С помощью этого пульта мы можем взаимодействовать с нашим объектом и его данными. Например, задать характеристики для нашего телевизора:

<pre class="lang-java line-numbers"><code>
telly.isOn = true;
telly.numberOfChannel = 53;
telly.soundVolume = 20;
</code></pre>
Тут мы использовали оператор точки <code>.</code> — чтобы получить доступ и начать использование внутренних элементов объекта, на который ссылается переменная. 

Например, в первой строке мы сказали переменной <code>telly</code>: “Дай нам внутреннюю переменную <code>isOn</code> объекта, на который ты ссылаешься, и задай ей значение true” (включи нам телевизор).
<h2>Переопределение ссылочных переменных</h2>Допустим, у нас есть две переменные ссылочного типа и объекты, на которые они ссылаются:

<pre class="lang-java line-numbers"><code>
TV firstTV = new TV();
TV secondTV = new TV();
</code></pre>
Если мы напишем:

<pre class="lang-java line-numbers"><code>
firstTV = secondTV;
</code></pre>
это будет означать, что мы первой переменной в качестве значения присвоили  копию адреса (значение битов адреса) на второй объект, и теперь обе переменные ссылаются на второй объект (иначе говоря, два пульта от одного и того же телевизора). 

В тоже время, первый объект остался без переменной, которая на него ссылается. В итоге у нас есть объект, к которому невозможно обратиться, ведь переменная была такой условной ниточкой к нему, без которой он превращается в мусор, просто лежит в памяти и занимает место. Впоследствии этот объект будет уничтожен из памяти <a href="https://javarush.com/groups/posts/917-sborka-musora" target="_blank">сборщиком мусора</a>.
<img data-max-width="800" data-id="5016eaac-83a2-417a-acea-97283afafef1" src="/images/article/5016eaac-83a2-417a-acea-97283afafef1/800.webp" class="img-fluid" alt="Ссылочные типы данных в Java - 2">Прервать связующую ниточку с объектом можно и без другой ссылки:

<pre class="lang-java line-numbers"><code>
secondTV = null;
</code></pre>
В итоге ссылка на объект останется одна — <code>firstTV</code>, а <code>secondTV</code> уже ни на кого указывать не будет (что не мешает нам в дальнейшем присвоить ей ссылку на какой-нибудь объект типа TV).
<h2>Класс String</h2>Отдельно хотелось бы упомянуть класс <a href="https://javarush.com/groups/posts/2347-klass-string-v-java" target="_blank">String</a>.

Это базовый класс, предназначен для хранения и работы с данными, которые хранятся в виде строки. 

Пример:

<pre class="lang-java line-numbers"><code>
String text = new String("This TV is very loud");
</code></pre>
Здесь мы передали строку для хранения в конструкторе объекта.

Но никто так не делает. Ведь строки можно создавать:

<pre class="lang-java line-numbers"><code>
String text = "This TV is very loud";
</code></pre>
Гораздо удобнее, правда? 

По популярности использования <code>String</code> не уступает примитивным типам, но всё же это класс, и переменная, которая ссылается на него — не примитивного, а ссылочного типа. 

У <code>String</code> есть вот такая замечательная возможность конкатенации строк:

<pre class="lang-java line-numbers"><code>
String text = "This TV" + " is very loud";
</code></pre>
В итоге мы снова получим текст: <code>This TV is very loud</code>, так как две строки соединятся в одно целое, и переменная будет ссылаться на этот полный текст.

Важным нюансом является то, что <code>String</code> — это неизменяемый класс. Что это значит? 

Возьмем такой пример:

<pre class="lang-java line-numbers"><code>
String text = "This TV";
text = text + " is very loud";
</code></pre>
Вроде, бы всё просто: объявляем переменную, задаем ей значение. На следующей строке изменяем его. Но не совсем-то и изменяем. Так как это неизменяемый класс, на второй строке начальное значение не меняется, а создается новое, которое в свою очередь состоит из первого <code>+ "  is very loud"</code>.
<h2>Ссылочные константы</h2>В статье про примитивные типы мы затрагивали тему констант.

Как же будет себя вести ссылочная переменная, когда мы объявим её <a href="https://javarush.com/groups/posts/1946-neizmennoe-v-java-final-konstantih-i-immutable" target="_blank">final</a>?

<pre class="lang-java line-numbers"><code>
final TV telly = new TV();
</code></pre>
Возможно, вы подумаете, что это сделает объект неизменяемым. Но нет, это не так. 
<img data-max-width="800" data-id="fa849db8-0205-4137-96d1-f47f2c01bacf" src="/images/article/fa849db8-0205-4137-96d1-f47f2c01bacf/800.webp" class="img-fluid" alt="Ссылочные типы данных в Java - 3">Ссылочная переменная с модификатором <code>final</code> будет привязана к определенному объекту без возможности её как-либо отвязать (переопределить или приравнять к <code>null</code>).

То есть, после задания значения такой переменной, код вида:

<pre class="lang-java line-numbers"><code>
telly = new TV();
</code></pre>
или

<pre class="lang-java line-numbers"><code>
telly = null;
</code></pre>
будет вызывать ошибку компиляции.

То есть <code>final</code> действует только на ссылку, а на сам объект влияния не оказывает. Если изначально он у нас изменяемый, мы без проблем можем менять его внутреннее состояние:

<pre class="lang-java line-numbers"><code>
telly.soundVolume = 30;
</code></pre>
Иногда, переменные обозначают как final даже в аргументах метода!

<pre class="lang-java line-numbers"><code>
public void enableTV (final TV telly){
   telly.isOn = true;
}
</code></pre>
Это делается для того, чтобы в процессе написания метода эти аргументы нельзя было переопределить и соответственно создать меньше путаницы.

А что если обозначить <code>final</code> ссылочную переменную, которая ссылается на неизменяемый объект? К примеру <code>String</code>:

<pre class="lang-java line-numbers"><code>
final String PASSWORD = "password";
</code></pre>
Как следствие, мы получим константу, аналог констант примитивного типа, ведь тут мы не можем ни переопределить ссылку, ни изменить внутреннее состояние объекта (внутренние данные).
<h2>Подведем итоги</h2><ol>
<li>Если простые переменные хранят биты значений, то ссылочные переменные хранят биты, представляющие способ получения объекта.</li>
<li>Ссылки на объекты объявляются лишь для одного вида объектов.</li>
<li>Любой класс в Java — это ссылочный тип.</li>
<li>По умолчанию в Java значение любой переменной ссылки — <code>null</code>.</li>
<li><code>String</code> — стандартный пример ссылочного типа. Также этот класс является неизменяемым (immutable).</li>
<li>Ссылочные переменные с модификатором <code>final</code> привязаны лишь к одному объекту без возможности переопределения.</li>
</ol>