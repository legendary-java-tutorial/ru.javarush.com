Зачем использовать SerialVersionUID внутри Serializable класса в Java
<p>----------------------------------------</p>
Serialization и SerialVersionUID всегда остается загадкой для многих Java-разработчиков. Я часто вижу вопросы насчет того что такое SerialVersionUID, или что произойдет, если я не объявлю SerialVersionUID ...
<p>----------------------------------------</p>
<code>Serialization</code> и <code>SerialVersionUID</code> всегда остается загадкой для многих Java-разработчиков. Я часто вижу вопросы насчет того что такое <code>SerialVersionUID</code>, или что произойдет, если я не объявлю <code>SerialVersionUID</code> в моем <code>Serializable</code>-классе?
<img data-id="08b279f8-11b0-44cb-89a9-b6ae3d2d7adb" data-max-width="850" alt="Зачем использовать SerialVersionUID внутри Serializable класса в Java - 1" src="https://cdn.javarush.com/images/article/08b279f8-11b0-44cb-89a9-b6ae3d2d7adb/1024.jpeg">Помимо запутанного и редкого использования, есть еще одна причина для этого вопроса — это предупреждение Eclipse IDE об отсутствии <code>SerialVersionUID</code>, например: "<em>The Serializable class Customer does not declare a static final SerialVersionUID field of type long</em>" ("<code>Serializable</code>-класс <code>Customer</code> не объявил статическое финальное поле <code>SerialVersionUID</code> типа long"). 

В этой статье, вы сможете не только узнать основы Java <code>SerialVersionUID</code> но и его влияние на процесс сериализации и де-сериализации. Когда вы объявляете класс, как <code>Serializable</code> путем реализации интерфейса-маркера <code>java.io.Serializable</code>, среда выполнения Java сохраняет экземпляр этого класса на диске с помощью механизма сериализации по умолчанию, если вы не настроили процесс использования <a href='https://javarevisited.blogspot.com/2012/01/serializable-externalizable-in-java.html' rel='nofollow' target='_blank'>интерфейса Externalizable</a>. 

Во время сериализации, среда выполнения Java создает номер версии для класса, так что она может десереализировать его позже. В Java этот номер версии известен как <code>SerialVersionUID</code>. Если во время десериализации, <code>SerialVersionUID</code> не соответствует, то процесс завершится с исключением <code>InvalidClassException</code> в потоке "<code>main</code>" <code>java.io.InvalidClassException</code>, а также напечатает имя класса и соответствующий <code>SerialVersionUID</code>. Быстрое решение для исправления этой проблемы – скопировать <code>SerialVersionUID</code> и определить его как константу типа <code>private</code> <code>static</code> <code>final</code> <code>long</code> в вашем классе. В этой статье мы узнаем, о том, почему мы должны использовать <code>SerialVersionUID</code> в Java и как использовать инструмент serialver JDK для генерации этого ID. 

Если вы новичок в сериализации, вы также можете посмотреть <a href='https://javarevisited.blogspot.com/2011/04/top-10-java-serialization-interview.html' rel='nofollow' target='_blank'>Топ 10 вопросов о сериализации Java на интервью</a> чтобы оценить свои знания и найти пробелы в вашем понимании для дальнейшего чтения. Подобно <code>Concurrency</code> (параллельности) и <code>Multi-threading</code> (многопоточности), <code>Serialization</code> (сериализация) это уже другая тема, которая заслуживает чтения несколько раз.
<h2>Зачем использовать SerialVersionUID в Java</h2>Как я сказал, когда мы не определилили значение <code>SerialVersionUID</code> как <code>static</code> <code>final</code> <code>long</code> в нашем классе, механизм сериализации сделает это за нас. Этот механизм чувствителен ко многим деталям, включая поля вашего класса, их модификаторы доступа, интерфейсы, которые он реализует и даже различные реализации компилятора, любые изменения в классе или использование другого компилятора может дать результат иного <code>SerialVersionUID</code>, который в конечном итоге остановит перезагрузку сериализованных данных.Очень рискованно полагаться на механизм сериализации Java для генерации этого id, вот почему рекомендуется явно определять <code>SerialVersionUID</code> в вашем <a href='http://www.java67.com/2012/08/what-is-transient-variable-in-java.html' rel='nofollow' target='_blank'>Serializable-классе</a>. Я настоятельно советую прочитать классику Java — <strong>Joshua Bloch “Effective Java”</strong> для понимания сериализации Java и проблем неправильной их обработки. 

Кстати, JDK также предоставляет инструмент <code>serialver</code>, который расположен в директории <em>bin</em> каталога <a href='https://javarevisited.blogspot.com/2012/02/how-to-set-javahome-environment-in.html' rel='nofollow' target='_blank'>JAVA_HOME</a>, на моем компьютере <strong>C:\Program Files\Java\jdk1.6.0_26\bin\serialver.exe</strong>, который может быть использован для генерирования <code>SerialVersionUID</code> для старых классов. Это очень полезно в случае, если вы внесли изменения в ваш класс, который нарушает сериализацию и ваше приложение не может перезагрузить сериализированные экземпляры. Вы легко можете использовать эту утилиту для создания <code>SerialVersionUID</code> для старых экземпляров, а затем использовать его в явном виде объявив поле как <a href='https://javarevisited.blogspot.com/2012/03/private-in-java-why-should-you-always.html' rel='nofollow' target='_blank'>private</a> <a href='https://javarevisited.blogspot.com/2011/11/static-keyword-method-variable-java.html' rel='nofollow' target='_blank'>static</a> <a href='https://javarevisited.blogspot.com/2011/12/final-variable-method-class-java.html' rel='nofollow' target='_blank'>final</a> <a href='https://javarevisited.blogspot.com/2012/12/how-to-convert-string-to-long-in-java-4-examples.html' rel='nofollow' target='_blank'>long</a> <code>SerialVersionUID</code>. Кстати, очень рекомендуется из соображений производительности и безопасности использовать обычный двоичный формат для сериализации, опять же “Effective Java” имеет несколько параграфов, которые демонстрируют преимущества обычного формата в мельчайших деталях.
<h2>Как использовать утилиту serialver JDK для генерирования SerialVersionUID</h2>Вы можете использовать <code>serialver</code> для генерирования <code>SerialVersionUID</code> для классов. Это особенно полезно для развивающихся классов, утилита возвращает <code>SerialVersionUID</code> в формате легком для копирования. Вы можете использовать утилиту <code>serialver</code> JDK как показано в примере:

<pre class='lang-java line-numbers'><code>
$ serialver
use: serialver [-classpath classpath] [-show] [classname...]
$ serialver -classpath . Hello
Class Hello is not Serializable.
$ serialver -classpath . Hello
Hello: static final long SerialVersionUID = -4862926644813433707L;
</code></pre>
Вы также можете использовать утилиту <code>serialver</code> в <code>GUI</code> виде используя команду <code>$ serialver –show</code>, это откроет инспектор <code>serial version</code>, который принимает полное имя класса и показывает его <code>Serial version</code>.
<h2>Резюме</h2>Теперь мы знаем что такое <code>SerialVersionUID</code> и почему важно объявлять его в <code>Serializable</code>-классе, самое время пересмотреть некоторые важные факты связанные с Java SerialVersionUID.
<ol>
<li><code>SerialVersionUID</code> используется для указании версии сериализованных данных.</li><br />
<li>Когда мы не объявляем <code>SerialVersionUID</code> в нашем классе, среда выполнения Java делает это за нас, но этот процесс чувствителен ко многим метаданным класса включая количество полей, тип полей, модификаторы доступа полей, интерфейсов, которые реализованы в классе и пр. Вы можете найти точную информацию в документации о сериализации от Oracle.</li><br />
<li>Рекомендуется объявлять SerialVersionUID как private static final long переменную во избежание механизма по умолчанию. Некоторые IDE, такие как <a href='https://javarevisited.blogspot.com/2013/03/how-to-write-unit-test-in-java-eclipse-netbeans-example-run.html' rel='nofollow' target='_blank'>Eclipse</a>, также выдают предупреждения если вы забыли это, например: "The Serializable class Customer does not declare a static final SerialVersionUID field of type long" ("Serializable-класс Customer не объявил статическое финальное поле SerialVersionUID типа long"). Хотя вы и можете отключить это предупреждение следуя в Window > Preferences > Java > Compiler > Errors / Warnings > Potential Programming Problems, я предлагаю не делать этого. Только когда восстановление данных не требуется я могу быть небрежным в этом. Вот как эта ошибка выглядит в Eclipse IDE, все что вам нужно это принять первое быстрое решение.
<img data-id="55b64684-c8cd-499e-bf80-630999584fb9" data-max-width="570" alt="Зачем использовать SerialVersionUID внутри Serializable класса в Java - 2" src="https://cdn.javarush.com/images/article/55b64684-c8cd-499e-bf80-630999584fb9/1024.jpeg"></li><br />
<li>Вы также можете использовать утилиту serialver из JDK для генерирования Serial Version для классов в Java. Утилита также имеет GUI, который включается при передаче параметра – <code>show</code>.</li><br />
<li>Лучшая практика в сериализации – это явно объявить <code>SerialVersionUID</code>, чтобы избежать любых проблем при де-сериализации, особенно если вы работаете с клиент-серверным приложением, которое опирается на сериализованные данные, например, RMI.</li>
</ol>
Это все про <code>SerialVersionUID</code> в Java. Сейчас мы знаем почему важно правильно объявлять <code>SerialVersionUID</code> в классе. Вы можете сказать спасибо вашей IDE за это напоминание, которое потенциально может нарушить де-сериализацию вашего класса.

Если вы хотите больше прочитать про сериализацию и родственные понятия, вы можете также посмотреть эти удивительные статьи.
<ul>
<li><a href='https://javarevisited.blogspot.com/2012/03/difference-between-transient-and.html' rel='nofollow' target='_blank'>Difference between transient and volatile variable in Java</a></li>
<li><a href='http://www.java67.com/2012/10/difference-between-serializable-vs-externalizable-interface.html' rel='nofollow' target='_blank'>Difference between Serializable and Externalizable interface in Java</a></li>
<li><a href='https://javarevisited.blogspot.com/2011/09/transient-keyword-variable-in-java.html' rel='nofollow' target='_blank'>When to use transient variable in Java</a></li></ul>Оригинал <a href='https://javarevisited.blogspot.com/2014/05/why-use-serialversionuid-inside-serializable-class-in-java.html' rel='nofollow' target='_blank'>здесь</a>