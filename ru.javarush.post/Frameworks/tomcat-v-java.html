Tomcat в Java
<p>----------------------------------------</p>
В какой-то момент каждый разработчик набирает достаточное количество навыков, и у него появляется мысль о создании собственного проекта, чтобы применить знания на практике. Легче всего взяться за веб-проект, так как реализация веб-приложения не скована какими-либо ограничениями...
<p>----------------------------------------</p>
В какой-то момент каждый разработчик набирает достаточное количество навыков, и у него появляется мысль о создании собственного проекта, чтобы применить знания на практике. Легче всего взяться за веб-проект, так как реализация веб-приложения не скована какими-либо ограничениями, как, например, десктопные приложения. Клиенту нужен только браузер, и он может взаимодействовать с приложением не скачивая каких-либо дистрибутивов. Без регистрации и смс, как говорится (хотя это зависит от самого приложения).

<img data-id="ae623c58-ed0b-4fd4-b64b-23114600de37" data-max-width="850" alt="Tomcat в Java - 1" src="https://cdn.javarush.com/images/article/ae623c58-ed0b-4fd4-b64b-23114600de37/1024.jpeg">Так вот, для того, чтобы реализовать на Java хорошее веб-приложение, не обойтись без инструмента под названием Tomcat.

<strong>Содержание:</strong>
<ul>
<li><a href="#Tomcat_в_курсе_Javarush">Tomcat в курсе Javarush</a></li>
<li><a href="#Tomcat_что_это">Tomcat — что это?</a></li>
<li><a href="#Компоненты_Tomcat">Компоненты Tomcat</a></li>
<ul>
<li><a href="#Catalina">Catalina</a></li>
<li><a href="#Jasper">Jasper</a></li>
<li><a href="#Coyote">Coyote</a></li>
</ul>

<li><a href="#Установка_Tomcat">Установка Tomcat</a></li>
<li><a href="#Как_создать_веб_приложение">Как создать веб-приложение</a></li>
<li><a href="#Как_встроить_приложение_в_работающий_сервер">Как встроить приложение в работающий сервер</a></li>
<ul>
<li><a href="#Функции_контейнера_сервлетов">Функции контейнера сервлетов</a></li>
<li><a href="#Установка_сервлета">Установка сервлета</a></li>
</ul>

<li><a href="#Польза_Tomcat_для_разработки">Польза Tomcat для разработки</a></li>
<li><a href="#Дополнительные_ссылки">Дополнительные ссылки</a></li>
</ul><h2 id="Tomcat_в_курсе_Javarush">Tomcat в курсе Javarush</h2>Tomcat изучается на 9 уровне квеста Java Collections в курсе JavaRush. За 2 лекции Билаабо расскажет, <a href="https://javarush.com/quests/lectures/questcollections.level09.lecture01" target="_blank">как скачать и настроить Tomcat</a>, а также <a href="https://javarush.com/quests/lectures/questcollections.level09.lecture02" target="_blank">собрать первое веб-приложение</a>.
<h2 id="Tomcat_что_это">Tomcat — что это?</h2>Tomcat — это контейнер сервлетов с открытым исходным кодом, который также выполняет функцию веб-сервера. При первом взгляде Tomcat кажется достаточно тяжелой темой, однако это не так. 

Большинство приложений Java запускаются с помощью командной строки и выполняют некоторые действия. Такие приложения реализуют одну заранее заданную функцию, после чего больше не выполняются. У таких программ, как правило, есть метод <code>main</code>, через который их можно запустить.

Веб-приложение рассчитано на взаимодействие с клиентом. Если есть запрос от клиента, он обрабатывается, и пользователю отправляется ответ. Если нет, приложение простаивает. 

Как реализовать такую логику в стандартном приложении, учитывая, что нужно поддерживать сессии, принимать HTTP-запросы и прочее? Цикл <code>while-true</code>? Нет, здесь нужно надежное решение. 

Для этого и существует Tomcat. Фактически он представляет собой Java-приложение, которое заботится об открытии порта для взаимодействия с клиентом, настройке сессий, количестве запросов, длине заголовка и еще многих операциях.
<h2 id="Компоненты_Tomcat">Компоненты Tomcat</h2>У Tomcat есть компоненты, выполняющие определенные функции, и о них стоит знать. Давай разберемся подробнее. 
<h3 id="Catalina">Catalina</h3>Благодаря этому компоненту у разработчиков появляется возможность разворачивать свои программы в контейнере. Catalina реализует спецификацию Servlet API — основную веб-технологию в web-программировании на Java. Фактически Catalina — это <strong>контейнер сервлетов внутри Tomcat</strong> (подробнее рассмотрим это понятие ниже).
<h3 id="Jasper">Jasper</h3>Благодаря этому компоненту программист использует технологию JSP. Это как HTML-файлы, только в них встроен Java-код, который может исполняться в момент отправки страницы пользователю. Это позволяет динамически встраивать в страницу любые данные. Jasper превращает Java код в HTML, а также отслеживает изменения и автоматически обновляет их.
<h3 id="Coyote">Coyote</h3>Это важный компонент, который прослушивает HTTP-запросы от клиента на определенном порту, предоставляет эти данные для обработки в приложении, а также возвращает пользователям ответы. То есть Coyote реализует функционал HTTP-сервера.

Эти компоненты структурно можно описать следующей схемой:
<img data-id="1774872d-ba75-49d0-8ae2-4b1de2212ece" data-max-width="850" alt="Tomcat в Java - 2" src="https://cdn.javarush.com/images/article/1774872d-ba75-49d0-8ae2-4b1de2212ece/1024.jpeg">Здесь “на пальцах” показана примерная схема взаимодействия компонентов. Фактически схема работы Tomcat гораздо сложнее, однако для базового понимания этого достаточно.
<h2 id="Установка_Tomcat">Установка Tomcat</h2>Чтобы использовать Tomcat в Java, его необходимо установить в систему. 
О том, как установить Tomcat можно прочитать в этой статье, где также рассматриваются и другие сервера приложений. Итак, имея работающий Tomcat, встроенный в IDEA, можно попробовать приготовить свой первый сервлет.
<h2 id="Как_создать_веб_приложение">Как создать веб-приложение</h2>Чтобы создать веб-приложение, следует придерживаться определенной структуры папок. У IntelliJ IDEA в меню создания проекта есть функция генерации веб-приложения. Создав проект таким образом, можно увидеть простую структуру:
<img data-id="1639bd83-7ee4-4a82-9463-803e13da263f" data-max-width="500" alt="Tomcat в Java - 3" src="https://cdn.javarush.com/images/article/1639bd83-7ee4-4a82-9463-803e13da263f/1024.jpeg">В src, как всегда — исходники, а в папке web сгенерированы web.xml и index.jsp. 
web.xml — это инструкция для Tomcat, где искать обработчики запросов и прочая информация.

index.jsp — главная страница веб-приложения, куда пользователь должен попасть в первую очередь (речь идет о конфигурации по умолчанию).

В качестве первого запуска можно просто отредактировать файл index.jsp:

<pre class="lang-java line-numbers"><code>
&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;
&lt;html&gt;
 &lt;head&gt;
   &lt;title&gt;$Title$&lt;/title&gt;
 &lt;/head&gt;
 &lt;body&gt;
   &lt;h1&gt;Hello world!&lt;/h1&gt;
 &lt;/body&gt;
&lt;/html&gt;
</code></pre>
Если Tomcat установлен напрямую в IDEA, можно запустить сервер приложения:
<img data-id="9c5316e1-1695-4328-8ba3-6e954b21e1f3" data-max-width="500" alt="Tomcat в Java - 4" src="https://cdn.javarush.com/images/article/9c5316e1-1695-4328-8ba3-6e954b21e1f3/1024.jpeg">Клиент получает в браузер содержимое файла index.jsp, когда переходит на ‘/’, то есть на главную страницу. А теперь добавим ссылку на страницу, где будет располагаться текущее время сервера.

Чтобы создать свой первый сервлет, нужно использовать библиотеку servlet-api.jar, который поставляется вместе с Tomcat (можно найти в папке lib). 

Создадим сервлет, который будет отображать на странице текущее время сервера. Для этого необходимо создать класс <code>TimeWorker</code>. Расположим его в папке src/ru/javarush/tomcat:

<pre class="lang-java line-numbers"><code>
package ru.javarush.tomcat;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.util.Date;

public class TimeWorker extends HttpServlet {
  @Override
  protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
     Date date = new Date();
     req.setAttribute("date", date.toString());
     req.getRequestDispatcher("time.jsp").forward(req, resp);
  }
}
</code></pre>
<code>TimeWorker</code> наследуется от класса <code>HttpServlet</code> и переопределяет метод <code>doGet</code>. В этот метод мы получаем два параметра — <code>request</code> и <code>response</code>. В качестве примера в <code>request</code> сохраняется атрибут с названием <code>data</code> и содержащий строковое представление текущей даты. Затем вызывается <code>requestDispatcher</code> и в него передаются параметры <code>request</code> и <code>response</code>.

Обработчик создан. Теперь нужно направить запросы именно на него. Пусть любой переход по <code>/time</code> будет вести на страницу time.jsp. Открываем web.xml, между тегами <code>&lt;web-app&gt;</code> вставляем следующую конфигурацию:

<pre class="lang-java line-numbers"><code>
&lt;servlet&gt;
   &lt;servlet-name&gt;timeWorker&lt;/servlet-name&gt;
   &lt;servlet-class&gt;ru.javarush.tomcat.TimeWorker&lt;/servlet-class&gt;
   &lt;/servlet&gt;

&lt;servlet-mapping&gt;
   &lt;servlet-name&gt;timeWorker&lt;/servlet-name&gt;
   &lt;url-pattern&gt;/time&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;

&lt;welcome-file-list&gt;
   &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;
&lt;/welcome-file-list&gt;
</code></pre>
Первый тег — <code><strong>servlet</strong></code> — определяет имя сервлета и указывает путь к классу-сервлету, который будет обрабатывать запросы.

Второй тег — <code><strong>servlet-mapping</strong></code> — указывает, что сервлет с именем <code>timeWorker</code> будет вызываться тогда, когда поступит запрос на <ciode>url /time.

Третий тег — <code><strong>welcome-file-list</strong></code> — указывает файл, который будет вызван при переходе на <code>url /</code>. Это необходимо настраивать, если существует потребность изменить файл по-умолчанию. Здесь включен для примера.

Теперь при переходе на <code>/time</code> будет вызываться метод <code>doGet</code> в классе <code>TimeWorker</code> и отдавать страницу time.jsp… которой нет. Создадим ее рядом с index.jsp:

<pre class="lang-java line-numbers"><code>
&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;
&lt;html&gt;
&lt;head&gt;
   &lt;title&gt;Hello&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
   &lt;h1&gt;Current server time: &lt;%=request.getAttribute("date")%&gt;&lt;/h1&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
Начало классическое, однако в теге <code>h1</code> идет обращение к объекту <code>request</code>, которое обрамлено <code>&lt;%=</code> и <code>%&gt;</code>. Это теги шаблонизации. Код, заключенный в данные теги, вызывается до того, как будет отправлен клиенту. Ну а объекты <code>request</code> и <code>response</code> доступны в таких тегах в любом jsp-файле. В данном примере туда будет подставлено текущее время сервера, которое передает сервлет <code>TimeWorker</code>.

В файл index.jsp для удобства создаем ссылку на <code>/time</code>:

<pre class="lang-java line-numbers"><code>
&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;
&lt;html&gt;
 &lt;head&gt;
   &lt;title&gt;$Title$&lt;/title&gt;
 &lt;/head&gt;
 &lt;body&gt;
   &lt;h1&gt;Hello world!&lt;/h1&gt;
   &lt;a href="/time"&gt;Узнать текущее время сервера&lt;/a&gt;
 &lt;/body&gt;
&lt;/html&gt;
</code></pre>
Запускаем пример:
<img data-id="84d694e5-2a9d-4c49-9590-fd9f957894c1" data-max-width="500" alt="Tomcat в Java - 5" src="https://cdn.javarush.com/images/article/84d694e5-2a9d-4c49-9590-fd9f957894c1/1024.jpeg">Переходим по ссылке:
<img data-id="688ddc30-994b-4dac-8dd9-9ddf242c9516" data-max-width="500" alt="Tomcat в Java - 6" src="https://cdn.javarush.com/images/article/688ddc30-994b-4dac-8dd9-9ddf242c9516/1024.jpeg">Отлично, все работает. В примере мы реализовали переход с главной страницы на вспомогательную, в которую был передан параметр и отображен для пользователя.
При наличии проблем с запуском сервлетов рекомендую прочитать <a href="https://javarush.com/groups/posts/1126-problemih-s-zapuskom-servletov" target="_blank">этот пост</a>, где дают советы по решению этой проблемы.

Для более полного ознакомления с сервлетами, рекомендуем прочитать статьи (<a href="https://javarush.com/groups/posts/328-sozdanie-prostogo-veb-prilozhenija-na-servletakh-i-jsp-chastjh-1" target="_blank">часть 1</a>, <a href="https://javarush.com/groups/posts/356-sozdanie-prostogo-veb-prilozhenija-na-servletakh-i-jsp-chastjh-2" target="_blank">часть 2</a>), где автор подробно расписывает создание простейшего приложения на сервлетах и jsp.
<h2 id="Как_встроить_приложение_в_работающий_сервер">Как встроить приложение в работающий сервер</h2>Несмотря на то, что встроенный Tomcat в IDEA — удобная фича, веб-приложение может быть перенесено на другой сервер и в другой контейнер. Рассмотрим вариант, когда необходимо встроить свое приложение в уже работающий сервер. 

Во-первых, необходимо дополнительно разобрать <strong>цель и функции контейнера сервлетов</strong>. 

Программа, которая приведена в примере выше — это веб-приложение. Класс <code>TimeWorker</code> — сервлет. Компоненты выполняют исключительно обработку запросов. Данные компоненты должны быть встроены в специальный контейнер сервлетов.<strong> Цель контейнера сервлетов</strong> — поддержка сервлетов и обеспечение их жизненного цикла. 

Простейший пример работы Tomcat — сканирование определенной папки с целью определить, появился ли в ней новый сервлет. Если да — инициализировать его и подготовить к приему запросов от клиентов. Если сервлет был обновлен, провести повторную инициализацию для обновления компонентов. При удалении сервлета — остановить обработку запросов, удалить сервлет из Tomcat.
<h3 id="Функции_контейнера_сервлетов">Функции контейнера сервлетов</h3><ol>
<li>Обмен данными между сервлетом и клиентами;</li>
<li>Организация клиентских сессий;</li>
<li>Создание программной среды для функционирования сервлета;</li>
<li>Идентификация и авторизация клиентов;</li>
<li>В большинстве случаев — управление метаданными (заголовки, методы и прочее).</li>
</ol>Во-вторых, необходимо разобраться, <strong>как установить свой сервлет</strong>. 
<h3 id="Установка_сервлета">Установка сервлета</h3>Tomcat принимает для обработки веб-приложения на Java, которые имеют расширение .war. Это как jar, только web.

Файлы такого типа объединяют в себе JSP-файлы, сервлеты, class-файлы, статические ресурсы и прочее. При установке такого файла в Tomcat происходит его распаковка, а затем запуск, поэтому существует строгое требование к структуре файлов в проекте. Если проект был создан в IDEA, вся структура создана автоматически.

Файл war можно создать стандартными средствами IDEA. Для этого необходимо зайти в <em>ProjectStructure</em> -&gt; <em>Artifacts</em> -&gt; Нажать “<em>+</em>” -&gt; <em>WebApplication: Archive</em>.

В открывшемся поле задать имя для итогового war-файла, например deployed_war. Ниже необходимо нажать на кнопку <em>Create Manifest…</em>

Далее необходимо указать путь к папке web проекта. В ней будет создана папка META-INF, в которую будет помещен файл MANIFEST.MF.

Далее следует нажать <em>Apply</em> и <em>Ok</em>.

Чтобы собрать проект в war-файл, следует во вкладке <em>Build</em> выбрать опцию <em>Build Artifact</em>:
<img data-id="149cecfb-7f9d-407a-bee3-e83e0bbee9ee" data-max-width="500" alt="Tomcat в Java - 7" src="https://cdn.javarush.com/images/article/149cecfb-7f9d-407a-bee3-e83e0bbee9ee/1024.jpeg">В появившемся поле нужно нажать на <em>deployed_war</em>. Затем начнется сборка проекта и Intellij IDEA создаст папку out, в которой появится папка artifacts с именем нашего артефакта. В этой папке будет лежать файл deployed_war.war:
<img data-id="19410218-cdc0-4e15-b915-2302b1750b60" data-max-width="500" alt="Tomcat в Java - 8" src="https://cdn.javarush.com/images/article/19410218-cdc0-4e15-b915-2302b1750b60/1024.jpeg">Теперь можно деплоить этот файл в Tomcat.

Деплой приложения проще всего выполнить из веб-интерфейса Tomcat.

Просто нажмите <em>кнопку выбора файла</em> на вкладке Deploy, перейдите к местоположению файла WAR и выберите его, затем нажмите <em>кнопку развертывания</em>.

В обоих случаях, если все пойдет хорошо, консоль Tomcat сообщит нам, что развертывание прошло успешно примерно таким выводом в консоль:

<em><strong>INFO: Deployment of web application archive \path\to\deployed_war has finished in 4,833 ms</strong></em>

<div class="email-subscription"><iframe frameborder="0" src="https://secure.esputnik.com.ua/4Q0Ef6d2SOs" width="100%" height="200" scrolling="no"></iframe></div><h2 id="Польза_Tomcat_для_разработки">Польза Tomcat для разработки</h2>Для разработчиков контейнеры сервлетов имеют огромную роль, так как решают целый спектр проблем. Для программирования на Java Tomcat обеспечивает несколько серьезных преимуществ:
<ol>
<li><p>Самое главное, Tomcat может выполнять роль полноценного web-сервера. Благодаря этому развертывание приложений происходит гораздо быстрее, чем было раньше.Также Tomcat может выступать в роли классического контейнера сервлетов, который можно встроить в более крупный веб-сервер.</p></li>
<li><p>Tomcat способствует обмену данными между клиентом и сервлетом, обеспечивает программный контекст для веб-приложений, берет на себя функции идентификации и авторизации клиентов, создание сессий для каждого из них.</p></li>
<li><p>Предоставляет очень удобное управление JSP-страницами. Фактически веб-сервер может отдавать только html. Jasper, компонент Tomcat, компилирует код, содержащийся в шаблонных тегах JSP-страниц в корректный HTML-файл, который получает клиент. Вся логика шаблонизации находится внутри Tomcat, позволяя добавлять даже сложные конструкторы в классическую форму HTML.</p></li>
</ol><strong>И напоследок:</strong> очень часто начинающим разработчикам задают вопрос: возможно ли запустить Java-приложение без <code>main</code>-метода. На первый взгляд, если смотреть на примеры выше, можно. Наш сервлет был выполнен без метода <code>main</code>. Однако это не так. У Tomcat есть собственный метод <code>main</code>, который вызывается при запуске сервера. На такой вопрос можно попасться на собеседовании.
<h2 id="Дополнительные_ссылки">Дополнительные ссылки:</h2><ul>
<li><a href="https://javarush.com/groups/posts/2125-veb-prilozhenie-na-java" target="_blank">Веб-приложение на Java</a></li>
<li><a href="https://javarush.com/groups/posts/328-sozdanie-prostogo-veb-prilozhenija-na-servletakh-i-jsp-chastjh-1" target="_blank">Создание простого веб-приложения на сервлетах и jsp</a></li>
<li><a href="https://metanit.com/java/javaee/2.1.php" rel="nofollow" target="_blank">Установка Tomcat (Метанит)</a></li>
</ul></ciode>