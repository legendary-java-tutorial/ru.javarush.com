Все, что вы хотели знать о Maven. (Часть 2) - "Java-проект от А до Я"
<p>----------------------------------------</p>
Обожаю заниматься практикой. Вы даже не представляете, как иногда бывает нудно писать про теорию. Тем не менее, без неё никуда. Практика — дело другое, конечно. Сейчас быстро...
<p>----------------------------------------</p>
<a href="https://javarush.com/groups/posts/3119-java-proekt-ot-a-do-ja-vse-chto-vih-khoteli-znatjh-o-maven" target="_blank">Все о Maven: начало</a>

Обожаю заниматься практикой. Вы даже не представляете, как иногда бывает нудно писать про теорию. Тем не менее, без неё никуда. 

Практика — дело другое, конечно.

Сейчас быстро пробежимся по командам, которые я ранее описал, и будем заканчивать)<img data-max-width="800" data-id="2b8181b8-6166-4dd4-9e6e-8f88911090b9" src="/images/article/2b8181b8-6166-4dd4-9e6e-8f88911090b9/800.jpeg" alt="&quot;Java-проект от А до Я&quot;: Все, что вы хотели знать о Maven. Часть 2 - 1"><h2>Настраиваем pom.xml</h2>Пока мы теоретизировали, получился вполне себе годный pom.xml:

<details outline-style:="" none;="" display:="" block;=""><summary>Смотреть код</summary><pre class="language-java line-numbers"><code>
&lt;project xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="http://maven.apache.org/POM/4.0.0"
        xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
                     http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
   &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

   &lt;groupId&gt;com.github.javarushcommunity&lt;/groupId&gt;
   &lt;artifactId&gt;maven-demo&lt;/artifactId&gt;
   &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
   &lt;packaging&gt;jar&lt;/packaging&gt;

   &lt;name&gt;Maven Demo Project&lt;/name&gt;

   &lt;url&gt;https://github.com/javarushcommunity/maven-demo/&lt;/url&gt;

   &lt;licenses&gt;
       &lt;license&gt;
           &lt;name&gt;The Apache Software License, Version 2.0&lt;/name&gt;
           &lt;url&gt;http://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt;
       &lt;/license&gt;
   &lt;/licenses&gt;

   &lt;developers&gt;
       &lt;developer&gt;
           &lt;id&gt;romankh3&lt;/id&gt;
           &lt;name&gt;Roman Beskrovnyi&lt;/name&gt;
           &lt;email&gt;roman.beskrovnyy@gmail.com&lt;/email&gt;
       &lt;/developer&gt;
   &lt;/developers&gt;

   &lt;scm&gt;
       &lt;connection&gt;git@github.com:javarushcommunity/maven-demo.git&lt;/connection&gt;
       &lt;developerConnection&gt;git@github.com:javarushcommunity/maven-demo.git&lt;/developerConnection&gt;
       &lt;url&gt;https://github.com/javarushcommunity/maven-demo&lt;/url&gt;
   &lt;/scm&gt;

   &lt;properties&gt;
       &lt;mockito.version&gt;2.26.0&lt;/mockito.version&gt;
       &lt;junit.version&gt;5.5.2&lt;/junit.version&gt;
       &lt;image.comparison.version&gt;4.3.0&lt;/image.comparison.version&gt;
       &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;
       &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;
       &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
       &lt;javadoc.plugin.version&gt;3.1.1&lt;/javadoc.plugin.version&gt;
       &lt;source.plugin.version&gt;3.2.0&lt;/source.plugin.version&gt;
   &lt;/properties&gt;

   &lt;dependencies&gt;
       &lt;dependency&gt;
           &lt;groupId&gt;org.mockito&lt;/groupId&gt;
           &lt;artifactId&gt;mockito-core&lt;/artifactId&gt;
           &lt;version&gt;${mockito.version}&lt;/version&gt;
           &lt;scope&gt;test&lt;/scope&gt;
       &lt;/dependency&gt;
       &lt;dependency&gt;
           &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;
           &lt;artifactId&gt;junit-jupiter-api&lt;/artifactId&gt;
           &lt;version&gt;${junit.version}&lt;/version&gt;
           &lt;scope&gt;test&lt;/scope&gt;
       &lt;/dependency&gt;
       &lt;dependency&gt;
           &lt;groupId&gt;com.github.romankh3&lt;/groupId&gt;
           &lt;artifactId&gt;image-comparison&lt;/artifactId&gt;
           &lt;version&gt;${image.comparison.version}&lt;/version&gt;
       &lt;/dependency&gt;
   &lt;/dependencies&gt;

   &lt;build&gt;
       &lt;plugins&gt;
           &lt;plugin&gt;
               &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
               &lt;artifactId&gt;maven-source-plugin&lt;/artifactId&gt;
               &lt;version&gt;${source.plugin.version}&lt;/version&gt;
               &lt;executions&gt;
                   &lt;execution&gt;
                       &lt;id&gt;attach-sources&lt;/id&gt;
                       &lt;goals&gt;
                           &lt;goal&gt;jar&lt;/goal&gt;
                       &lt;/goals&gt;
                   &lt;/execution&gt;
               &lt;/executions&gt;
           &lt;/plugin&gt;
           &lt;plugin&gt;
               &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
               &lt;artifactId&gt;maven-javadoc-plugin&lt;/artifactId&gt;
               &lt;version&gt;${javadoc.plugin.version}&lt;/version&gt;
               &lt;executions&gt;
                   &lt;execution&gt;
                       &lt;id&gt;attach-javadocs&lt;/id&gt;
                       &lt;goals&gt;
                           &lt;goal&gt;jar&lt;/goal&gt;
                       &lt;/goals&gt;
                   &lt;/execution&gt;
               &lt;/executions&gt;
           &lt;/plugin&gt;
       &lt;/plugins&gt;
   &lt;/build&gt;
&lt;/project&gt;
</code></pre></details>
— Но, чтобы было что компилировать, его нужно добавить туда! Логично? 
— Да, капитан.
бгг

Поэтому добавим класс, в котором будет метод и два теста на него. Создадим обычную схему папок для Мавена:

<div class="terminal">src
	main
		java
		resources
	test
		java
		resources</div>
В <span class="text-bold">src/main/java</span> создадим пакет, в котором будем работать. Чтобы составить его правильно, хорошо бы поставить в начало название организации (<span class="text-bold">groupId</span>), а потом имя проекта. В нашем случае это будет так:

<span class="text-bold">com.github.javarushcommunity.mavendemo</span>

Как по мне, то очень неплохой пакет. В нем создадим класс <span class="text-bold">ImageComparator</span>, к которому напишем два теста.<h2>Подключаем Мавен и проект в целом к IDEA</h2>Чтобы идея смогла распознать наши зависимости и предложить их использовать в проекте, нужно сделать несколько вещей:<ol>

<li>Сказать идее, где будут исходники кода, а где будут тесты.</li>
<li>Добавить мавен проект в идею.</li>

</ol>Чтобы добиться первого, нужно найти такой значок:<img data-max-width="1080" data-id="9a82072f-f74f-4b58-831c-655cf3262510" src="/images/article/9a82072f-f74f-4b58-831c-655cf3262510/original.jpeg" alt="&quot;Java-проект от А до Я&quot;: Все, что вы хотели знать о Maven. Часть 2 - 2">Нажать на него и перейти в секцию <span class="text-bold">Modules</span>. Далее нужно задать созданным папкам нужный маркер, как показано на рисунке ниже:<img data-max-width="1080" data-id="bcf910f2-2726-47fb-b311-2e9086951f4d" src="/images/article/bcf910f2-2726-47fb-b311-2e9086951f4d/original.jpeg" alt="&quot;Java-проект от А до Я&quot;: Все, что вы хотели знать о Maven. Часть 2 - 3">То есть:<ul style="list-style: none;">
<li>• <span class="text-bold">src/main/java</span> — Sources</li>
<li>• <span class="text-bold">src/main/resources</span> — Resources</li>
<li>• <span class="text-bold">src/test/java</span> — Tests</li>
<li>• <span class="text-bold">src/test/resources</span> — Test Resources</li>
<li>• <span class="text-bold">target</span> — Excluded</li>

</ul>Все эти Sources, Resources, Test, Test Resources и Excluded можно найти на строчке, где написано <span class="text-bold">Mark as</span>. Выбираете папку и маркаете ее соответственно.

И второй шаг — добавить мавен проект в ИДЕЮ, чтобы она могла творить свою магию.

Для этого нужно найти в ИДЕЕ файл pom.xml и правой кнопкой мыши выбрать <span class="text-bold">Add as Maven Project</span>. И все, будет вам счастье (:<img data-max-width="512" data-id="38c1710d-9978-4193-b489-9ba74530cf71" src="/images/article/38c1710d-9978-4193-b489-9ba74530cf71/original.jpeg" alt="&quot;Java-проект от А до Я&quot;: Все, что вы хотели знать о Maven. Часть 2 - 4">После этого справа появится плашка <span class="text-bold">Maven</span>, которую можно будет открыть и запускать в ней команды для мавена.<img data-max-width="1080" data-id="124735d7-c76f-46d4-b017-1a4ae7f0371d" src="/images/article/124735d7-c76f-46d4-b017-1a4ae7f0371d/original.jpeg" alt="&quot;Java-проект от А до Я&quot;: Все, что вы хотели знать о Maven. Часть 2 - 5"><h2>Пишем исходники и тесты к нашему “проекту”</h2>Так, мавен в идею добавили, теперь опишем класс, который будет выступать для нас в роли исходников:<h3>ImageComparator:</h3>
<pre class="language-java line-numbers"><code>
package com.github.javarushcommunity.mavendemo;

import com.github.romankh3.image.comparison.ImageComparison;
import com.github.romankh3.image.comparison.model.ImageComparisonResult;
import com.github.romankh3.image.comparison.model.ImageComparisonState;

import java.awt.image.BufferedImage;

/**
* Class created for answering, does two images the same or not.
*/
public class ImageComparator {

   /**
    * Method, which says the same images or not.
    *
    * @param image1 image1 for comparison
    * @param image2 image2 for comparison
    * @return return true, if images are the same, false - otherwise.
    */
   public boolean isTheSameImages(BufferedImage image1, BufferedImage image2) {
       //Create ImageComparison object
       ImageComparison imageComparison = new ImageComparison(image1, image2);

       //Compare images
       ImageComparisonResult imageComparisonResult = imageComparison.compareImages();

       //Check, that ImageComparisonState is MATCH:
       return ImageComparisonState.MATCH == imageComparisonResult.getImageComparisonState();
   }
}
</code></pre>
Под это дело создадим тесты. Класс, который тестирует, должен находиться в том же пакете, только в src/test/java.

Идея об этом знает, и можно воспользоваться ее возможностями.

Для этого на имени класс в самом файле нажимаем мышкой, и на появившейся лампочке выбираем Create test:<img data-max-width="1080" data-id="305ee94f-b662-440f-9fc3-3832c190f5e6" src="/images/article/305ee94f-b662-440f-9fc3-3832c190f5e6/original.jpeg" alt="&quot;Java-проект от А до Я&quot;: Все, что вы хотели знать о Maven. Часть 2 - 6">Нам предложат выбрать настройки для будущего теста. Ничего не ставим, просто жмем OK:<img data-max-width="800" data-id="b42903ad-35c2-4c84-828d-aa39157f3aa3" src="/images/article/b42903ad-35c2-4c84-828d-aa39157f3aa3/original.jpeg" alt="&quot;Java-проект от А до Я&quot;: Все, что вы хотели знать о Maven. Часть 2 - 7">Для нашего теста возьмем из тестовых картинок image-comparison и положим их в тестовые ресурсы (src/test/resource).
 
После этого напишем два теста. Один будет проверять, что эти две картинки разные. А в другой передадим одинаковую картинку и будем ожидать ответ, что они одинаковые. 

После получим такой тест:

<pre class="language-java line-numbers"><code>
package com.github.javarushcommunity.mavendemo;

import com.github.romankh3.image.comparison.ImageComparisonUtil;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;

import java.awt.image.BufferedImage;

@DisplayName("Unit-level testing for ImageComparator")
class ImageComparatorTest {

   private final ImageComparator comparator = new ImageComparator();
  
   @Test
   public void shouldConfirmImagesNotTheSame() {
       //given
       BufferedImage image1 = ImageComparisonUtil.readImageFromResources("image1.png");
       BufferedImage image2 = ImageComparisonUtil.readImageFromResources("image2.png");

       //when
       boolean theSameImages = comparator.isTheSameImages(image1, image2);

       //then
       Assertions.assertFalse(theSameImages);
   }

   @Test
   public void shouldConfirmImagesTheSame() {
       //given
       BufferedImage image1 = ImageComparisonUtil.readImageFromResources("image1.png");

       //when
       boolean theSameImages = comparator.isTheSameImages(image1, image1);

       //then
       Assertions.assertTrue(theSameImages);
   }
}
</code></pre>
Тесты очень простые, останавливаться на них не буду. Если вам это будет интересно, как-нибудь напишу статью о тестировании (напишите об этом в комментариях). <h2>Выполняем команды Мавена</h2>Вот теперь, когда все уже готово для того, чтобы посмотреть работу команд, выбираем в плашке Maven наш проект и раскрываем в нем <span class="text-bold">Lifecycle</span>:<img data-max-width="512" data-id="da0fe164-c006-4f94-92de-4d2f5f927d11" src="/images/article/da0fe164-c006-4f94-92de-4d2f5f927d11/original.jpeg" alt="&quot;Java-проект от А до Я&quot;: Все, что вы хотели знать о Maven. Часть 2 - 8">Теперь нажмем <span class="text-bold">compile</span> и посмотрим, что получилось:<img data-max-width="1080" data-id="a70367d3-12d4-41df-963b-373d9c720979" src="/images/article/a70367d3-12d4-41df-963b-373d9c720979/original.jpeg" alt="&quot;Java-проект от А до Я&quot;: Все, что вы хотели знать о Maven. Часть 2 - 9">Из этого можно сделать два вывода:<ol>
<li>Скомпилировались наши исходники и поместили их в указанный путь.</li>
<li>Команда прошла успешно — BUILD SUCCESS.</li>

</ol>И реально, если мы пойдем в структуру проекта и посмотрим, что там изменилось, то увидим, что добавилась папка <span class="text-bold">target</span>, которую еще можно исследовать и найти-таки наш скомпилированный класс <span class="code">ImageComparator</span>:<img data-max-width="800" data-id="39690c04-027c-4615-931f-0a701e8d5726" src="/images/article/39690c04-027c-4615-931f-0a701e8d5726/original.jpeg" alt="&quot;Java-проект от А до Я&quot;: Все, что вы хотели знать о Maven. Часть 2 - 10">Теперь хотелось бы начать новую команду package с чистого листа. Для этого запустим (два раза нажмем) на команду <span class="text-bold">clean</span>:<img data-max-width="800" data-id="4e0bd786-3a21-4786-afa9-fa4f43f99dea" src="/images/article/4e0bd786-3a21-4786-afa9-fa4f43f99dea/original.jpeg" alt="&quot;Java-проект от А до Я&quot;: Все, что вы хотели знать о Maven. Часть 2 - 11">В результате нам говорят, что удалили папку <span class="text-bold">target</span>, в которой хранилось все, что создали после команды <span class="text-bold">compile</span>.

Запустим команду <span class="text-bold">test</span>: <img data-max-width="800" data-id="ccb34f52-c69f-407a-a5cd-05d13fe44a00" src="/images/article/ccb34f52-c69f-407a-a5cd-05d13fe44a00/original.jpeg" alt="&quot;Java-проект от А до Я&quot;: Все, что вы хотели знать о Maven. Часть 2 - 12">Tests run: 0… а ведь мы же написали целых ДВА. То есть почему-то тесты не запустились. Живой кодинг он такой, уходим в веб)

За 5 минут гугления нашел, что с  JUnit5 нужно добавить еще один плагин:

<pre class="language-java line-numbers"><code>
&lt;plugin&gt;
   &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
   &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
   &lt;version&gt;2.22.2&lt;/version&gt;
&lt;/plugin&gt;
</code></pre>
Добавим его в проект, вынесем версию в <span class="code">&lt;properties/&gt;</span> как умеем и перезапустим <span class="text-bold">test</span>:<img data-max-width="1080" data-id="6e6b79bc-925c-4be4-af7e-87221dff7732" src="/images/article/6e6b79bc-925c-4be4-af7e-87221dff7732/original.jpeg" alt="&quot;Java-проект от А до Я&quot;: Все, что вы хотели знать о Maven. Часть 2 - 13">Вот теперь другое дело! Два теста запустились и прошли успешно. Огонь!

Теперь запускаем наш <span class="text-bold">package</span> и ожидаем, что найдем джарник в <span class="text-bold">target</span> папке:<img data-id="15d3f804-e821-443c-9b5f-1a680c3a0c8e" src="/images/article/15d3f804-e821-443c-9b5f-1a680c3a0c8e/original.jpeg" alt="&quot;Java-проект от А до Я&quot;: Все, что вы хотели знать о Maven. Часть 2 - 14">То есть мы видим опять, что тесты прошли, и после этого (гарантии, что все в проекте хорошо) мы можем собирать проект в архив. На рисунке видно, что в логах запуска мавена и структуре проекта архив есть.

Следующий у нас <span class="text-bold">install</span>. Отличная команда.

О, пока не забыл. Хорошим тоном считается перед выполнением новой команды почистить проект, выполнив <span class="text-bold">clean</span>. Это избавит от глупостей в будущем — гарантирую по своему опыту)))

Поэтому вначале запускаем <span class="text-bold">clean</span>, а потом уж <span class="text-bold">install</span>:<img data-max-width="1080" data-id="5a1fab62-7444-481c-abc5-22164c142aff" src="/images/article/5a1fab62-7444-481c-abc5-22164c142aff/original.jpeg" alt="&quot;Java-проект от А до Я&quot;: Все, что вы хотели знать о Maven. Часть 2 - 15">Там, где стрелочка, отлично видно, где находится локальный репозиторий. Исходя из того, что пишут, у меня это на пути: 

<span class="text-bold">/Users/roman_beskrovnyi/.m2</span>

А сам архив будет находиться здесь:

<span class="text-bold">/Users/roman_beskrovnyi/.m2/repository/com/github/javarushcommunity/maven-demo/1.0-SNAPSHOT</span>

И если мы зайдем в терминал и попытаемся попасть в папку, где находится архив, то он будет там лежать:<img data-max-width="1080" data-id="c9d31f79-b997-4049-86e8-bb38e708d513" src="/images/article/c9d31f79-b997-4049-86e8-bb38e708d513/original.jpeg" alt="&quot;Java-проект от А до Я&quot;: Все, что вы хотели знать о Maven. Часть 2 - 16">deploy нам показать не выйдет, а другие пока вам не нужны…<table><tbody><tr><th>Полезные ссылки:</th></tr>
<tr><td><ul><li><a href="https://habr.com/ru/post/524288/" rel="nofollow" target="_blank">Что такое XML / Хабр</a></li>
<li><a href="https://habr.com/ru/post/78252/" rel="nofollow" target="_blank">Maven — зачем? / Хабр</a></li></ul></td></tr></tbody></table><h2>Вместо вывода</h2>Сегодня мы быстро прошлись по тому, что такое Maven, что там есть, какие основные команды там есть. Я постарался донести это просто и с примерами. 

Все исходники примера лежат в организации JavaRush Community на GitHub в проекте <a href="https://github.com/javarushcommunity/maven-demo" rel="nofollow" target="_blank">maven-demo</a>.

Все вопросы пишите в комментариях.

Традиционно предлагаю подписаться на <a href="https://github.com/romankh3" rel="nofollow" target="_blank">мой аккаунт на гитхабе</a>, чтобы не пропустить новый код для нашего проекта JRTB. 

Еще раз повторю, он не мертв. Он был просто в стазисе))

<h4><a href="https://javarush.com/groups/posts/2935-java-proekt-ot-a-do-ja-pishem-realjhnihy-proekt-dlja-portfolio#articles" target="_blank">Список всех материалов серии в начале этой статьи.</a></h4>