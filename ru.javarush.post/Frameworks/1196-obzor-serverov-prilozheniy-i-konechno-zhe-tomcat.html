Обзор серверов приложений и, конечно же, Tomcat
<p>----------------------------------------</p>
Дорогие джаварашовцы, что я хочу рассмотреть в этой статье? Я просто хочу сделать небольшой обзор той части серверов приложений, которые заслуживают внимания хотя бы тем, что являются бесплатными и доступен их исходный код. Я буду исходить из того...
<p>----------------------------------------</p>
Дорогие джаварашовцы, что я хочу рассмотреть в этой статье? Я просто хочу сделать небольшой обзор той части серверов приложений, которые заслуживают внимания хотя бы тем, что являются бесплатными и доступен их исходный код. Я буду исходить из того, что ваша система сходна с моей. У меня стоит Windows 7 64 бита, кроме того у меня стоит JDK 1.7 и JDK 1.8, а переменная окружения <em>JAVA_HOME</em> ссылается на последний из них. В моем случае это значит, что в <em>JAVA_HOME</em> прописан путь <em>C:\Program Files\Java\jdk1.8.0_31.</em>
<img data-id="220d3e29-1c4a-435e-ab8e-e5bfa63c0900" data-max-width="850" alt="Обзор серверов приложений и, конечно же, Tomcat - 1" src="https://cdn.javarush.com/images/article/220d3e29-1c4a-435e-ab8e-e5bfa63c0900/1024.jpeg">Чтобы у вас при повторении ниже описанного возникало как можно меньше вопросов типа «а почему у меня не получилось, может я что-то не так делаю?», я буду пытаться описывать каждое действие, которое я делал на своей машине. Начинаем…
<h2>Кастинг, т.е. отбор</h2>Для начала нужно отобрать сервера приложений для нашего обзора. Для этого на википедии смотрим статью <a href='https://en.wikipedia.org/wiki/List_of_application_servers' rel='nofollow' target='_blank'>Comparison of application servers</a> (англ., т.к. другой нет). Там есть табличка с кучей серверов приложений, но для нас интерес представляют только те, которые, с одной стороны, opensource, а с другой, поддерживают JavaEE по полной, т.е. столбец <em>Java EE compatibility</em> в этой таблице должен содержать строчку типа <em>Full Platform</em>. Из этого списка, в котором есть и <em>WildFly</em>, и <em>JBoss</em> сразу можно выкинуть последний, т.к. это просто старое название и старые версии <em>WildFly</em>. В результате получаем следующий список серверов, которые заслуживают нашего внимания:
<ol>
    <li><strong>Glassfish</strong> (не проприетарный, а тот, что от сообщества <a href='https://javaee.github.io/glassfish/' rel='nofollow' target='_blank'>glassfish.java.net</a>, но который поддерживается корпорацией Oracle до такой степени, что если нужен javaEE SDK с сайта Oracle, то тебе впиндюрят и этот сервер приложений, иначе никак)</li>
    <li><strong>(Red Hat) WildFly</strong> (бывший JBoss)</li>
    <li><strong>(Apache) Geronimo</strong></li>
    <li><strong>(Apache) Tomcat</strong> (это лишь контейнер сервлетов, а не сервер приложений, но он является таким эталоном, на котором, если программа написана правильно, то она точно заработает. На других серверах программа может быть написана правильно с точки зрения JavaEE, но работать все равно будет не корректно или вообще не будет. Это я о Geronimo, о глюках которого можно говорить долго)</li>
</ol>Теперь давайте накачаем этих серверов. 
<ul>
<li>Для <strong>Tomcat</strong> это будет сайт <a href='http://tomcat.apache.org/' rel='nofollow' target='_blank'>http://tomcat.apache.org</a>.</li>
<li>Для <strong>Glassfish</strong> – сайт <a href='http://wildfly.org/' rel='nofollow' target='_blank'>http://glassfish.java.net</a>.</li>
<li>Для <strong>WildFly</strong> – сайт <a href='http://wildfly.org/' rel='nofollow' target='_blank'>http://wildfly.org</a>.</li>
<li>И, наконец, для <strong>Geronimo</strong> – сайт <a href='http://geronimo.apache.org/' rel='nofollow' target='_blank'>http://geronimo.apache.org</a>.</li></ul>Где было можно выбрать между 32-х и 64-хбитными версиями, я выбирал архивчик под мою систему в 64 бита.
<h2>Установка</h2>В плане установки все просто и для каждого из выбранных серверов установка – это просто распаковка архива. Я, например, создал папку AppServers на рабочем столе, куда и стал всё распаковывать.
<h2>Настройка</h2>Настройку серверов начнем с настройки порта HTTP, на котором он будет работать. Потом пропишем себя как админа сервера. Для каждого из серверов есть свои особенности настройки.

<strong>Для Tomcat.</strong> Заходим в папку с распакованным tomcat, далее папка <em>conf</em>, файл <em>server.xml</em>. Находим в этом файле число <em>8080</em> (http порт по умолчанию) и меняем его на что захотим. Я поставил <em>9713</em>.

Чтобы прописать себя как админа сервера нужно, находясь в этой же папке, открыть файл <em>tomcat-users.xml</em>. В нем перед закрывающим тегом <em>&lt;/tomcat-users&gt;</em> прописать следующий тег <em>&lt;user username="egarmin" password="1" roles="manager-gui,manager-script,manager-status,manager-jmx"/&gt;</em> где в своей роли я прописал максимальное количество всяких админских прав (ролей). Это позволит мне деплоить приложения и через gui, и через удаленное подключение.

Теперь запустим tomcat. Заходим в папку с распакованным tomcat, далее папка <em>bin</em> и запускаем файл <em>startup.bat</em>. Переходим в браузере по адресу <a href='http://localhost:9713/' rel='nofollow' target='_blank'>http://localhost:9713</a>. Должно все заработать и мы увидим тигру.
<img data-id="f721a76f-21bc-410c-bda5-87ae8f137483" data-max-width="570" alt="Tomcat" src="https://cdn.javarush.com/images/article/f721a76f-21bc-410c-bda5-87ae8f137483/1024.jpeg">Теперь давайте проверим наличие доступа в админку. Для этого переходим по адресу <a href='http://localhost:9713/manager' rel='nofollow' target='_blank'>http://localhost:9713/manager</a>, вводим выбранные логин и пароль и получаем доступ.
<img data-id="4913cd51-a37f-403d-9fda-e3fef2f94a85" data-max-width="570" alt="Админка в Tomcat" src="https://cdn.javarush.com/images/article/4913cd51-a37f-403d-9fda-e3fef2f94a85/1024.jpeg">УРА! Можно временно отключить Tomcat, для этого достаточно закрыть консоль, в которой он работает.

<strong>Для Glassfish.</strong> Заходим в папку с распакованным <em>glassfish</em>, далее в подпапку <em>glassfish</em>, далее подпапка <em>domains</em>, потом в папку <em>domain1</em>. Заходим в папку <em>config</em> и находим файл <em>domain.xml</em>. Там также ищем число <em>8080</em> (это число вообще характерно в качестве http-порта по умолчанию для серверов приложений и контейнеров сервлетов) и меняем его на что захотим. Я поставил <em>9813</em>.

Запустим glassfish. Заходим в папку с распакованным glassfish, далее в подпапку <em>glassfish</em>, потом в папку <em>bin</em>. Запускаем файл <em>startserv.bat</em>. В браузере вводим адрес <a href='http://localhost:9813/' rel='nofollow' target='_blank'>http://localhost:9813</a>. На появившейся некрасивой странице с заголовком <em>GlassFish Server</em> находим ссылку <em>go to the Administration Console</em> и жмем на нее.
<img data-id="6c93fd86-765a-4d74-a9d5-ee2f9dd84363" data-max-width="570" alt="Первый вход в GlassFish" src="https://cdn.javarush.com/images/article/6c93fd86-765a-4d74-a9d5-ee2f9dd84363/1024.jpeg">Далее, попав на красивую построенную на JSF страницу административной консоли, жмем пункт <em>Change Administrator Password</em>
<img data-id="391ee430-ec1e-4c90-9e5d-e3d185cc7dac" data-max-width="570" alt="Админка в GlassFish" src="https://cdn.javarush.com/images/article/391ee430-ec1e-4c90-9e5d-e3d185cc7dac/1024.jpeg">и вводим нужный нам пароль для пользователя <em>admin</em>, потом подтверждаем его и жмем кнопку <em>Save</em>.
<img data-id="8657aa3a-ff94-49be-81ed-fcfa1b2cf1c6" data-max-width="570" alt="Смена пароля в GlassFish" src="https://cdn.javarush.com/images/article/8657aa3a-ff94-49be-81ed-fcfa1b2cf1c6/1024.jpeg">При последующих входах в административную консоль нужно будет указывать логин <em>admin</em> и заданный пароль.
<img data-id="c6015011-ad1d-4ecd-9bea-00ce6d065fac" data-max-width="570" alt="Вход в админку GlassFish по паролю" src="https://cdn.javarush.com/images/article/c6015011-ad1d-4ecd-9bea-00ce6d065fac/1024.jpeg">Теперь можно временно отключить <em>Glassfish</em>, для этого достаточно закрыть консоль, в которой он работает.

<strong>Для WildFly.</strong> Заходим в папку с распакованным <em>wildfly</em>. Далее заходим в папку <em>standalone</em>, потом папка <em>configuration</em>, а в ней файл <em>standalone.xml</em>. Далее действуем по отлаженной схеме. Я поставил порт <em>9913</em>.

Запустим сервер. Для этого перейдем в папку с распакованным <em>wildfly</em>. Далее заходим в папку <em>bin</em> и запускаем файл <em>standalone.bat</em>. Открываем браузер и вводим адрес <a href='http://localhost:9913' rel='nofollow' target='_blank'>http://localhost:9913</a>.
<img data-id="5b42fcb8-efa9-4aad-9cb9-fddac80e99ae" data-max-width="570" alt="Первый вход в WildFly" src="https://cdn.javarush.com/images/article/5b42fcb8-efa9-4aad-9cb9-fddac80e99ae/1024.jpeg">Жмем ссылку <em>Administration Console</em> для входа в админскую консоль (проще говоря, админку сервера приложений). Но не тут-то было, т.к. всплывает экран.
<img data-id="f5cd5ad1-c4e7-43f6-ab2a-0aa75ba9eae1" data-max-width="570" alt="Первый вход в админку WildFly" src="https://cdn.javarush.com/images/article/f5cd5ad1-c4e7-43f6-ab2a-0aa75ba9eae1/1024.jpeg">Этот экран сообщает нам, что админ не создан, и чтобы его создать нужно воспользоваться консольной утилитой <em>add-user.bat</em>. Ну, раз надо так надо. Возвращаемся в папку <em>bin</em> и запускаем эту утилиту. Вначале предложат выбрать тип пользователя, которого мы хотим создать. Надо выбрать пункт <em>(a)</em>, что будет означать, что нам нужен админ. Потом запрашивается имя этого пользователя <em>Username</em> и пароль <em>Password</em>. Пустым пароль быть не может, но односимвольным – пожалуйста. Утилита конечно поругается, но проглотит, если ей ответить yes на вопрос «Вы уверены?». Далее подтверждаем пароль повторным вводом на запрос <em>Re-enter Password</em>. Потом будут еще вопросы, но на них все просто отвечаем утвердительно и выходим из утилиты.

Вернувшись на страницу выше, находим ссылку <em>Try Again</em> и жмем на нее. Теперь, введя данные только что созданного админа, можно попасть в админку.
<img data-id="3ecf923c-a32b-45c4-a68b-de6536ce25cb" data-max-width="570" alt="Админка в WildFly" src="https://cdn.javarush.com/images/article/3ecf923c-a32b-45c4-a68b-de6536ce25cb/1024.jpeg">Гасим сервер, закрыв окно консоли, через которую он был запущен.

<strong>Для Geronimo.</strong> Заходим в папку с распакованным <em>geronimo</em>. Далее в подпапку <em>var</em>, потом в папку <em>config</em>, а в ней файл <em>config-substitutions.properties</em>. В этом файле описаны все используемые сервером приложений порты в удобном формате, но схема замены порта та же. Я поставил порт <em>10013</em>.

Запустим сервер <em>geronimo</em>. Перейдем в папку с распакованным <em>geronimo</em>, потом в подпапку <em>bin</em> и запустим там файл <em>startup.bat</em>. Переходим на страницу <a href='http://localhost:10013/' rel='nofollow' target='_blank'>http://localhost:10013</a>. Чтобы вы думали?

Скорее всего, страницы там не будет. Почему? Все дело в том, последняя версия Geronimo (3.0) не может работать с последней версией JDK (1.8), поэтому если у вас стоит только она или пусть даже есть, скажем, 7-ая версия, но переменная окружения JAVA_HOME все равно ссылается именно на 8-ую, как у меня, то запуск сервера приложений не произойдет. Таким образом, для работы Geronimo нужно обязательно скачать JDK 1.7.

Теперь допустим вы поставили 7-ой JDK, но не хотите менять значение переменной JAVA_HOME (в конце-то концов, другие программы на нее не жалуются, а значит пусть и работают с последней версией JDK). Что делать? Я советую открыть файл <em>setjavaenv.bat</em>, расположенный в той же папке <em>bin</em>, и найти в нем строку с меткой <em>:okJdkFileCheck</em>. После чего на следующей же строке добавьте переопределение переменной окружения. Например, так: <em>set JAVA_HOME=C:\Program Files\Java\jdk1.7.0_75</em>Этой строки там нет, так что будьте добры прописать ее самостоятельно.

Если у вас 32-битная система, то больше проблем быть не должно. Более того, если у вас 64-битная система и вы поставили JDK 1.7 именно в 64-битной комплектации, то у вас тоже все в шоколаде. А теперь представим, что мы решили извратиться и поставить на 64-х битную систему (у меня, например, Windows 7 64) JDK 1.7 из линейки в 32-ва бита. Что тогда? Тогда придется еще повозиться, потому как в 64-битной системе есть две папки для установки программ: <em>Program Files</em> и <em>Program Files (x86)</em> и если ничего не менять, то 32-хбитный JDK встанет именно в последнюю. Что в этом страшного? Да вроде ничего, однако, если переменная JAVA_HOME будет иметь в своем пути скобки (x86), то у Geronimo случается несварение. Почему? Черт его знает, особенно если учесть, что согласно данным с форумов, эту ошибку в 3-ей версии <strong>Geronimo</strong> должны были исправить. Но ни фига подобного. Главное в этом деле не делать пи-пи, если индейцы не исправили, то мы поправим. Для этого есть два способа, которые я предпочитаю комбинировать, чтобы уж наверняка. Во-первых, опять идем а файл <em>setjavaenv.bat</em> и находим уже упомянутую метку <em>:okJdkFileCheck</em>. 

Под этой меткой есть строка <em>if "%JRE_HOME%" == "" if exist "%JAVA_HOME%\bin\javac.exe" (set JRE_HOME=%JAVA_HOME%\jre) else set JRE_HOME=%JAVA_HOME%</em> в которой для излечения Geronimo достаточно будет взять подстроку JRE_HOME=%JAVA_HOME%\jre в кавычки, т.е. заменить всю строку на <em>if "%JRE_HOME%" == "" if exist "%JAVA_HOME%\bin\javac.exe" (set "JRE_HOME=%JAVA_HOME%\jre") else set JRE_HOME=%JAVA_HOME%</em>. Кроме того, помните или знайте, что у папок типа Program Files в системе Windows 7 есть синонимы (например, для папки <em>C:\Program Files (x86)</em> синонимом будет папка <em>C:\Progra~2</em>). Поэтому если вы в файле <em>setjavaenv.bat</em> после метки <em>:okJdkFileCheck</em> установите следующее значение переменной <em>JAVA_HOME set JAVA_HOME=C:\Progra~2\Java\jdk1.7.0_75</em> то у вас тоже заработает сервер <em>Geronimo</em> под управление 32-х битного JDK в 64-х битной операционной системе. Как-то так…

Ну, наконец-то, можно и запускать <strong>Geronimo</strong>, вызвав <em>startup.bat</em>. Теперь проблем быть не должно. Переходим в браузере на страницу <a href='http://localhost:10013' rel='nofollow' target='_blank'>http://localhost:10013</a>. Слева вверху находим ссылку <em>Console</em> и жмем на нее.
<img data-id="a4071e52-3679-4f45-8142-998bb0924dda" data-max-width="570" alt="Geronimo" src="https://cdn.javarush.com/images/article/a4071e52-3679-4f45-8142-998bb0924dda/1024.jpeg">Надо ввести админские логин и пароль. Сразу подскажу, что это пользователь <em>system</em> с паролем <em>manager</em> (значения по умолчанию).
<img data-id="7a21043f-9174-4abd-b712-5b508dc7ff6e" data-max-width="570" alt="Вход в админку Geronimo по паролю" src="https://cdn.javarush.com/images/article/7a21043f-9174-4abd-b712-5b508dc7ff6e/1024.jpeg">Пройдя в саму консоль и проследовав по пунктам меню как на картинке ниже (выбрать радиобатон <em>Advanced</em>, потом выбрать <em>Security > Users and Groups</em>), можно как сменить пароль для пользователя <strong>system</strong>, так и создать другого админского пользователя, а этого удалить.
<img data-id="c6ffcb5a-a55b-4315-8d8c-f1924c2b9c87" data-max-width="570" alt="Смена пароля в Geronimo" src="https://cdn.javarush.com/images/article/c6ffcb5a-a55b-4315-8d8c-f1924c2b9c87/1024.jpeg">Остановить сервер <em>Geronimo</em> можно также простым закрытием окна консоли, в котором сервер был запущен.
<h2>Заключение</h2>В этом обзоре я, по сути, просто провел установку и первоначальную настройку популярных серверов приложений и контейнера сервлетов Tomcat. За исключение Geronimo, остальные сервера были очень дружелюбны ко мне и проявили гостеприимство.

В следующем посте я продолжу рассмотрение серверов приложений и сделаю 3-ий шаг на пути рассмотрения веб-сервисов, а именно, покажу как задеплоить описанный <a href='https://javarush.com/groups/posts/1168-veb-servisih-shag-1-chto-takoe-veb-servis-i-kak-s-nim-rabotatjh' target='_blank'>на первом шаге</a> веб-сервис в эти сервера. Для этого мы создадим war-архив нашего веб-сервиса, и я наглядно покажу, что набор сторонних jar-ников, которые надо включать в этот архив для корректной работы сервиса, сильно меняется от сервера к серверу.