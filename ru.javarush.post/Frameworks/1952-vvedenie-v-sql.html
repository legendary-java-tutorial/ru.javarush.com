Часть 1. Введение в SQL
<p>----------------------------------------</p>
Эта статья открывает небольшой цикл, посвященный азам взаимодействия с базами данных (БД) в Java и введению в SQL. Многие программы заняты обработкой и модификацией информации, её поддержкой в актуальном состоянии. Поскольку данные — весьма важная часть ...
<p>----------------------------------------</p>
<h3>JDBC. Подключение БД и создание консольного Java приложения в IntelliJ IDEA</h3><h2>Введение</h2>Эта статья открывает небольшой цикл, посвященный азам взаимодействия с <strong><em>базами данных (БД) в Java</em></strong> и<strong><em> введению в SQL</em></strong>. Многие программы заняты обработкой и модификацией информации, её поддержкой в актуальном состоянии. Поскольку данные — весьма важная часть логики программ, то под них зачастую выделяют отдельное хранилище. Информация в нём структурирована и подчинена специальным правилам, чтобы обеспечить правильность обработки и хранения. Доступ к данным и их изменение осуществляется с помощью специального языка запросов — SQL (Structured Query Language).
<div class="row justify-content-center jr-image-wrap"><div class="col-12 col-sm-10 col-md-8"><img data-id="c6be1902-0d88-4e4d-9dbd-3d27facbb34a" data-max-width="710" alt="Часть 1. Введение в SQL - 1" src="https://cdn.javarush.com/images/article/c6be1902-0d88-4e4d-9dbd-3d27facbb34a/1024.jpeg"></div></div><strong>Система управления базами данных</strong> — это  ПО, которое обеспечивает взаимодействие разных внешних программ с данными и дополнительные службы (журналирование, восстановление, резервное копирование и тому подобное), в том числе посредством SQL. То есть программная прослойка между данными и внешними программами с ними работающими. В этой части ответим на вопросы что такое SQL, что такое SQL сервер и создадим первую программу для взаимодействия с СУБД.

<h2>Виды СУБД</h2><strong>Существует несколько видов СУБД по способу организации хранения данных:</strong>
<ul>
<li><strong>Иерархические.</strong> Данные организованы в виде древовидной структуры. Пример — файловая система, которая начинается с корня диска и далее прирастает ветвями файлов разных типов и папок разной степени вложенности.</li>
<li><strong>Сетевые.</strong> Видоизменение иерархической, у каждого узла может быть больше одного родителя.</li>
<li><strong>Объектно-ориентированные.</strong> Данные организованы в виде классов/объектов c их атрибутами и принципами взаимодействия согласно ООП.</li>
<li><strong>Реляционные.</strong> Данные этого вида СУБД организованы в таблицах. Таблицы могут быть связаны друг с другом, информация в них структурирована.</li>
</ul>В цикле статей будем рассматривать именно реляционные СУБД (как самые распространённые) на примере H2 и создавать с нуля приложение, эмулирующую подобие работы биржи.

<em>Вопрос:</em> Почему не PostgreSQL, MySQL, MSSQL или Oracle?

<em>Ответ:</em> Чтобы не отвлекаться на вопросы установки отдельного комплекса программ. Дальнейшей настройки, создания БД, тонкостей работы в разных ОС, версий. Для работы с H2 необходимо совершить минимум действий. Но ничего не мешает поменять текущую H2 JDBC на реляционную СУБД другого производителя (изменяется только строка адреса сервера и имя класса драйвера).

<h2>SQL</h2>Внешние программы формируют запросы к СУБД на языке управления данными Structured Query Language. Что такое SQL и чем отличается от привычных языков программирования? Одна из особенностей SQL – декларативность. То есть, <strong>SQL — декларативный язык</strong>. Это значит, что, вбивая команды, то есть, создавая запросы к SQL-серверу, мы описываем, что именно хотим получить, а не каким способом. Посылая серверу запрос <code>SELECT * FROM CUSTOMER</code> (приблизительный перевод с SQL на русский: <em>«сделать выборку из таблицы COSTUMER, выборка состоит из всех строк таблица»</em>), мы получим данные по всем пользователям. Совершенно неважно, как и откуда сервер загрузит и сформирует интересующие нас данные. Главное – правильно сформулировать запрос.
<ul>
<li>Что такое SQL-Сервер и как он работает? Взаимодействие с СУБД происходит по клиент-серверному принципу. Некая внешняя программа посылает запрос в виде операторов и команд на языке SQL, СУБД его обрабатывает и высылает ответ. Для упрощения примем, что SQL Сервер = СУБД.</li></ul>Если вы умеете управлять легковым автомобилем одной марки, вы, скорее всего, без особых проблем сможете сесть за руль и других. Основы вождения везде одинаковы, за исключением небольших деталей.  Аналогично и для SQL-серверов разных производителей — у каждого из них своя версия SQL, но она удовлетворяет заданным стандартам (SQL92, SQL2003 …). Мы будем использовать операторы и команды в рамках SQL92.

<strong>Основные SQL-операторы подразделяют на следующие группы:</strong>

<ul>
<li>Data Definition Language (<strong>DDL</strong>) – определения данных. Создание структуры БД и её объектов;</li>
<li>Data Manipulation Language(<strong>DML</strong>) – собственно взаимодействие с данными: вставка, удаление, изменение и чтение;</li>
<li>Transaction Control Language (<strong>TCL</strong>) – управление транзакциями;</li>
<li>Data Control Language(<strong>DCL</strong>) – управление правами доступа к данным и структурам БД.</li>
</ul>
В цикле статей мы рассмотрим первые три группы, особо уделяя внимание DML.

<h2>JDBC</h2>В 80-е годы прошлого века персональные компьютеры типа PC XT/AT завоевали рынок. Во многом это произошло благодаря модульности их конструкции. Это означает, что пользователь мог довольно просто менять ту или иную составную часть своего компьютера (процессор, видеокарту, диски и тому подобное).  Это замечательное свойство сохранилось и поныне: мы меняем видеокарту и обновляем драйвер (иногда он и вовсе обновляется сам, в автоматическом режиме). Чаще всего при таких манипуляциях ничего плохого не происходит, и существующие программы продолжат работать с обновившейся системой без переустановки.  

Аналогично и для работы в Java с СУБД. Для стандартизации работы с SQL-серверами взаимодействие с ней можно выполнять через единую точку — <strong><em>JDBC</em></strong> (Java DataBase Connectivity). Она представляет собой реализацию пакета <em>java.sql</em> для работы с СУБД. Производители всех популярных SQL-серверов выпускают для них драйверы JDBC. Рассмотрим схему ниже. Приложение использует экземпляры классов из <em>java.sql</em>. Затем мы передаем необходимые команды для получения/модификации данных. Далее <em>java.sql</em> через <em>jdbc-драйвер</em> взаимодействует с СУБД и возвращает нам готовый результат.
<img data-id="8098e9c9-e40c-4aad-b7c5-93987199aa61" data-max-width="710" alt="Часть 1. Введение в SQL - 2" src="https://cdn.javarush.com/images/article/8098e9c9-e40c-4aad-b7c5-93987199aa61/1024.jpeg">
Для перехода на СУБД другого производителя часто достаточно сменить JDBC и выполнить базовые настройки. Остальные части программы при этом не меняются.

<div class="email-subscription"><iframe frameborder="0" src="https://secure.esputnik.com.ua/4Q0Ef6d2SOs" width="100%" height="200" scrolling="no"></iframe></div><h2>Первая программа</h2>Приступим к практической части. Создадим Java-проект с помощью <strong>IDE JetBrains IntelliJ IDEA</strong>. Заметим, что редакция Ultimate Edition содержит в своём составе замечательный инструмент для работы с SQL и БД — <em>Data Grip</em>.  Однако она платная для большинства пользователей. Так что нам для учебных целей остается использовать общедоступную <em>IntelliJ IDEA Community Edition</em>. Итак: 

<ol>
<li>Запускаем IDE и создадём новый проект:<br>
<img data-id="1d9ddd23-e9f3-4a04-a397-f2f7462d5f8b" data-max-width="271" alt="Часть 1. Введение в SQL - 3" src="https://cdn.javarush.com/images/article/1d9ddd23-e9f3-4a04-a397-f2f7462d5f8b/1024.jpeg"></li><br>
<li>Выбираем Java-проект, указываем версию <em>SDK</em> (в примере JDK8, однако это не критично):<br>
<img data-id="625ca635-6541-41aa-953b-8452d8c657bd" data-max-width="710" alt="Часть 1. Введение в SQL - 4" src="https://cdn.javarush.com/images/article/625ca635-6541-41aa-953b-8452d8c657bd/1024.jpeg"></li><br>
<li>На следующем шаге выбираем в качестве типа <em>консольное приложение</em>:<br>
<img data-id="0103d0df-f123-42e2-8bf2-0d365a05f718" data-max-width="271" alt="Часть 1. Введение в SQL - 5" src="https://cdn.javarush.com/images/article/0103d0df-f123-42e2-8bf2-0d365a05f718/1024.jpeg"></li><br>
<li>Указываем <em>имя</em> проекта, <em>пакет</em> и его <em>размещение</em> на диске (я создал специально для этого отдельную директорию):<br>
<img data-id="1488a998-fd74-46c2-9cab-6d6eb6a3d373" data-max-width="271" alt="Часть 1. Введение в SQL - 6" src="https://cdn.javarush.com/images/article/1488a998-fd74-46c2-9cab-6d6eb6a3d373/1024.jpeg"></li><br>
<li>Отложим на минуту IDE и загрузим c <a href="http://www.h2database.com/html/main.html" rel="nofollow" target="_blank">www.h2database.com</a> необходимый <em>JDBC-файл</em> для работы c <em>СУБД H2</em> (download platform independent ZIP):<br>
 <img data-id="50e7a404-5642-4ef8-b73a-401c46f10cac" data-max-width="710" alt="Часть 1. Введение в SQL - 7" src="https://cdn.javarush.com/images/article/50e7a404-5642-4ef8-b73a-401c46f10cac/1024.jpeg"></li><br>
<li>Заходим внутрь скачанного файла (нас интересует <em>jar-файл</em> по пути <em>h2\bin</em>, который нам далее понадобится, скопируем его):<br>
<img data-id="23a3e3f8-3aa0-4e8f-a83d-11fc1dcc5e54" data-max-width="710" alt="Часть 1. Введение в SQL - 8" src="https://cdn.javarush.com/images/article/23a3e3f8-3aa0-4e8f-a83d-11fc1dcc5e54/1024.jpeg"></li><br>
<li>Возвращаемся в IDE и создаём в корне проекта директории: <strong><em>db</em></strong>, где будут размещены файлы с данными СУБД;  <em><strong>lib</strong></em> – здесь JAR-библиотека JDBC:<br>
<img data-id="12cb4625-95c1-4ff8-bc32-c6f75bd43c68" data-max-width="710" alt="Часть 1. Введение в SQL - 9" src="https://cdn.javarush.com/images/article/12cb4625-95c1-4ff8-bc32-c6f75bd43c68/1024.jpeg"></li><br>
<li>Переносим в директорию <em>lib</em> jar-файл из шага <em>6</em>, и добавим его в проект как библиотеку:<br>
<img data-id="cd622b23-5820-4b51-91da-cad106adbd76" data-max-width="271" alt="Часть 1. Введение в SQL - 10" src="https://cdn.javarush.com/images/article/cd622b23-5820-4b51-91da-cad106adbd76/1024.jpeg"></li><br>
<li>Переименуем java-файл в <em>src/sql/demo</em> на <em>StockExchange.java</em> (если забыли, мы собираемся эмулировать простую «биржу»), поменяем его содержимое и запустим:<br>
<img data-id="992238c7-9aea-4a5e-8444-d993f1c9abdd" data-max-width="710" alt="Часть 1. Введение в SQL - 11" src="https://cdn.javarush.com/images/article/992238c7-9aea-4a5e-8444-d993f1c9abdd/1024.jpeg"></li>
</ol>
Теперь мы умеем подключаться к СУБД и отключаться от неё. Каждый шаг отражается в консоли. При первом подключении к СУБД создаётся файл базы данных <strong><em>stockExchange.mv.db</em></strong>.

<h2>Разбор кода</h2>Собственно код:

<pre class="lang-java line-numbers"><code>
package sql.demo;

import java.sql.*;

public class StockExchangeDB {
    // Блок объявления констант
    public static final String DB_URL = "jdbc:h2:/c:/JavaPrj/SQLDemo/db/stockExchange";
    public static final String DB_Driver = "org.h2.Driver";

    public static void main(String[] args) {
        try {
            Class.forName(DB_Driver); //Проверяем наличие JDBC драйвера для работы с БД
            Connection connection = DriverManager.getConnection(DB_URL);//соединениесБД
            System.out.println("Соединение с СУБД выполнено.");
            connection.close();       // отключение от БД
            System.out.println("Отключение от СУБД выполнено.");
        } catch (ClassNotFoundException e) {
            e.printStackTrace(); // обработка ошибки  Class.forName
            System.out.println("JDBC драйвер для СУБД не найден!");
        } catch (SQLException e) {
            e.printStackTrace(); // обработка ошибок  DriverManager.getConnection
            System.out.println("Ошибка SQL !");
        }
    }
}
</code></pre>
<h3>Блок констант:</h3>
<ol>
<li><strong>DB_Driver</strong>: Здесь мы определили <em>имя</em> драйвера, которое можно узнать, например, кликнув мышкой на подключенную библиотеку и развернув её структуру в директории lib текущего проекта.</li>
<li><strong>DB_URL</strong>: Адрес нашей базы данных. Состоит из данных, разделённых двоеточием: <br>
</li><li>Протокол=jdbc</li>
<li>Вендор (производитель/наименование) СУБД=h2</li>
<li>Расположение СУБД, в нашем случае путь до файла (c:/JavaPrj/SQLDemo/db/stockExchange). Для сетевых СУБД тут дополнительно указываются имена или IP адреса удалённых серверов, TCP/UDP номера портов и так далее.</li></ol>
<h3>Обработка ошибок:</h3>Вызов методов нашего кода может вернуть ошибки, на которые следует обратить внимание. На данном этапе мы просто информируем о них в консоли. Заметим, что ошибки при работе с СУБД — это чаще всего <strong>SQLException</strong>.

<h3>Логика работы:</h3>
<ol>
<li><strong>Class.forName</strong>(DB_Driver) – убеждаемся в наличии соответствующего JDBC-драйвера (который мы ранее загрузили и установили).</li>
<li><strong>DriverManager.getConnection</strong>(DB_URL) – устанавливаем соединение СУБД. По переданному адресу, JDBC сама определит тип и местоположение нашей СУБД и вернёт Connection, который мы можем использовать для связи с БД.</li>
<li><strong>connection.close()</strong> – закрываем соединение с СУБД и завершаем работу с программой.</li>
</ol>
В следующей части цикла мы познакомимся с DDL-операторами и типами SQL-данных, а также создадим начальную структуру нашей БД и наполним её таблицами.

<a href="https://javarush.com/groups/posts/1970-chastjh-2-struktura-subd-tablicih-i-tipih-dannihkh-sozdaem-skelet-nashey-bazih-pervihe-sql-koma" target="_blank"><em><strong>Вторая часть</strong></em></a>
<em><strong><a href="https://javarush.com/groups/posts/1971-chastjh-3-sozdaem-skelet-nashey-bazih-pervihe-sql-komandih-na-primerakh-javasql" target="_blank">Третья часть</a></strong></em>