Обзор REST. Часть 2: коммуникация между клиентом и сервером 
<p>----------------------------------------</p>
В этой части мы подробно рассмотрим, каким образом происходит коммуникация между клиентом и сервером. Попутно мы будем раскрывать новые термины и давать к ним пояснения. Чтобы все было (стало) понятно...
<p>----------------------------------------</p>
<a href="https://javarush.com/groups/posts/2486-obzor-rest-chastjh-1-chto-takoe-rest" target="_blank">Часть 1: что такое REST</a>

В этой части мы подробно рассмотрим, каким образом происходит коммуникация между клиентом и сервером. Попутно мы будем раскрывать новые термины и давать к ним пояснения. 
<img data-max-width="850" alt="Обзор REST. Часть 2: коммуникация между клиентом и сервером  - 1" src="https://cdn.javarush.com/images/article/e926dbe0-7183-49ba-8d3f-7d5a4c66a6a4/original.jpeg">Чтобы все было (стало) понятно, будем разбирать клиент-серверную коммуникацию на примере некоторого RESTful приложения. 

Допустим, мы разрабатываем веб приложение, которое способно хранить информацию о клиентах и их заказах. Т.е. наша система способна манипулировать некоторыми сущностями: создавать их, редактировать, удалять, выдавать информацию о них. 

Этими сущностями будут:
<ul>
<li>clients — клиенты;</li>
<li>orders — заказы клиентов;</li>
<li>items — товары.</li>
</ul>В REST архитектуре клиенты отправляют на сервер запросы для получения или модификации данных, а сервера отправляют клиентам ответы на их запросы. 
<h2>Запросы</h2>Клиентские запросы практически всегда сделаны по протоколу HTTP. В общем, HTTP запросы состоят из нескольких составляющих: 
<ul>
<li>HTTP метод;</li>
<li>заголовок;</li>
<li>URI;</li>
<li>тело запроса.</li>
</ul>Ниже мы рассмотрим более подробно каждую составляющую часть. 
<h2>URI и Ресурсы</h2>Данные, которые получают или изменяют клиенты посредством запросов, называют ресурсами. Основа клиент-серверного взаимодействия — манипуляция над ресурсами. 

<span class="text-bold">Ресурсы</span> в REST — это все, чему можно дать имя. Это в каком то смысле как классы в Java. В Java мы можем создать класс для чего угодно. Так и в REST — ресурсом может быть что угодно: пользователь, документ, отчет, заказ. Все это может быть как абстракцией некоторой сущности, так и чем-то конкретным, например, файлом — картинкой, видео, анимацией, PDF файлом. 

В рамках нашего примера у нас есть 3 ресурса: 
<ul>
<li>clients — клиенты;</li>
<li>orders — заказы клиентов;</li>
<li>items — товары.</li>
</ul>Клиенты отправляют запросы на так называемые эндпоинты, или же конечные точки (end point). 

Если говорить очень просто, <span class="text-bold">эндпоинт</span> — это что-то вроде адреса в сети. Если углубляться в суть, можно сказать, что эндпоинт — это <span class="text-bold">URI</span>: последовательность символов, идентифицирующая абстрактный или физический ресурс. Uniform Resource Identifier — унифицированный идентификатор ресурса. 

Иногда конечную точку, или URI называют путем (path) — путем до ресурса. В рамках этой статьи мы будем использовать термин URI. 

У каждого конкретного ресурса должен быть уникальный URI. Ответственность за то, чтобы у каждого ресурса всегда был свой URI лежит на плечах разработчика сервера. В нашем примере разработчики это мы, поэтому будем делать это так, как умеем. 

Подобно тому, как в реляционной базе данных часто принято первичным ключом задавать некоторый числовой ID, в REST у каждого ресурса есть свой ID. Часто бывает так, что ID ресурса в REST совпадает с ID записи в базе данных, в которой хранится информация о данном ресурсе.

URI в REST принято начинать с множественной формы существительного, описывающего некоторый ресурс. Например, со слова clients. Далее через слэш указывают ID — идентификатор некоторого конкретного клиента. Примеры: 
<ul>
<li>/clients — URI всех имеющихся клиентов;</li>
<li>/clients/23 — URI конкретного клиента, а именно клиента с ID=23;</li>
<li>/clients/4 — URI конкретного клиента, а именно клиента с ID=4.</li>
</ul>Но и это еще не все. Мы можем продолжить URI, добавив к нему заказы: 
<ul>
<li>/clients/4/orders — URI всех заказов клиента №4;</li>
<li>/clients/1/orders/12 — URI заказа №12 клиента №1.</li>
</ul>Если мы продолжим эту цепочку и добавим еще и товары, получим: 
<ul>
<li>/clients/1/orders/12/items — URI списка всех товаров в заказе №12 сделанного клиентом №1.</li>
</ul>С уровнями вложенности главное — делать URI интуитивно понятными.
<h2>HTTP метод</h2>Метод HTTP (англ. HTTP Method) — последовательность из любых символов, кроме управляющих и разделителей, которая указывает на основную операцию над ресурсом. Существует несколько общепринятых методов HTTP. Перечислим те из них, которые наиболее часто используются в RESTful сервисах: 
<ul>
<li>GET — служит для получения информации о конкретном ресурсе (через ID) либо о коллекции ресурсов;</li>
<li>POST — служит для создания нового ресурса;</li>
<li>PUT — служит для изменения ресурса (через ID);</li>
<li>DELETE — служит для удаления ресурса (через ID).</li>
</ul><h2>Заголовки</h2>В запросах, как собственно и в ответах, присутствуют HTTP заголовки. В них отправляется дополнительная информация о запросе (либо ответе). Заголовки представляют собой пары ключ-значение. Список наиболее распространенных заголовков можешь почитать на странице в <a href="https://ru.wikipedia.org/wiki/%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA_%D0%B7%D0%B0%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D0%BA%D0%BE%D0%B2_HTTP" rel="nofollow" target="_blank">Википедии</a>. 

Применительно к REST клиенты часто могут слать в запросе к серверу заголовок Accept. Он нужен, чтобы дать серверу понять, в каком формате клиент ожидает получить от него ответ. Различные варианты форматов представлены в так называемом списке MIME-типов.

<span class="text-bold">MIME</span> (англ. Multipurpose Internet Mail Extensions — многоцелевые расширения интернет-почты) — спецификация для кодирования информации и форматирования сообщений таким образом, чтобы их можно было пересылать по интернету. 

Каждый MIME тип состоит из двух частей, разделяемых слэшем — из типа и подтипа. Примеры MIME-типов для разных видов файлов: 
<ul>
<li>text  — text/plain, text/css, text/html;</li>
<li>image — image/png, image/jpeg, image/gif;</li>
<li>audio — audio/wav, audio/mpeg;</li>
<li>video — video/mp4, video/ogg;</li>
<li>application — application/json, application/pdf, application/xml, application/octet-stream.</li>
</ul>Итого, у запроса может присутствовать заголовок: 

<pre class="inline-block language-java"><code>
<span class="text-bold">Accept:application/json</span>
</code></pre>

Данный заголовок говорит серверу, что клиент ожидает получить ответ в JSON формате.
<h2>Тело запроса</h2>Пересылаемое клиентом сообщение на сервер. Есть у запроса тело или нет, зависит от типа HTTP запроса. 

Например, запросы GET и DELETE как правило не содержат никакого тела запроса. 

А вот PUT и POST могут содержать: тут все дело в функциональном назначении типа запроса. Ведь для получения данных и удаления по id (который передается в URL) не нужно слать на сервер дополнительные данные. 

А вот для создания нового ресурса (запрос POST) нужно этот ресурс передать. Также как и для модификации существующего ресурса. 

В REST для передачи тела запроса чаще всего используют форматы XML или JSON. Наиболее часто встречается JSON формат. 

Предположим, мы хотим отправить на сервер запрос, а в нем — создать новый ресурс. Если ты не забыл, в качестве примера мы рассматривали приложение, которое управляет заказами клиентов. Допустим, мы хотим создать нового клиента. 

В нашем случае мы храним следующую информацию о клиентах: 

Имя
Email
Номер телефона

Тогда телом такого запроса может быть следующий JSON: 

<pre class="lang-java line-numbers"><code>
{
  "name" : "Amigo",
  "email" : "amigo@jr.com",
  "phone" : "+7 (191) 746-43-23"
}
</code></pre>
<h2>Собираем запросы воедино</h2>Итак, мы рассмотрели с тобой из чего может состоять клиентский запрос. Приведем теперь несколько примеров запросов с описанием
<table>
<tbody><tr>
<th>Запрос</th>
<th>Описание</th>
</tr>
<tr>
<td><pre><code>
GET /clients/23
Accept : application/json, application/xml
</code></pre></td>
<td>Получить информацию о клиенте №23 в формате json или xml</td>
</tr>
<tr>
<td>
<pre><code>
POST /clients
{
  "name" : "Amigo",
  "email" : "amigo@jr.com",
  "phone" : "+7 (191) 746-43-23"
}
</code></pre>
</td>
<td>
Создать нового клиента с полями:<br>
Имя — Amigo<br>
Email — amigo@jr.com<br>
Тел. — +7 (191) 746-43-23<br>
</td>
</tr>
<tr>
<td>
<pre><code>
PUT /clients/1
{
  "name" : "Ben",
  "email" : "bigben@jr.com",
  "phone" : "+380 (190) 346-42-13"
}
</code></pre>
</td>
<td>
Редактировать клиента №1 в следующим образом:<br>
Имя — Ben<br>
Email — bigben@jr.com<br>
Тел. — +380 (190) 346-42-13</td>
</tr>
<tr>
<td><pre><code>
DELETE /clients/12/orders/6
</code></pre></td>
<td>
Удалить из системы заказ №6 у клиента №12</td>
</tr>
</tbody></table><h2>Ответы</h2>Скажем пару слов об ответах сервера. Ответ как правило состоит из следующих частей: 
<ul>
<li>код ответа;</li>
<li>заголовки;</li>
<li>тело ответа.</li>
</ul>В целом заголовки ответов мало чем отличаются от заголовков запросов. К тому же, некоторые заголовки используются и в ответах, и в запросах. 

С телом ответа тоже, думаю, все понятно. В теле часто возвращается информация которую запросил клиент. Может возвращаться в том же формате JSON информация на GET запросы. 

А вот последняя часть, немного более интересна. 
<h2>Коды HTTP ответов</h2>Рассмотрим подробнее коды HTTP ответов.

Приведем цитату из Википедии: 

<span class="text-bold">Код состояния HTTP</span> (англ. HTTP status code) — часть первой строки ответа сервера при запросах по протоколу HTTP. Он представляет собой целое число из трёх десятичных цифр. Первая цифра указывает на класс состояния. За кодом ответа обычно следует отделенная пробелом поясняющая фраза на английском языке, которая разъясняет человеку причину именно такого ответа. Примеры:
<ul>
<li>201 Created;</li>
<li>401 Unauthorized;</li>
<li>507 Insufficient Storage.</li>
</ul>Клиент узнаёт по коду ответа о результатах его запроса и определяет, какие действия ему предпринимать дальше.

Коды ответов подразделяются на несколько групп:
<ul>
<li><span class="text-bold">1ХХ</span> — информационные;</li>
<li><span class="text-bold">2ХХ</span> — информируют о случаях успешного принятия и обработки запроса клиента;</li>
<li><span class="text-bold">3ХХ</span> — сообщают клиенту, что для успешного выполнения операции необходимо сделать другой запрос, как правило по другому URI;</li>
<li><span class="text-bold">4ХХ</span> — ошибка клиента. Например, неправильно составленный запрос или же широко известный код 404 Not Found, которая может возникнуть, когда клиент запрашивает несуществующий ресурс;</li>
<li><span class="text-bold">5ХХ</span> — ошибка сервера. Возвращается клиенту в случае неудачного выполнения операции по вине сервера.</li>
</ul>Более подробно обо всех кодах можно почитать <a href="https://ru.wikipedia.org/wiki/%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA_%D0%BA%D0%BE%D0%B4%D0%BE%D0%B2_%D1%81%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D1%8F_HTTP#%D0%9E%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BA%D0%BE%D0%B4%D0%BE%D0%B2" rel="nofollow" target="_blank">тут</a>.

<a href="https://javarush.com/groups/posts/2486-obzor-rest-chastjh-1-chto-takoe-rest" target="_blank">Часть 1: что такое REST</a>
<a href="https://javarush.com/groups/posts/2488-obzor-rest-chastjh-3-sozdanie-restful-servisa-na-spring-boot" target="_blank">Часть 3: создание RESTful сервиса на Spring Boot</a>