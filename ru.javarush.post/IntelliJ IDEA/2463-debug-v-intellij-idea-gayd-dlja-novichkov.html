Debug в Intellij IDEA: гайд для новичков
<p>----------------------------------------</p>
Всем привет, JavaRush сообщество. Сегодня поговорим о дебаге: что это такое и как дебажить в Intellij IDEA. Статья рассчитана на людей, у которых есть уже минимальные знания Java Core. Здесь не будет ни фреймворков, ни сложных процессов публикации библиотек. Легкая прогулка...
<p>----------------------------------------</p>
Всем привет, JavaRush сообщество. 
Сегодня поговорим о дебаге: что это такое и как дебажить в Intellij IDEA.

<img data-max-width="850" alt="Debug в Intellij IDEA: гайд для новичков - 1" src="https://cdn.javarush.com/images/article/396ae080-5e3d-4a58-abae-ff4dfae92f62/original.jpeg">Статья рассчитана на людей, у которых есть уже минимальные знания Java Core. Здесь не будет ни фреймворков, ни сложных процессов публикации библиотек. Легкая прогулка. Так что располагайтесь поудобнее — начнем! 
<h2>Почему Debug тебе необходим</h2>Давайте сразу проясним для себя: кода без багов не бывает… Так устроена жизнь. Поэтому не стоит сразу раскисать и бросать все, если код работает не так, как мы ожидали.
<img data-max-width="650" alt="Debug в Intellij IDEA: гайд для новичков - 2" src="https://cdn.javarush.com/images/article/92f58d13-65ef-4347-842a-49362d6dbd73/original.jpeg">Но что же делать? Конечно, можно наставить <code>System.out.println</code> везде, где только можно и потом разгребать вывод в терминале в надежде на то, что получится найти ошибку.

Все-таки можно… и это делают, и делают аккуратно при помощи логирования (можно почитать об этом <a href="https://javarush.com/groups/posts/2388-logirovanie-chto-kak-gde-i-chem" target="_blank">здесь</a>).

Но если есть возможность запустить на локальной машине код, лучше использовать <span class="text-bold">Debug</span>. Сразу хочу заметить, что в этой статье мы будем рассматривать дебаг проекта внутри Intellij IDEA. Если интересно почитать об удаленном дебаге — вот, пожалуйста, <a href="https://javarush.com/groups/posts/621-intellij-idea-i-debug--ne-dayving-no-snorkling" target="_blank">статья из нашего ресурса</a>.
<h2 id="topic2">Что такое Debug</h2><img data-max-width="650" alt="Debug в Intellij IDEA: гайд для новичков - 3" src="https://cdn.javarush.com/images/article/40b18e00-bf88-45ec-aaec-c470999fd538/original.jpeg">Debug — это процесс отладки (проверки) кода, когда в процессе его выполнения можно остановиться в обозначенном месте и посмотреть за ходом выполнения. Понять, в каком состоянии находится программа в определенном месте. 

Это точно так же, как если бы можно было остановить жизнь и посмотреть на всё со стороны. Круто, правда?

Наша задача состоит в том, чтобы быстро и просто научиться проводить отладку приложений при помощи всеми нами любимой среды разработки  Intellij IDEA.
<h2 id="topic3">Что нужно для начала отладки</h2>Даю бесплатный совет: пока читаете статью, проделывайте все то, что здесь будет описано, благо есть все для этого.

Что нужно:
<ol>
<li>Среда разработки Intellij IDEA версии 2019.3.1 и выше. На случай, если у кого-то её нет, вот <a href="https://www.jetbrains.com/idea/download" rel="nofollow" target="_blank">ссылка</a>, где можно скачать. Скачивайте Community Edition, так как я буду использовать именно ее.</li>
<li>Клонировать <a href="https://github.com/romankh3/debug-presentation" rel="nofollow" target="_blank">проект из GitHub</a> и импортировать его через IDEA.</li></ol>Открываем IDEA:
<img data-max-width="850" alt="Debug в Intellij IDEA: гайд для новичков - 4" src="https://cdn.javarush.com/images/article/aedc31d6-2aa7-4915-b8fb-d28840eb98e9/original.jpeg">Выбираем проект <span class="text-bold">debug-presentation</span>, нажимаем <span class="text-bold">OK</span> и получаем:
<img data-max-width="850" alt="Debug в Intellij IDEA: гайд для новичков - 5" src="https://cdn.javarush.com/images/article/f596dcae-6c5a-47a9-af41-971fc9468078/original.jpeg">Оставляем <span class="text-bold">import project from external sources, Maven</span> и нажимаем <span class="text-bold">Finish</span>.

Импортировав проект, можем описать процесс на живом примере.
<h2 id="topic4">Немного теории… обещаю :D</h2>Чтобы начать мало-мальски дебажить, нужно понять, что такое <span class="text-bold">breakPoint</span> и разобраться в нескольких горячих клавишах, которые нужны для начала.

<span class="text-bold">BreakPoint</span> — это специальный маркер, который отображает место или 
состояние, на котором нужно остановить приложение. 

Поставить breakpoint можно либо нажав левой кнопкой мыши на левую боковую панель, либо кликнув курсором по месту кода и нажав <span class="text-bold">Ctrl + F8</span>.

Breakpoint’ы бывают трех видов: метка на строку, метка на переменную и метка на метод. 

Выглядит это так:
<ul>
<li><p>На строку:</p>
<img data-max-width="650" alt="Debug в Intellij IDEA: гайд для новичков - 6" src="https://cdn.javarush.com/images/article/df3c6639-7d56-4214-83b6-aff62209035a/original.jpeg">
<p>если в выражении есть лямбда, то IDEA предлагает вам выбор — поставить на всю линию или конкретно в лямбда выражение:</p>
<img data-max-width="650" alt="Debug в Intellij IDEA: гайд для новичков - 7" src="https://cdn.javarush.com/images/article/f72bdda2-23bc-4d53-ad88-f6fca669d3b9/original.jpeg"></li>
<li><p>На метод:</p>
<img data-max-width="650" alt="Debug в Intellij IDEA: гайд для новичков - 8" src="https://cdn.javarush.com/images/article/9a1c4dbc-e76b-41e9-abe1-0d75a93cb32b/original.jpeg"></li>
<li><p>На класс</p>
<img data-max-width="650" alt="Debug в Intellij IDEA: гайд для новичков - 9" src="https://cdn.javarush.com/images/article/36c01cf3-5fe3-45ba-93ef-69e771280ac6/original.jpeg"></li>
</ul>Breakpoint’ы можно удалить, выполнив те же действия, что и при их добавлении.

Бывают ситуации, когда нужно сделать их неактивными (замьютить). Для этого в Debug секции, можно найти значок 
<img data-max-width="30" src="/images/article/87e391e3-d739-45ba-92c7-5f81d14de5eb/original.jpeg" class="img-fluid" alt="Debug в Intellij IDEA: гайд для новичков - 10" border="0">, который сделает все breakpoint’ы неактивными.

Чтобы посмотреть, какие уже выставленные breakpoint’ы, можно или зайти в Debug в левом нижнем углу и найти иконку 
<img data-max-width="30" src="/images/article/acd2d26b-5913-4c0b-8d48-f87cea63135d/original.jpeg" class="img-fluid" alt="Debug в Intellij IDEA: гайд для новичков - 11">, или нажать <span class="text-bold">Ctrl+Shift+F8</span>:
<img data-max-width="850" alt="Debug в Intellij IDEA: гайд для новичков - 12" src="https://cdn.javarush.com/images/article/76f7dbff-d5ec-4602-a29b-17a60cac514f/original.jpeg">Когда зайдем в список breakpoint’ов, увидим:
<img data-max-width="850" alt="Debug в Intellij IDEA: гайд для новичков - 13" src="https://cdn.javarush.com/images/article/7da6ff9e-eaf3-4cf2-820f-b9d5e2c36f55/original.jpeg">Здесь есть два preakpoint’a:
<ul>
<li>Bee.java:24 — в классе Bee на 24-й строке</li>
<li>Main.java:14 — в классе Main на 14-й строке</li>
</ul>Хочу заметить, что при клонировании проекта к себе не будет этих BreakPoint’ов: их нужно выставить самостоятельно!

Также есть секция <span class="text-bold">Java Exception Breakpoints</span>. Очень полезная вещь. При помощи ее можно добавить неявный breakpoint, чтобы программа останавливалась перед выбрасыванием любого исключения или какого-то конкретного. 

Добавим для RuntimeException неявный breakpoint. Делается это легко: в верхнем левом углу есть плюсик “+”. Нажимаем на него и выбираем <span class="text-bold">Java Exceptions Breakpoints</span>:
<img data-max-width="850" alt="Debug в Intellij IDEA: гайд для новичков - 14" src="https://cdn.javarush.com/images/article/e81fc96c-4964-4a40-be23-81d3c86f63b7/original.jpeg">В появившемся окне пишем имя исключения, которое нужно добавить, выбираем из предложенного списка и нажимаем <span class="text-bold">OK</span>:
<img data-max-width="850" alt="Debug в Intellij IDEA: гайд для новичков - 15" src="https://cdn.javarush.com/images/article/0f16887a-08dd-44a4-a3d8-e1ee2b709c5d/original.jpeg">На этом ликбез заканчиваем и переходим к практике.
<h2 id="topic4">Поехали, будем врываться в дебри дебага</h2><img data-max-width="850" alt="Debug в Intellij IDEA: гайд для новичков - 16" src="https://cdn.javarush.com/images/article/6fd20645-bd78-4919-acb8-54d8d41898fb/original.jpeg">Так как я потомственный пчеловод, для презентации отладки создал проект, который описывает процесс сбора нектара пчелами, переработки нектара в мед и получение меда из улья.

На основе <s>документации</s> README файла, который лежит в корне проекта, читаем: <span class="text-bold">ожидаемое поведение</span> — со всех цветков, с которых собирают нектар (как <span class="text-bold">double</span> значение), будет собрано количество меда, равное половине собранного нектара.

В проекте есть такие классы:
<ul>
<li>Bee — обычная рабочая пчела;</li>
<li>BeeQueen — пчелиная матка;</li>
<li>BeeHive — улей;</li>
<li>HoneyPlant — медонос, с которого собирают мед;</li>
<li>Main — где находится <code>public static void main()</code> метод в котором стартует проект.</li>
</ul>Если запустить метод <code>main()</code>, то окажется, что мало того, что не считается количество меда, так еще и выпадает ошибка…
<img data-max-width="850" alt="Debug в Intellij IDEA: гайд для новичков - 17" src="https://cdn.javarush.com/images/article/449d37fa-0b7c-4613-b8fe-4980fe5a6fa6/original.jpeg">Нужно посмотреть, что же там не так.
 
Из стек трейса в нижнем правом углу, можем увидеть, что в <code>HoneyPlant.java:20</code>, выбрасывается исключение RuntimeException:
<img data-max-width="850" alt="Debug в Intellij IDEA: гайд для новичков - 18" src="https://cdn.javarush.com/images/article/a8331941-e503-4112-893e-1857b03e5a61/original.jpeg">Как раз наш случай: есть RuntimeException, добавим поиск такого исключения, как было описано выше, и запустим <code>main()</code> метод в дебаг режиме. 

Для этого нажмем на зеленую стрелку-треугольник в Intellij IDEA перед методом <code>main()</code>:
<img data-max-width="850" alt="Debug в Intellij IDEA: гайд для новичков - 19" src="https://cdn.javarush.com/images/article/f91b5167-57c4-4a12-9460-008c048adf83/original.jpeg">и получим остановленную программу в момент перед тем, как сработает исключение с таким значком
<img data-max-width="30" src="/images/article/4c9e2958-0429-486c-80fb-f3da5a1b94e5/original.jpeg" class="img-fluid" alt="Debug в Intellij IDEA: гайд для новичков - 20"><img data-max-width="850" alt="Debug в Intellij IDEA: гайд для новичков - 21" src="https://cdn.javarush.com/images/article/30cf4eba-c2ea-40dd-bbaf-5991f449cc76/original.jpeg">Чтоб получить полную информацию, нужно посмотреть в секцию Debug. В ней есть <span class="text-bold">Variables</span>, где показаны все переменные, доступные в этой части приложения:
<ul>
<li>nectar = 1.0;</li>
<li>nectarCapacity = -1.0.</li>
</ul>Исключение выбрасывается справедливо, так как значение количества нектара, которое есть в медоносе, не может быть отрицательным. Но почему же так происходит? Ведь есть же проверка, что если нектар закончился, то возвращается нулевое значение в строках 15-17:

<pre class="lang-java line-numbers"><code>
    if ( nectar == 0 ) {
         return 0;
}
</code></pre>
Но загвоздка в том, что проверяет он не ту переменную… и это ошибка в коде. Вместо того, чтобы проверять значение нектара в цветке, который лежит в переменной <span class="text-bold">nectarCapacity</span>, программа проверяет значение <span class="text-bold">nectar</span>, которое приходит в метод и является тем количеством, которое хотят взять у нектара.

Вот же он, первый баг!

Поэтому ставим правильно и получаем выражение:

<pre class="lang-java line-numbers"><code>
    if ( nectarCapacity == 0) {
         return 0;
}
</code></pre>
Далее, запускаем <code>main()</code> метод в обычном режиме <code>(Run `Main.main()`)</code> и ошибки больше нет, программа отработала:
<img data-max-width="850" alt="Debug в Intellij IDEA: гайд для новичков - 22" src="https://cdn.javarush.com/images/article/76c7d9e8-0432-48b0-87a8-e0523c819c5d/original.jpeg">Приложение отработало и выдало ответ:

<span class="text-bold">“33.0 honey was produced by 7 bees from 2 honey plants”</span>

Все бы хорошо, но ответ неправильный… Все потому, что в <s>документации</s> README файле написано, что нектар переходит в мед с пропорцией  2 к 1:

<pre class="lang-java line-numbers"><code>
## Documentation
Presentation based on honey getting process.

**Note**: 1 honey point = 2 nectar points
</code></pre>
Из главного метода видно, что есть два медоноса, по 30 и 40 единиц нектара соответственно, поэтому в итоге должно получиться 35 единиц мёда. А пишет, что 33. Куда же делись еще две единицы?... Сейчас узнаем!

Для этого нужно поставим breakpoint в методе <code>Main.main()</code> на строке №28, где выполняется <code>beeHive.populateHoney()</code> и запускаем <code>main</code> метод в режиме Debug:
<img data-max-width="850" alt="Debug в Intellij IDEA: гайд для новичков - 23" src="https://cdn.javarush.com/images/article/f83da710-6b0b-4549-b159-d3dff49ccd8d/original.jpeg">Вот этот момент рассмотрим подробнее. Программа остановилась перед выполнением 28-й строки.

В нижней части видим Debug секцию, в которой описана вся информация по запущенному приложению. 

В части Variables, как уже было сказано, есть все переменные и объекты, которые доступны из этой части приложения.

В части Frames показаны шаги, которые проходит приложение, можно посмотреть на предыдущий шаг и получить все локальные данные.

Чтобы программа продолжила работу, можно нажать <span class="text-bold">F9</span> или зеленую иконку, как показано ниже: 
<img data-max-width="850" alt="Debug в Intellij IDEA: гайд для новичков - 24" src="https://cdn.javarush.com/images/article/c42076d8-4775-40de-854e-ba8fa48d76f0/original.jpeg">Чтобы остановить программу, нужно нажать на красный квадрат:
<img data-max-width="850" alt="Debug в Intellij IDEA: гайд для новичков - 25" src="https://cdn.javarush.com/images/article/39df8a60-d773-49ca-97bd-11db04a8f5b2/original.jpeg">Чтобы перезапустить приложение в режиме дебага, нужно нажать на стрелку:
<img data-max-width="850" alt="Debug в Intellij IDEA: гайд для новичков - 26" src="https://cdn.javarush.com/images/article/1d0541ac-92b1-415d-9c51-168ac2652192/original.jpeg">Далее, чтобы проходить пошагово по работе приложения, можно использовать две клавиши:
<ul>
<li>F8 — идти по участку кода и не заходить во внутренние методы;</li>
<li>F7 — идти по участку кода и заходить во внутренние методы.</li>
</ul>Поэтому нам, чтобы зайти в работу метода <code>beeHive.populateHoney()</code>, нужно нажать F7, и мы перейдем далее:
<img data-max-width="850" alt="Debug в Intellij IDEA: гайд для новичков - 27" src="https://cdn.javarush.com/images/article/78e3f83a-2c4f-4648-9382-95575fa835b3/original.jpeg">Далее, проходим в режиме дебага используя <span class="text-bold">F8</span> по этому методу до конца и опишем, что происходит в этом методе:
<ul>
<li>25-я строка — используется Stream API, чтобы собрать мед со всех пчел;</li>
<li>26-я строка — мед суммируется уже с существующим;</li>
<li>27-я строка — выделяется 2 единицы меда для матки;</li>
<li>28-я строка — эти две единицы удаляются из общего количества меда;</li>
<li>29-я строка — матка съедает этот мед.</li>
</ul>Вот куда делись эти две единицы, ура! После общения с бизнес-аналитиком приходим к выводу, что <s>документация</s> README файл содержит ошибку, и его нужно будет обновить.

Обновим README файл:

<pre class="lang-java line-numbers"><code>
## Documentation
Presentation based on honey getting process.

**Note**:
*  1 honey point = 2 nectar points
*  2 honey point queen bee eats every time when beehive populates the honey.
</code></pre>
И все:, все найденные баги починены, можем спокойно продолжать с умным видом пить кофе и читать статейки на <s>хабре</s> JavaRush :)
<h2 id="topic5">Подведем итог</h2>За эту статью мы разобрались, что:
<ul>
<li>работы без ошибок не бывает и дебаг — это отличный способ их решить;</li>
<li>что такое breakpoint и какой он бывает;</li>
<li>как настроить exception breakpoint;</li>
<li>как проводить навигацию в режиме дебага.</li>
</ul><h2 id="topic6">Статья для почитать</h2><ul>
<li><a href="https://github.com/romankh3/debug-presentation" rel="nofollow" target="_blank">Проект, что используется в статье</a></li>
<li><a href="https://javarush.com/groups/posts/621-intellij-idea-i-debug--ne-dayving-no-snorkling" target="_blank">IntelliJ IDEA и Debug: не дайвинг, но снорклинг</a></li>
<li><a href="https://habr.com/ru/post/339356/" rel="nofollow" target="_blank">Горькая правда о программировании...</a></li>
<li><a href="https://www.jetbrains.com/help/idea/debugging-code.html" rel="nofollow" target="_blank">Официальная документация</a></li>
<li><a href="https://www.jetbrains.com/help/idea/using-breakpoints.html#breakpoint-icons" rel="nofollow" target="_blank">Типы breakpoint'ов. Официальна документация</a></li>
</ul><span class="text-bold">Смотрите также мои другие статьи:</span><ul>
<li><a href="https://javarush.com/groups/posts/2367-kak-ja-napisal-open-source-biblioteku-kotoruju-ispoljhzujut-v-realjhnihkh-proektakh" target="_blank">Как тестовое задание на собеседование превратилось в open-source библиотеку</a></li>
<li><a href="https://javarush.com/groups/posts/2400-sozdanie-sistemih-monitoringa-cen-na-aviabiletih-poshagovoe-rukovodstvo" target="_blank">Создание системы мониторинга цен на авиабилеты: пошаговое руководство [Часть 1]</a></li>
<li><a href="https://javarush.com/groups/posts/2430-gayd-po-sozdaniju-klienta-dlja-skyscanner-api-i-ego-publikacii-v-jcenver-i-maven-central" target="_blank">Гайд по созданию клиента для Skyscanner API и его публикации в jCenter и Maven Central [Часть 1]</a></li>
<li><a href="https://javarush.com/groups/posts/2388-logirovanie-chto-kak-gde-i-chem" target="_blank">Логирование: что, как, где и чем?</a></li>
</ul>