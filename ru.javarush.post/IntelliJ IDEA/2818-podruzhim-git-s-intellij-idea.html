Подружим Git с Intellij IDEA
<p>----------------------------------------</p>
Сегодня поговорим о логическом продолжении моей статьи про Гит. Также я советую прочесть материал о стратегиях ветвления, который я опубликовал ранее. В статье про Гит я описал, как работать с ним в командной строке, а сегодня покажу, как сделать все это в Intellij IDEA...
<p>----------------------------------------</p>
По сложившейся традиции, приветствую вас, будущие Senior Software Engineers.

<img data-max-width="800" data-id="79ad25a0-a9cd-44c6-b9a1-46fac8b77c8e" src="/images/article/79ad25a0-a9cd-44c6-b9a1-46fac8b77c8e/800.jpeg" alt="Подружим Git с Intellij IDEA - 1">Сегодня поговорим о логическом продолжении моей статьи про <a href="https://javarush.com/groups/posts/2683-nachalo-rabotih-s-git-podrobnihy-gayd-dlja-novichkov" target="_blank">Гит</a>. Также я советую прочесть материал о <a href="https://javarush.com/groups/posts/2693-komandnaja-rabota-bez-putanicih-razbiraem-strategii-vetvlenija-v-gite" target="_blank">стратегиях ветвления</a>, который я опубликовал ранее. 

В статье про Гит я описал, как работать с ним в командной строке, а сегодня покажу, как сделать все это в Intellij IDEA. 

В начале своего пути как разработчика я пользовался именно командной строкой и думал, что мне незачем использовать UI для этого дела. Ведь все понятно и так… Но это было ровно до того момента, пока я не начал использовать Гит в Intellij IDEA…

Хочу сказать сразу, что я буду описывать личный опыт работы. Есть несколько вариантов решения одних и тех же задач через Intellij IDEA, и если вы знаете, как сделать лучше то, что я опишу в статье — пишите в комментарии, обсудим.
<h2>Необходимые вводные:</h2><ol>
<li>Прочесть, повторить и понять <a href="https://javarush.com/groups/posts/2683-nachalo-rabotih-s-git-podrobnihy-gayd-dlja-novichkov" target="_blank">статью про гит</a>. Это поможет быть уверенным, что все уже настроено и готово к работе</li>
<li>Установить Intellij IDEA.</li>
<li>Выделить часик личного времени для полного усвоения.</li>
</ol>Для работы возьмем <a href="https://github.com/romankh3/git-demo" rel="nofollow" target="_blank">демо-проект</a>, который я использовал для статьи про гит.

<mark>UPDATE: </mark>на момент публикации уже будет доступен новый UI гитхаба, и некоторые иконки будут не там, где показано это в статье. Вы не пугайтесь: просто нужно будет либо не переходить на новый UI, либо поискать их.
<h2>Клонируем проект локально</h2>Здесь есть два варианта.
<ol>
<li>Если есть уже гитхаб аккаунт и хочется что-то потом запушить, лучше сделать форк проекта к себе и клонировать свою копию. Как сделать форк — я описывал в этой статье в главе <a href="https://javarush.com/groups/posts/2693-komandnaja-rabota-bez-putanicih-razbiraem-strategii-vetvlenija-v-gite" target="_blank">пример the forking workflow</a>.</li>
<li>Клонировать с моего репозитория и проделать все локально без возможности все это дело запушить на сервер. Ведь это же будет мой репозиторий))</li></ol>Чтобы клонировать проект с гитхаба, нужно скопировать ссылку на проект и передать ее в IntelliJ IDEA:
<ol>
<li><p>Копируем адрес проекта:</p>
<img data-max-width="1024" data-id="5515705b-3d6c-43ae-8160-00b9f9b8f26b" src="/images/article/5515705b-3d6c-43ae-8160-00b9f9b8f26b/1024.jpeg" alt="Подружим Git с Intellij IDEA - 2"></li>
<li><p>Открываем Intellij IDEA и выбираем Get from Version Control:</p>
<img data-max-width="800" data-id="6fb3851d-134c-491d-a5bd-78717760a8d9" src="/images/article/6fb3851d-134c-491d-a5bd-78717760a8d9/800.jpeg" alt="Подружим Git с Intellij IDEA - 3"></li>
<li><p>Копируем вставляем адрес на проект:</p>
<img data-max-width="800" data-id="463efaf8-0e14-4947-83cd-2465f3f3ddd0" src="/images/article/463efaf8-0e14-4947-83cd-2465f3f3ddd0/800.jpeg" alt="Подружим Git с Intellij IDEA - 4"></li>
<li><p>Вам предложат создать Intellij IDEA проект. Принимаем предложение:</p>
<img data-max-width="800" data-id="4a748b9c-54ab-47f5-b8eb-f24240093676" src="/images/article/4a748b9c-54ab-47f5-b8eb-f24240093676/800.jpeg" alt="Подружим Git с Intellij IDEA - 5"></li>
<li><p>Так как нет системы сборки, и это не входит в задачу статьи, выбираем <strong>Create project from existing sources</strong>:</p>
<img data-max-width="800" data-id="028c031b-6e91-44ea-bfce-4c1c77ba1865" src="/images/article/028c031b-6e91-44ea-bfce-4c1c77ba1865/800.jpeg" alt="Подружим Git с Intellij IDEA - 6"></li>
<li><p>Далее будет такая картина маслом:
<img data-max-width="1024" data-id="abfdadea-7ce2-40e8-9e56-ac3510ff49ae" src="/images/article/abfdadea-7ce2-40e8-9e56-ac3510ff49ae/1024.jpeg" alt="Подружим Git с Intellij IDEA - 7">С клонированием разобрались, теперь-то можно и оглянуться по сторонам.</p></li></ol><h2>Первый взгляд на Intellij IDEA как на гит UI</h2>Присмотритесь еще раз внимательно на клонированный проект: уже там можно получить много информации о системе контроля версий.

Первое — это <strong>Version Control</strong> панель в нижнем левом углу. В ней можно найти все локальные изменения и получить список коммитов (аналог git log). 

Перейдем в лекцию <strong>Log</strong>. Присутствует некая визуальная составляющая, которая помогает понять, как именно шел процесс разработки. Например, видно, что создавалась новая ветка с коммитом <strong>added header to txt</strong>, который после влился в мастер-ветку. Если нажать на коммит, в правом углу можно увидеть всю информацию о коммите: всех изменениях и его метаданных.
<img data-max-width="1024" data-id="0d12b07c-1fa0-4ef7-b837-29ee73a7dd46" src="/images/article/0d12b07c-1fa0-4ef7-b837-29ee73a7dd46/1024.jpeg" alt="Подружим Git с Intellij IDEA - 8">Более того, можно посмотреть, какие были сделаны изменения. Тем более что там же был разрезолвлен конфликт. Это IDEA тоже отлично показывает. 

Если нажать два раза на файл, который был изменен за этот коммит, увидим, как резолвили кофликт:
<img data-max-width="1024" data-id="b55f959b-47fb-40f5-b514-ddae78005840" src="/images/article/b55f959b-47fb-40f5-b514-ddae78005840/1024.jpeg" alt="Подружим Git с Intellij IDEA - 9">Заметно, что справа и слева были два варианта одного файла, который нужно было смержить в один. А посредине — результат, который в итоге получился. 

Когда в проекте множество веток, коммитов и пользователей, которые работают в проекте, необходимо поискать отдельно по ветке (branch), пользователю (user) и дате (date):
<img data-max-width="1024" data-id="de1d4f2d-6985-4519-b997-a9177064196b" src="/images/article/de1d4f2d-6985-4519-b997-a9177064196b/1024.jpeg" alt="Подружим Git с Intellij IDEA - 10">И последнее, что я хочу объяснить перед началом работы — это то, как же понять, в какой ветке мы находимся. 

Даю минуту на поиск… нашли? 

Сдаетесь? :D 

В правом нижнем углу есть кнопка <strong>Git: master</strong>, где после Git: показано, на какой ветке находится сейчас проект. Если нажать на кнопку, можно проделать множество полезных вещей: перейти на другую ветку, создать новую, переименовать существующую, и так далее.
<img data-max-width="1024" data-id="4ac0be8c-362a-4181-90dd-940bc52c919e" src="/images/article/4ac0be8c-362a-4181-90dd-940bc52c919e/1024.jpeg" alt="Подружим Git с Intellij IDEA - 11"><h2>Работа с репозиторием</h2><h3>Полезные горячие клавиши</h3>Чтобы дальше работать, нужно запомнить несколько очень полезных горячих клавиш:
<ol start="0">
<li><strong>ctrl + t</strong> — получить последние изменения с удаленного репозитория (git pull).</li>
<li><strong>ctrl + k</strong> — сделать коммит/посмотреть все изменения, которые есть на данный момент. Сюда входят и untracked, и modified файлы (смотри мою статью про гит, там это описано) (git commit).</li>
<li><strong>ctrl + shift + k</strong> — это команда для создания пуша изменений на удаленный репозиторий. Все коммиты, которые были созданы локально и еще не находятся на удаленном, будут предложены для пуша (git push).</li>
<li><strong>alt + ctrl + z</strong> — откатить в конкретном файле изменения до состояния последнего созданного коммита в локальном репозитории. Если в левом верхнем углу выделить весь проект, то можно будет откатить изменения всех файлов.</li>
</ol><img data-max-width="512" data-id="d773592d-9546-4996-ac8b-dae4f34e4497" src="/images/article/d773592d-9546-4996-ac8b-dae4f34e4497/512.jpeg" alt="Подружим Git с Intellij IDEA - 12"><h2>Что мы хотим?</h2>Нам для работы, нужно освоить базовый сценарий, который используется везде.

Стоит задача реализовать новую функциональность в отдельной ветке и запушить ее на удаленный репозиторий (дальше нужно создать еще пул-реквест на главную ветку, но это выходит за рамки нашей статьи).

Что для этого нужно сделать?
<ol>
<li><p>Получить все изменения на текущий момент в основной ветке (master, например).</p></li>
<li><p>На базе этой основной создать отдельную для своей работы.</p></li>
<li><p>Реализовать новую функциональность.</p></li>
<li><p>Перейти на основную ветку и проверить, не было ли новых изменений за время, пока работали. Если не было, то все хорошо, а если было, то делаем следующее: переходим на работающую ветку и делаем <a href="https://habr.com/ru/post/161009/" rel="nofollow" target="_blank">ребейз</a> изменений из основной ветки в нашу. Если все прошло успешно, то отлично. Но вполне могут быть и конфликты. И их как раз можно будет заранее решить, не тратя время на удаленном репозитории.</p>
<p><em>Казалось бы, зачем это делать? Это правило хорошего тона, которое предотвращает возникновение конфликтов уже после пуша своей ветки на локальный репозиторий (есть, конечно, вероятность,что все равно они будут, но она становится <strong>значительно</strong> меньше).</em></p>
</li><li>Запушить свои изменения на удаленный репозиторий.</li>
</ol>Далее уже зависит от ваших задач и фантазии.
<h3>Получить изменения с удаленного сервера?</h3>Я добавил описание в README новым коммитом и хочу эти изменения получить. Предлагается выбор между мерджем и ребейзом в случае, если были сделаны изменения и в локальном репозитории и на удаленном. Выбираем мерж.

Вводим <strong>ctrl + t</strong>:
<img data-max-width="1024" data-id="15db0ed2-6e5b-4594-8001-1c30bee809f6" src="/images/article/15db0ed2-6e5b-4594-8001-1c30bee809f6/1024.jpeg" alt="Подружим Git с Intellij IDEA - 13">В результате, видно как изменился README, т.е. изменения из удаленного репозитория подтянулись, и в правом нижнем углу можно посмотреть все детали тех изменений, которые пришли с сервера.
<img data-max-width="1024" data-id="26f88ea8-55e2-41c5-a239-090a52aac35d" src="/images/article/26f88ea8-55e2-41c5-a239-090a52aac35d/1024.jpeg" alt="Подружим Git с Intellij IDEA - 14"><h3>Создать новую ветку на основе master</h3>Здесь все просто. 
<ol>
<li><p>Переходим в правый нижний угол и нажимаем на <strong>Git: master</strong>, выбираем <strong>+ New Branch</strong>.</p>
<img data-max-width="512" data-id="7e4e8e2d-1208-490f-a8a8-da9eee926849" src="/images/article/7e4e8e2d-1208-490f-a8a8-da9eee926849/512.jpeg" alt="Подружим Git с Intellij IDEA - 15"></li><p>Оставляем галочку <strong>Checkout branch</strong> и пишем имя новой ветки. Для меня это будет <strong>readme-improver</strong>.</p>
<img data-max-width="512" data-id="14191089-542b-46f2-ad46-36c6746df7c5" src="/images/article/14191089-542b-46f2-ad46-36c6746df7c5/512.jpeg" alt="Подружим Git с Intellij IDEA - 16"><p>После этого <strong>Git: master</strong> сменится на <strong>Git: readme-improver</strong>.</p></ol><h3>Имитируем параллельную работу</h3>Чтобы конфликты появились, их кто-то должен создать :D

Я через браузер отредактирую README новым коммитом и таким образом сымитирую параллельную работу. Мол кто-то во время моей работы сделал изменения в том же файле, что и я, что приведет к конфликту. Я удалю слово “полностью” из 10 строки.
<h3>Реализовать свою функциональность</h3>Задача стоит в том, чтобы поменять README и добавить описание к новой статье, то есть то, что работа в гите идет через Intellij IDEA. Добавляем это:
<img data-max-width="1024" data-id="9b5823ed-2cd2-42d2-a230-1b1029a7cd3e" src="/images/article/9b5823ed-2cd2-42d2-a230-1b1029a7cd3e/1024.jpeg" alt="Подружим Git с Intellij IDEA - 17">Изменения выполнены, теперь можно создать коммит. Нажимаем горячую клавишу <strong>ctrl + k</strong>, получим:
<img data-max-width="800" data-id="998b78eb-a1d9-4c36-8ebb-decc90f62bef" src="/images/article/998b78eb-a1d9-4c36-8ebb-decc90f62bef/800.jpeg" alt="Подружим Git с Intellij IDEA - 18">Прежде чем создать коммит, нужно внимательно посмотреть на то, что предлагается в этом окне. Я специально добавил стрелочек, куда посмотреть. Там много интересных вещей.

В секции <strong>Commit Message</strong> пишем текст коммита, и чтобы он создался, нужно нажать кнопку <strong>Commit</strong>. Я так и не нашел, как бы так сделать это горячей клавишей, так что если кто-то найдет — пишите, я буду очень рад.

Пишем, что README изменился и создаем коммит. В результате в левом нижнем углу всплывает оповещение, в котором будет имя коммита:
<img data-max-width="512" data-id="83caecf9-c4a4-4bf4-a704-a8acf1f6b464" src="/images/article/83caecf9-c4a4-4bf4-a704-a8acf1f6b464/512.jpeg" alt="Подружим Git с Intellij IDEA - 19"><h3>Проверить, не изменилась ли основная ветка</h3>Выполнили задачу, она работает, тесты написали, все хорошо. Но прежде чем пушить на сервер, нужно таки проверить, не было ли изменений в основной ветке за это время. Как это могло произойти? Очень просто: кому-то дали задачу после вас, и этот кто-то сделал ее быстрее вас.

Поэтому переходим на master ветку. Для этого нужно в правом нижнем углу сделать то, что показано ниже на рисунке:
<img data-max-width="512" data-id="13fd322e-a919-45ef-bb58-eb1f361c3b1e" src="/images/article/13fd322e-a919-45ef-bb58-eb1f361c3b1e/512.jpeg" alt="Подружим Git с Intellij IDEA - 20">В master ветке нажимаем <strong>ctrl + t</strong>, чтобы получить ее последние изменения с удаленного сервера. Если посмотреть, какие были изменения, легко можно заметить, что произошло:
<img data-max-width="1024" data-id="67156e54-3f92-4b50-9de1-feb251b9efae" src="/images/article/67156e54-3f92-4b50-9de1-feb251b9efae/1024.jpeg" alt="Подружим Git с Intellij IDEA - 21">Как видим, было удалено слово “полностью”. Быть может, это был кто-то из маркетинга и решил, что так нельзя писать и дал разработчикам задачу обновить это.

Теперь у нас локально последняя версия master ветки. Переходим обратно на <strong>readme-improver</strong>.

Теперь нужно заребейзить изменения из мастер ветки в нашу. Делаем:
<img data-max-width="512" data-id="7973c5dd-5229-4801-abe3-bd3ef68d83a8" src="/images/article/7973c5dd-5229-4801-abe3-bd3ef68d83a8/512.jpeg" alt="Подружим Git с Intellij IDEA - 22">Если вы все правильно выполняли со мной, в результате должен показаться конфликт в README файле:
<img data-max-width="800" data-id="ae09746d-6358-4582-90d0-abef0b293113" src="/images/article/ae09746d-6358-4582-90d0-abef0b293113/800.jpeg" alt="Подружим Git с Intellij IDEA - 23">Здесь также много информации, которую нужно бы понять и впитать. Здесь показан список (в нашем случае из одного элемента) файлов, в которых есть конфликты. Мы можем выбрать три опции:
<ol>
<li>accept yours — принять только изменения из readme-improver.</li>
<li>accept theirs — принять только изменения из master.</li>
<li>merge — самому выбрать, что нужно оставить, а что убрать.</li>
</ol>Непонятно, что там изменилось, и если уж изменения находятся в мастере, значит они нужны там, и просто принять наши изменения нельзя, поэтому выбираем <strong>merge</strong>:
<img data-max-width="1080" data-id="098abe65-1229-42c2-9bde-f5725614ac9a" src="/images/article/098abe65-1229-42c2-9bde-f5725614ac9a/1080.jpeg" alt="Подружим Git с Intellij IDEA - 24">Здесь видно, что есть три части:
<ol>
<li>Это изменения из readme-improver.</li>
<li>Результат. Пока что там так, как было до изменений.</li>
<li>Изменения из master ветки.</li>
</ol>Нам нужно таким образом собрать результат, чтобы он всех удовлетворил. Поэтому изучили, что сделали ДО нас, поняли, что просто убрали слово “полностью”. Ну окей, без проблем. Значит и мы его уберем в результате и добавим наши изменения. Как только поправим результат, можно нажать <strong>Apply</strong>. 

После этого всплывет оповещение, что ребейз прошел успешно:
<img data-max-width="512" data-id="1690e40a-73bc-4e84-9215-fb6f92931d08" src="/images/article/1690e40a-73bc-4e84-9215-fb6f92931d08/512.jpeg" alt="Подружим Git с Intellij IDEA - 25">Вот так мы зарезолвили свой первый конфликт через Intellij IDEA :D
<h3>Запушить изменения на удаленный сервер</h3>Следующий шаг — запушить изменения на удаленный сервер и создавать пул-реквест. Для этого просто нажимаем <strong>ctrl + shift + k</strong>, после чего получим:
<img data-max-width="800" data-id="8368b5c9-342f-4a4a-95a1-fbdbd0b5b3c0" src="/images/article/8368b5c9-342f-4a4a-95a1-fbdbd0b5b3c0/800.jpeg" alt="Подружим Git с Intellij IDEA - 26">Слева будет список коммитов, которые не запушены на удаленный репозиторий, а справа будут все файлы, которые изменены. И все: нажимаем <strong>Push</strong>, и будет вам счастье :)

При успешном пуше будет вот такое уведомление в нижнем правом углу:
<img data-max-width="512" data-id="b7df13fa-99fb-476a-bfa3-6404bb21e58d" src="/images/article/b7df13fa-99fb-476a-bfa3-6404bb21e58d/512.jpeg" alt="Подружим Git с Intellij IDEA - 27"><h2>Бонусная часть</h2>Не хотел изначально добавлять создание пул-реквеста в статью, но получается не очень законченной из-за этого. Поэтому переходим на гитхаб репозиторий (если он ваш, конечно))) ) и видим, что гитхаб уже знает, что нам предложить:
<img data-max-width="1024" data-id="e177f128-6919-4a61-9ffb-0eab37f470f7" src="/images/article/e177f128-6919-4a61-9ffb-0eab37f470f7/1024.jpeg" alt="Подружим Git с Intellij IDEA - 28">Нажимаем на <strong>Compare &amp; pull request</strong>, после чего нажимаем <strong>Create pull request</strong>. Из-за того, что мы заблаговременно порешали конфликты, теперь при создании пул-реквеста, его сразу можно мержить:
<img data-max-width="1024" data-id="702efad8-c260-47c1-aed7-2df573f42d02" src="/images/article/702efad8-c260-47c1-aed7-2df573f42d02/1024.jpeg" alt="Подружим Git с Intellij IDEA - 29">Вот и все, что я хотел вам рассказать в этот раз.

Разумеется, я только открыл вам дверь и показал малую часть. Остальное уже по мере необходимости сами найдете.

Традиционно приглашаю подписаться на мой <a href="https://github.com/romankh3" rel="nofollow" target="_blank">GitHub аккаунт</a>, где я выставляю проекты-наработки на разные технологии, которые использую на работе. 

У меня недавно было личное достижение — <a href="https://github.com/romankh3/image-comparison" rel="nofollow" target="_blank">мой проект</a> был оценен уже более чем сотней разработчиков. Это невероятное чувство радости, что то, что ты сделал, кто-то использует. И использует для пользы.
<h2>Полезные ссылки</h2><ol>
<li>JavaRush: <a href="https://javarush.com/groups/posts/2683-nachalo-rabotih-s-git-podrobnihy-gayd-dlja-novichkov" target="_blank">Начало работы с Git: подробный гайд для новичков</a></li>
<li>GitHub: <a href="https://github.com/romankh3/git-demo" rel="nofollow" target="_blank">Демо-проект для работы</a></li>
<li>JavaRush: <a href="https://javarush.com/groups/posts/2693-komandnaja-rabota-bez-putanicih-razbiraem-strategii-vetvlenija-v-gite" target="_blank">Разбираем стратегии ветвления в Гите</a></li>
<li><a href="https://www.jetbrains.com/help/idea/set-up-a-git-repository.html" rel="nofollow" target="_blank">JetBrains: Set up a Git Repository</a></li>
<li>Habr: <a href="https://habr.com/ru/post/161009/" rel="nofollow" target="_blank">Git rebase</a></li>
<li>GitHub: <a href="https://github.com/romankh3" rel="nofollow" target="_blank">Мой аккаунт</a></li>
</ol>